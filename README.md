✓ gemini-3-flash-preview | Write a technical README for this codebase. Follow these requirements 
strictly:  1. NO icons, emojis... | (14.72s)
╭────────────────────────────────────── Full Conversation ──────────────────────────────────────╮
│ [yellow]US…                                                                                   │
│ a technical                                                                                   │
│ README for                                                                                    │
│ this                                                                                          │
│ codebase.                                                                                     │
│ Follow                                                                                        │
│ these                                                                                         │
│ requiremen…                                                                                   │
│ strictly:                                                                                     │
│                                                                                               │
│ 1. NO                                                                                         │
│ icons,                                                                                        │
│ emojis, or                                                                                    │
│ decorative                                                                                    │
│ elements                                                                                      │
│ 2. NO                                                                                         │
│ sections                                                                                      │
│ for                                                                                           │
│ Contributi…                                                                                   │
│ License,                                                                                      │
│ Acknowledg…                                                                                   │
│ or similar                                                                                    │
│ boilerplate                                                                                   │
│ 3. NO                                                                                         │
│ installati…                                                                                   │
│ instructio…                                                                                   │
│ unless the                                                                                    │
│ setup is                                                                                      │
│ non-trivial                                                                                   │
│ 4. NO                                                                                         │
│ marketing                                                                                     │
│ language or                                                                                   │
│ enthusiasm                                                                                    │
│                                                                                               │
│ Structure:                                                                                    │
│ - Start                                                                                       │
│ with a                                                                                        │
│ direct                                                                                        │
│ technical                                                                                     │
│ description                                                                                   │
│ (2-4                                                                                          │
│ paragraphs)                                                                                   │
│ - Explain                                                                                     │
│ what the                                                                                      │
│ code does,                                                                                    │
│ how it                                                                                        │
│ works                                                                                         │
│ architectu…                                                                                   │
│ and why key                                                                                   │
│ decisions                                                                                     │
│ were made                                                                                     │
│ - Use                                                                                         │
│ precise                                                                                       │
│ technical                                                                                     │
│ terminology                                                                                   │
│ - Focus on                                                                                    │
│ information                                                                                   │
│ density -                                                                                     │
│ every                                                                                         │
│ sentence                                                                                      │
│ should add                                                                                    │
│ value                                                                                         │
│                                                                                               │
│ The                                                                                           │
│ description                                                                                   │
│ should                                                                                        │
│ cover:                                                                                        │
│ - The core                                                                                    │
│ purpose and                                                                                   │
│ role in the                                                                                   │
│ larger                                                                                        │
│ system (if                                                                                    │
│ applicable)                                                                                   │
│ - Main                                                                                        │
│ technical                                                                                     │
│ phases/com…                                                                                   │
│ and how                                                                                       │
│ they                                                                                          │
│ interact                                                                                      │
│ - Key                                                                                         │
│ implementa…                                                                                   │
│ details                                                                                       │
│ (concurren…                                                                                   │
│ model,                                                                                        │
│ error                                                                                         │
│ handling,                                                                                     │
│ data flow)                                                                                    │
│ - Rationale                                                                                   │
│ for                                                                                           │
│ non-obvious                                                                                   │
│ technical                                                                                     │
│ decisions                                                                                     │
│ (e.g.,                                                                                        │
│ "uses X                                                                                       │
│ instead of                                                                                    │
│ Y because Z                                                                                   │
│ constraint…                                                                                   │
│ - Any                                                                                         │
│ footguns,                                                                                     │
│ limitation…                                                                                   │
│ or "tried                                                                                     │
│ this                                                                                          │
│ approach                                                                                      │
│ first but                                                                                     │
│ failed                                                                                        │
│ because..."                                                                                   │
│ context                                                                                       │
│ -                                                                                             │
│ Dependenci…                                                                                   │
│ on or                                                                                         │
│ relationsh…                                                                                   │
│ with other                                                                                    │
│ parts of                                                                                      │
│ the system                                                                                    │
│ - Intended                                                                                    │
│ use case                                                                                      │
│ and                                                                                           │
│ operational                                                                                   │
│ context                                                                                       │
│                                                                                               │
│ Write in a                                                                                    │
│ matter-of-…                                                                                   │
│ tone as if                                                                                    │
│ documenting                                                                                   │
│ for your                                                                                      │
│ future                                                                                        │
│ self.                                                                                         │
│ Assume the                                                                                    │
│ reader is                                                                                     │
│ technically                                                                                   │
│ competent.                                                                                    │
│ Be specific                                                                                   │
│ about what                                                                                    │
│ the code                                                                                      │
│ actually                                                                                      │
│ does rather                                                                                   │
│ than what                                                                                     │
│ problems it                                                                                   │
│ theoretica…                                                                                   │
│ solves.                                                                                       │
│                                                                                               │
│ Do not                                                                                        │
│ include:                                                                                      │
│ usage                                                                                         │
│ examples,                                                                                     │
│ quickstart                                                                                    │
│ guides, or                                                                                    │
│ feature                                                                                       │
│ lists                                                                                         │
│ unless the                                                                                    │
│ code has                                                                                      │
│ genuine                                                                                       │
│ complexity                                                                                    │
│ that                                                                                          │
│ requires                                                                                      │
│ explanatio…                                                                                   │
│                                                                                               │
│ Here's the                                                                                    │
│ code                                                                                          │
│ project:                                                                                      │
│ <code>                                                                                        │
│ CONTEXT: 18                                                                                   │
│ files found                                                                                   │
│ in .claude.                                                                                   │
│                                                                                               │
│ ## FILE:                                                                                      │
│ mcp-server…                                                                                   │
│ ```py                                                                                         │
│ """Standal…                                                                                   │
│ fetch tools                                                                                   │
│ extracted                                                                                     │
│ from                                                                                          │
│ Conduit for                                                                                   │
│ MCP server                                                                                    │
│ use."""                                                                                       │
│ from                                                                                          │
│ __future__                                                                                    │
│ import                                                                                        │
│ annotations                                                                                   │
│                                                                                               │
│ import io                                                                                     │
│ import                                                                                        │
│ mimetypes                                                                                     │
│ from typing                                                                                   │
│ import Any                                                                                    │
│                                                                                               │
│ import                                                                                        │
│ httpx                                                                                         │
│                                                                                               │
│                                                                                               │
│ async def                                                                                     │
│ web_search…                                                                                   │
│ str) ->                                                                                       │
│ dict[str,                                                                                     │
│ str]:                                                                                         │
│     """                                                                                       │
│     Perfor…                                                                                   │
│ a web                                                                                         │
│ search                                                                                        │
│ using the                                                                                     │
│ Brave                                                                                         │
│ Search API.                                                                                   │
│     Requir…                                                                                   │
│ BRAVE_API_…                                                                                   │
│ environment                                                                                   │
│ variable.                                                                                     │
│     """                                                                                       │
│     import                                                                                    │
│ os                                                                                            │
│                                                                                               │
│     api_key                                                                                   │
│ =                                                                                             │
│ os.getenv(…                                                                                   │
│     if not                                                                                    │
│ api_key:                                                                                      │
│         re…                                                                                   │
│ {"error":                                                                                     │
│ "Missing                                                                                      │
│ BRAVE_API_…                                                                                   │
│ environment                                                                                   │
│ variable"}                                                                                    │
│                                                                                               │
│     url =                                                                                     │
│ "https://a…                                                                                   │
│     headers                                                                                   │
│ = {                                                                                           │
│         "A…                                                                                   │
│ "applicati…                                                                                   │
│         "X…                                                                                   │
│ api_key,                                                                                      │
│     }                                                                                         │
│     params                                                                                    │
│ = {"q":                                                                                       │
│ query,                                                                                        │
│ "count": 5}                                                                                   │
│                                                                                               │
│     try:                                                                                      │
│         as…                                                                                   │
│ with                                                                                          │
│ httpx.Asyn…                                                                                   │
│ as client:                                                                                    │
│           …                                                                                   │
│ = await                                                                                       │
│ client.get(                                                                                   │
│           …                                                                                   │
│ headers=he…                                                                                   │
│ params=par…                                                                                   │
│ timeout=10…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ response.j…                                                                                   │
│                                                                                               │
│         re…                                                                                   │
│ = []                                                                                          │
│         we…                                                                                   │
│ =                                                                                             │
│ data.get("…                                                                                   │
│ {}).get("r…                                                                                   │
│ [])                                                                                           │
│                                                                                               │
│         if                                                                                    │
│ not                                                                                           │
│ web_result…                                                                                   │
│           …                                                                                   │
│ {"result":                                                                                    │
│ "No results                                                                                   │
│ found."}                                                                                      │
│                                                                                               │
│         for                                                                                   │
│ i, item in                                                                                    │
│ enumerate(…                                                                                   │
│ 1):                                                                                           │
│           …                                                                                   │
│ =                                                                                             │
│ item.get("…                                                                                   │
│ "No Title")                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ item.get("…                                                                                   │
│ "")                                                                                           │
│           …                                                                                   │
│ =                                                                                             │
│ item.get("…                                                                                   │
│ "")                                                                                           │
│           …                                                                                   │
│           …                                                                                   │
│ Title:                                                                                        │
│ {title}\n                                                                                     │
│ URL:                                                                                          │
│ {link}\n                                                                                      │
│ Snippet:                                                                                      │
│ {descripti…                                                                                   │
│           …                                                                                   │
│                                                                                               │
│         re…                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ "\n---\n".…                                                                                   │
│           …                                                                                   │
│ "Use                                                                                          │
│ fetch_url                                                                                     │
│ to see full                                                                                   │
│ page                                                                                          │
│ content.",                                                                                    │
│         }                                                                                     │
│     except                                                                                    │
│ Exception                                                                                     │
│ as e:                                                                                         │
│         re…                                                                                   │
│ {"error":                                                                                     │
│ f"Search                                                                                      │
│ failed:                                                                                       │
│ {str(e)}"}                                                                                    │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ _convert_h…                                                                                   │
│ str) ->                                                                                       │
│ str:                                                                                          │
│     """Con…                                                                                   │
│ HTML to                                                                                       │
│ clean                                                                                         │
│ markdown."…                                                                                   │
│     import                                                                                    │
│ markdownify                                                                                   │
│     import                                                                                    │
│ readabilipy                                                                                   │
│                                                                                               │
│     ret =                                                                                     │
│ readabilip…                                                                                   │
│ use_readab…                                                                                   │
│     if not                                                                                    │
│ ret["conte…                                                                                   │
│         re…                                                                                   │
│ "<error>Pa…                                                                                   │
│ failed to                                                                                     │
│ be                                                                                            │
│ simplified                                                                                    │
│ from                                                                                          │
│ HTML</erro…                                                                                   │
│                                                                                               │
│     return                                                                                    │
│ markdownif…                                                                                   │
│ heading_st…                                                                                   │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ _convert_b…                                                                                   │
│ bytes,                                                                                        │
│ extension:                                                                                    │
│ str) ->                                                                                       │
│ str:                                                                                          │
│     """Con…                                                                                   │
│ PDF/Office                                                                                    │
│ docs to                                                                                       │
│ markdown                                                                                      │
│ using                                                                                         │
│ MarkItDown…                                                                                   │
│     from                                                                                      │
│ markitdown                                                                                    │
│ import                                                                                        │
│ MarkItDown                                                                                    │
│                                                                                               │
│     md =                                                                                      │
│ MarkItDown…                                                                                   │
│     stream                                                                                    │
│ =                                                                                             │
│ io.BytesIO…                                                                                   │
│                                                                                               │
│     try:                                                                                      │
│         re…                                                                                   │
│ =                                                                                             │
│ md.convert…                                                                                   │
│ file_exten…                                                                                   │
│         re…                                                                                   │
│ result.tex…                                                                                   │
│     except                                                                                    │
│ Exception                                                                                     │
│ as e:                                                                                         │
│         re…                                                                                   │
│ f"<error>M…                                                                                   │
│ failed to                                                                                     │
│ convert                                                                                       │
│ {extension}                                                                                   │
│ file:                                                                                         │
│ {str(e)}</…                                                                                   │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ _paginate_…                                                                                   │
│ str, url:                                                                                     │
│ str, page:                                                                                    │
│ int) ->                                                                                       │
│ dict[str,                                                                                     │
│ Any]:                                                                                         │
│     """Pag…                                                                                   │
│ content for                                                                                   │
│ easier                                                                                        │
│ viewing."""                                                                                   │
│     lines =                                                                                   │
│ full_conte…                                                                                   │
│                                                                                               │
│     #                                                                                         │
│ Generate                                                                                      │
│ Table of                                                                                      │
│ Contents                                                                                      │
│     toc = [                                                                                   │
│         {"…                                                                                   │
│ line,                                                                                         │
│ "line": i +                                                                                   │
│ 1}                                                                                            │
│         for                                                                                   │
│ i, line in                                                                                    │
│ enumerate(…                                                                                   │
│         if                                                                                    │
│ line.strip…                                                                                   │
│     ]                                                                                         │
│                                                                                               │
│     #                                                                                         │
│ Viewport                                                                                      │
│ Slicing                                                                                       │
│ (~8000                                                                                        │
│ chars per                                                                                     │
│ page)                                                                                         │
│     chars_…                                                                                   │
│ = 8000                                                                                        │
│     total_…                                                                                   │
│ =                                                                                             │
│ len(full_c…                                                                                   │
│     total_…                                                                                   │
│ =                                                                                             │
│ (total_cha…                                                                                   │
│ //                                                                                            │
│ chars_per_…                                                                                   │
│ + 1                                                                                           │
│                                                                                               │
│     start_…                                                                                   │
│ = (page -                                                                                     │
│ 1) *                                                                                          │
│ chars_per_…                                                                                   │
│     end_idx                                                                                   │
│ = start_idx                                                                                   │
│ +                                                                                             │
│ chars_per_…                                                                                   │
│     viewpo…                                                                                   │
│ =                                                                                             │
│ full_conte…                                                                                   │
│                                                                                               │
│     if                                                                                        │
│ start_idx                                                                                     │
│ >=                                                                                            │
│ total_chars                                                                                   │
│ and                                                                                           │
│ total_chars                                                                                   │
│ > 0:                                                                                          │
│         re…                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ f"Page                                                                                        │
│ {page} out                                                                                    │
│ of bounds.                                                                                    │
│ Total                                                                                         │
│ pages:                                                                                        │
│ {total_pag…                                                                                   │
│           …                                                                                   │
│ url,                                                                                          │
│         }                                                                                     │
│                                                                                               │
│     return                                                                                    │
│ {                                                                                             │
│         "m…                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ url,                                                                                          │
│           …                                                                                   │
│ page,                                                                                         │
│           …                                                                                   │
│ total_page…                                                                                   │
│           …                                                                                   │
│ total_char…                                                                                   │
│           …                                                                                   │
│ page <                                                                                        │
│ total_page…                                                                                   │
│         },                                                                                    │
│         "t…                                                                                   │
│ toc,                                                                                          │
│         "c…                                                                                   │
│ viewport_t…                                                                                   │
│     }                                                                                         │
│                                                                                               │
│                                                                                               │
│ async def                                                                                     │
│ fetch_url(…                                                                                   │
│ str, page:                                                                                    │
│ int = 1) ->                                                                                   │
│ dict[str,                                                                                     │
│ Any]:                                                                                         │
│     """                                                                                       │
│     Fetch a                                                                                   │
│ URL and                                                                                       │
│ convert it                                                                                    │
│ to clean                                                                                      │
│ Markdown.                                                                                     │
│     Suppor…                                                                                   │
│ HTML, PDF,                                                                                    │
│ Office                                                                                        │
│ documents.                                                                                    │
│     """                                                                                       │
│     async                                                                                     │
│ with                                                                                          │
│ httpx.Asyn…                                                                                   │
│ as client:                                                                                    │
│         tr…                                                                                   │
│           …                                                                                   │
│ = await                                                                                       │
│ client.get(                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ "Mozilla/5…                                                                                   │
│ (Windows NT                                                                                   │
│ 10.0;                                                                                         │
│ Win64; x64)                                                                                   │
│ AppleWebKi…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│         ex…                                                                                   │
│ httpx.HTTP…                                                                                   │
│ as e:                                                                                         │
│           …                                                                                   │
│ {"error":                                                                                     │
│ f"Failed to                                                                                   │
│ fetch                                                                                         │
│ {url}:                                                                                        │
│ {str(e)}"}                                                                                    │
│                                                                                               │
│     # MIME                                                                                    │
│ Type                                                                                          │
│ Dispatcher                                                                                    │
│     conten…                                                                                   │
│ =                                                                                             │
│ response.h…                                                                                   │
│ "").lower(…                                                                                   │
│     extens…                                                                                   │
│ =                                                                                             │
│ mimetypes.…                                                                                   │
│ or ""                                                                                         │
│                                                                                               │
│     try:                                                                                      │
│         if                                                                                    │
│ content_ty…                                                                                   │
│ in                                                                                            │
│ ["text/htm…                                                                                   │
│ "applicati…                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ _convert_h…                                                                                   │
│                                                                                               │
│         el…                                                                                   │
│ content_ty…                                                                                   │
│ in [                                                                                          │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│         ]:                                                                                    │
│           …                                                                                   │
│ =                                                                                             │
│ _convert_b…                                                                                   │
│ extension)                                                                                    │
│                                                                                               │
│         el…                                                                                   │
│ content_ty…                                                                                   │
│ ==                                                                                            │
│ "applicati…                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ f"```json\…                                                                                   │
│                                                                                               │
│         el…                                                                                   │
│           …                                                                                   │
│ Sniff for                                                                                     │
│ HTML if                                                                                       │
│ MIME is                                                                                       │
│ missing/ge…                                                                                   │
│           …                                                                                   │
│ "<html" in                                                                                    │
│ response.t…                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ _convert_h…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ response.t…                                                                                   │
│                                                                                               │
│     except                                                                                    │
│ Exception                                                                                     │
│ as e:                                                                                         │
│         re…                                                                                   │
│ {"error":                                                                                     │
│ f"Conversi…                                                                                   │
│ error for                                                                                     │
│ {url}:                                                                                        │
│ {str(e)}"}                                                                                    │
│                                                                                               │
│     return                                                                                    │
│ _paginate_…                                                                                   │
│ url, page)                                                                                    │
│                                                                                               │
│ ```                                                                                           │
│                                                                                               │
│ ## FILE:                                                                                      │
│ mcp-server…                                                                                   │
│ ```toml                                                                                       │
│ [project]                                                                                     │
│ name =                                                                                        │
│ "conduit-w…                                                                                   │
│ version =                                                                                     │
│ "0.1.0"                                                                                       │
│ description                                                                                   │
│ = "MCP                                                                                        │
│ server                                                                                        │
│ exposing                                                                                      │
│ Conduit's                                                                                     │
│ web_search                                                                                    │
│ and                                                                                           │
│ fetch_url                                                                                     │
│ tools"                                                                                        │
│ requires-p…                                                                                   │
│ = ">=3.12"                                                                                    │
│ dependenci…                                                                                   │
│ = [                                                                                           │
│     "mcp>=…                                                                                   │
│     "httpx…                                                                                   │
│     "reada…                                                                                   │
│     "markd…                                                                                   │
│     "marki…                                                                                   │
│ ]                                                                                             │
│                                                                                               │
│ ```                                                                                           │
│                                                                                               │
│ ## FILE:                                                                                      │
│ mcp-server…                                                                                   │
│ ```py                                                                                         │
│ #!/usr/bin…                                                                                   │
│ python3                                                                                       │
│ """MCP                                                                                        │
│ Server                                                                                        │
│ exposing                                                                                      │
│ web_search                                                                                    │
│ and                                                                                           │
│ fetch_url                                                                                     │
│ tools."""                                                                                     │
│ from                                                                                          │
│ __future__                                                                                    │
│ import                                                                                        │
│ annotations                                                                                   │
│                                                                                               │
│ import                                                                                        │
│ asyncio                                                                                       │
│                                                                                               │
│ from                                                                                          │
│ mcp.server                                                                                    │
│ import                                                                                        │
│ Server                                                                                        │
│ from                                                                                          │
│ mcp.types                                                                                     │
│ import                                                                                        │
│ Tool,                                                                                         │
│ TextContent                                                                                   │
│ import                                                                                        │
│ mcp.server…                                                                                   │
│                                                                                               │
│ from                                                                                          │
│ fetch_tools                                                                                   │
│ import                                                                                        │
│ web_search,                                                                                   │
│ fetch_url                                                                                     │
│                                                                                               │
│ server =                                                                                      │
│ Server("co…                                                                                   │
│                                                                                               │
│                                                                                               │
│ @server.li…                                                                                   │
│ async def                                                                                     │
│ list_tools…                                                                                   │
│ ->                                                                                            │
│ list[Tool]:                                                                                   │
│     return                                                                                    │
│ [                                                                                             │
│         To…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ the web                                                                                       │
│ using Brave                                                                                   │
│ Search API.                                                                                   │
│ Returns top                                                                                   │
│ 5 results                                                                                     │
│ with "                                                                                        │
│           …                                                                                   │
│ URLs, and                                                                                     │
│ snippets.                                                                                     │
│ Use this to                                                                                   │
│ discover                                                                                      │
│ informatio…                                                                                   │
│ "                                                                                             │
│           …                                                                                   │
│ training                                                                                      │
│ platform                                                                                      │
│ URLs, or                                                                                      │
│ research                                                                                      │
│ companies."                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ "object",                                                                                     │
│           …                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ "string",                                                                                     │
│           …                                                                                   │
│ "The search                                                                                   │
│ query                                                                                         │
│ (e.g.,                                                                                        │
│ 'Zapier                                                                                       │
│ training                                                                                      │
│ courses')"                                                                                    │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ ["query"]                                                                                     │
│           …                                                                                   │
│         ),                                                                                    │
│         To…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ a URL and                                                                                     │
│ convert to                                                                                    │
│ clean                                                                                         │
│ Markdown.                                                                                     │
│ Supports                                                                                      │
│ HTML, PDF,                                                                                    │
│ "                                                                                             │
│           …                                                                                   │
│ docs                                                                                          │
│ (docx/pptx…                                                                                   │
│ Automatica…                                                                                   │
│ paginates                                                                                     │
│ long                                                                                          │
│ content."                                                                                     │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ "object",                                                                                     │
│           …                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ "string",                                                                                     │
│           …                                                                                   │
│ "The URL to                                                                                   │
│ fetch"                                                                                        │
│           …                                                                                   │
│           …                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ "integer",                                                                                    │
│           …                                                                                   │
│ "Page                                                                                         │
│ number for                                                                                    │
│ paginated                                                                                     │
│ content                                                                                       │
│ (default:                                                                                     │
│ 1)",                                                                                          │
│           …                                                                                   │
│ 1                                                                                             │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ ["url"]                                                                                       │
│           …                                                                                   │
│         )                                                                                     │
│     ]                                                                                         │
│                                                                                               │
│                                                                                               │
│ @server.ca…                                                                                   │
│ async def                                                                                     │
│ call_tool(…                                                                                   │
│ str,                                                                                          │
│ arguments:                                                                                    │
│ dict) ->                                                                                      │
│ list[TextC…                                                                                   │
│     if name                                                                                   │
│ ==                                                                                            │
│ "web_searc…                                                                                   │
│         qu…                                                                                   │
│ =                                                                                             │
│ arguments[…                                                                                   │
│         re…                                                                                   │
│ = await                                                                                       │
│ web_search…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Format the                                                                                    │
│ result                                                                                        │
│         if                                                                                    │
│ "error" in                                                                                    │
│ result:                                                                                       │
│           …                                                                                   │
│ = f"❌                                                                                        │
│ Error:                                                                                        │
│ {result['e…                                                                                   │
│         el…                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ result.get…                                                                                   │
│ "No                                                                                           │
│ results")                                                                                     │
│           …                                                                                   │
│ "next_step…                                                                                   │
│ in result:                                                                                    │
│           …                                                                                   │
│ += f"\n\n …                                                                                   │
│ {result['n…                                                                                   │
│                                                                                               │
│         re…                                                                                   │
│ [TextConte…                                                                                   │
│ text=text)]                                                                                   │
│                                                                                               │
│     elif                                                                                      │
│ name ==                                                                                       │
│ "fetch_url…                                                                                   │
│         url                                                                                   │
│ =                                                                                             │
│ arguments[…                                                                                   │
│         pa…                                                                                   │
│ =                                                                                             │
│ arguments.…                                                                                   │
│ 1)                                                                                            │
│         re…                                                                                   │
│ = await                                                                                       │
│ fetch_url(…                                                                                   │
│ page)                                                                                         │
│                                                                                               │
│         #                                                                                     │
│ Format the                                                                                    │
│ result                                                                                        │
│         if                                                                                    │
│ "error" in                                                                                    │
│ result:                                                                                       │
│           …                                                                                   │
│ = f"❌                                                                                        │
│ Error:                                                                                        │
│ {result['e…                                                                                   │
│         el…                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ result.get…                                                                                   │
│ {})                                                                                           │
│           …                                                                                   │
│ =                                                                                             │
│ result.get…                                                                                   │
│ "")                                                                                           │
│           …                                                                                   │
│ =                                                                                             │
│ result.get…                                                                                   │
│ [])                                                                                           │
│                                                                                               │
│           …                                                                                   │
│ Build                                                                                         │
│ formatted                                                                                     │
│ output                                                                                        │
│           …                                                                                   │
│ = [                                                                                           │
│           …                                                                                   │
│ Fetched:                                                                                      │
│ {url}",                                                                                       │
│           …                                                                                   │
│ {metadata.…                                                                                   │
│ 1)}/{metad…                                                                                   │
│ 1)}",                                                                                         │
│           …                                                                                   │
│ {metadata.…                                                                                   │
│ 0):,}",                                                                                       │
│           …                                                                                   │
│                                                                                               │
│           …                                                                                   │
│ toc:                                                                                          │
│           …                                                                                   │
│ Table of                                                                                      │
│ Contents")                                                                                    │
│           …                                                                                   │
│ {item['tex…                                                                                   │
│ for item in                                                                                   │
│ toc[:20]])                                                                                    │
│           …                                                                                   │
│ len(toc) >                                                                                    │
│ 20:                                                                                           │
│           …                                                                                   │
│ and                                                                                           │
│ {len(toc) -                                                                                   │
│ 20} more                                                                                      │
│ headings")                                                                                    │
│                                                                                               │
│           …                                                                                   │
│ Content\n")                                                                                   │
│           …                                                                                   │
│                                                                                               │
│           …                                                                                   │
│ metadata.g…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ truncated.                                                                                    │
│ "                                                                                             │
│           …                                                                                   │
│ page={meta…                                                                                   │
│ + 1} to                                                                                       │
│ continue.*"                                                                                   │
│           …                                                                                   │
│                                                                                               │
│           …                                                                                   │
│ =                                                                                             │
│ "\n".join(…                                                                                   │
│                                                                                               │
│         re…                                                                                   │
│ [TextConte…                                                                                   │
│ text=text)]                                                                                   │
│                                                                                               │
│     raise                                                                                     │
│ ValueError…                                                                                   │
│ tool:                                                                                         │
│ {name}")                                                                                      │
│                                                                                               │
│                                                                                               │
│ async def                                                                                     │
│ main():                                                                                       │
│     async                                                                                     │
│ with                                                                                          │
│ mcp.server…                                                                                   │
│ as                                                                                            │
│ (read_stre…                                                                                   │
│ write_stre…                                                                                   │
│         aw…                                                                                   │
│ server.run(                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│         )                                                                                     │
│                                                                                               │
│                                                                                               │
│ if __name__                                                                                   │
│ ==                                                                                            │
│ "__main__":                                                                                   │
│     asynci…                                                                                   │
│                                                                                               │
│ ```                                                                                           │
│                                                                                               │
│ ## FILE:                                                                                      │
│ plugins/ma…                                                                                   │
│ ```py                                                                                         │
│ #!/usr/bin…                                                                                   │
│ python3                                                                                       │
│ """Configu…                                                                                   │
│ loader for                                                                                    │
│ hookify                                                                                       │
│ plugin.                                                                                       │
│                                                                                               │
│ Loads and                                                                                     │
│ parses                                                                                        │
│ .claude/ho…                                                                                   │
│ files.                                                                                        │
│ """                                                                                           │
│                                                                                               │
│ import os                                                                                     │
│ import sys                                                                                    │
│ import glob                                                                                   │
│ import re                                                                                     │
│ from typing                                                                                   │
│ import                                                                                        │
│ List,                                                                                         │
│ Optional,                                                                                     │
│ Dict, Any                                                                                     │
│ from                                                                                          │
│ dataclasses                                                                                   │
│ import                                                                                        │
│ dataclass,                                                                                    │
│ field                                                                                         │
│                                                                                               │
│                                                                                               │
│ @dataclass                                                                                    │
│ class                                                                                         │
│ Condition:                                                                                    │
│     """A                                                                                      │
│ single                                                                                        │
│ condition                                                                                     │
│ for                                                                                           │
│ matching."…                                                                                   │
│     field:                                                                                    │
│ str  #                                                                                        │
│ "command",                                                                                    │
│ "new_text",                                                                                   │
│ "old_text",                                                                                   │
│ "file_path…                                                                                   │
│ etc.                                                                                          │
│     operat…                                                                                   │
│ str  #                                                                                        │
│ "regex_mat…                                                                                   │
│ "contains",                                                                                   │
│ "equals",                                                                                     │
│ etc.                                                                                          │
│     patter…                                                                                   │
│ str  #                                                                                        │
│ Pattern to                                                                                    │
│ match                                                                                         │
│                                                                                               │
│     @class…                                                                                   │
│     def                                                                                       │
│ from_dict(…                                                                                   │
│ data:                                                                                         │
│ Dict[str,                                                                                     │
│ Any]) ->                                                                                      │
│ 'Condition…                                                                                   │
│         ""…                                                                                   │
│ Condition                                                                                     │
│ from                                                                                          │
│ dict."""                                                                                      │
│         re…                                                                                   │
│ cls(                                                                                          │
│           …                                                                                   │
│ ''),                                                                                          │
│           …                                                                                   │
│ 'regex_mat…                                                                                   │
│           …                                                                                   │
│ '')                                                                                           │
│         )                                                                                     │
│                                                                                               │
│                                                                                               │
│ @dataclass                                                                                    │
│ class Rule:                                                                                   │
│     """A                                                                                      │
│ hookify                                                                                       │
│ rule."""                                                                                      │
│     name:                                                                                     │
│ str                                                                                           │
│     enable…                                                                                   │
│ bool                                                                                          │
│     event:                                                                                    │
│ str  #                                                                                        │
│ "bash",                                                                                       │
│ "file",                                                                                       │
│ "stop",                                                                                       │
│ "all", etc.                                                                                   │
│     patter…                                                                                   │
│ Optional[s…                                                                                   │
│ = None  #                                                                                     │
│ Simple                                                                                        │
│ pattern                                                                                       │
│ (legacy)                                                                                      │
│     condit…                                                                                   │
│ List[Condi…                                                                                   │
│ =                                                                                             │
│ field(defa…                                                                                   │
│     action:                                                                                   │
│ str =                                                                                         │
│ "warn"  #                                                                                     │
│ "warn" or                                                                                     │
│ "block"                                                                                       │
│ (future)                                                                                      │
│     tool_m…                                                                                   │
│ Optional[s…                                                                                   │
│ = None  #                                                                                     │
│ Override                                                                                      │
│ tool                                                                                          │
│ matching                                                                                      │
│     messag…                                                                                   │
│ str = ""  #                                                                                   │
│ Message                                                                                       │
│ body from                                                                                     │
│ markdown                                                                                      │
│                                                                                               │
│     @class…                                                                                   │
│     def                                                                                       │
│ from_dict(…                                                                                   │
│ frontmatte…                                                                                   │
│ Dict[str,                                                                                     │
│ Any],                                                                                         │
│ message:                                                                                      │
│ str) ->                                                                                       │
│ 'Rule':                                                                                       │
│         ""…                                                                                   │
│ Rule from                                                                                     │
│ frontmatter                                                                                   │
│ dict and                                                                                      │
│ message                                                                                       │
│ body."""                                                                                      │
│         #                                                                                     │
│ Handle both                                                                                   │
│ simple                                                                                        │
│ pattern and                                                                                   │
│ complex                                                                                       │
│ conditions                                                                                    │
│         co…                                                                                   │
│ = []                                                                                          │
│                                                                                               │
│         #                                                                                     │
│ New style:                                                                                    │
│ explicit                                                                                      │
│ conditions                                                                                    │
│ list                                                                                          │
│         if                                                                                    │
│ 'condition…                                                                                   │
│ in                                                                                            │
│ frontmatte…                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ frontmatte…                                                                                   │
│           …                                                                                   │
│ isinstance…                                                                                   │
│ list):                                                                                        │
│           …                                                                                   │
│ =                                                                                             │
│ [Condition…                                                                                   │
│ for c in                                                                                      │
│ cond_list]                                                                                    │
│                                                                                               │
│         #                                                                                     │
│ Legacy                                                                                        │
│ style:                                                                                        │
│ simple                                                                                        │
│ pattern                                                                                       │
│ field                                                                                         │
│         si…                                                                                   │
│ =                                                                                             │
│ frontmatte…                                                                                   │
│         if                                                                                    │
│ simple_pat…                                                                                   │
│ and not                                                                                       │
│ conditions:                                                                                   │
│           …                                                                                   │
│ Convert                                                                                       │
│ simple                                                                                        │
│ pattern to                                                                                    │
│ condition                                                                                     │
│           …                                                                                   │
│ Infer field                                                                                   │
│ from event                                                                                    │
│           …                                                                                   │
│ =                                                                                             │
│ frontmatte…                                                                                   │
│ 'all')                                                                                        │
│           …                                                                                   │
│ event ==                                                                                      │
│ 'bash':                                                                                       │
│           …                                                                                   │
│ = 'command'                                                                                   │
│           …                                                                                   │
│ event ==                                                                                      │
│ 'file':                                                                                       │
│           …                                                                                   │
│ =                                                                                             │
│ 'new_text'                                                                                    │
│           …                                                                                   │
│           …                                                                                   │
│ = 'content'                                                                                   │
│                                                                                               │
│           …                                                                                   │
│ =                                                                                             │
│ [Condition(                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│                                                                                               │
│         re…                                                                                   │
│ cls(                                                                                          │
│           …                                                                                   │
│ 'unnamed'),                                                                                   │
│           …                                                                                   │
│ True),                                                                                        │
│           …                                                                                   │
│ 'all'),                                                                                       │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ 'warn'),                                                                                      │
│           …                                                                                   │
│           …                                                                                   │
│         )                                                                                     │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ extract_fr…                                                                                   │
│ str) ->                                                                                       │
│ tuple[Dict…                                                                                   │
│ Any], str]:                                                                                   │
│     """Ext…                                                                                   │
│ YAML                                                                                          │
│ frontmatter                                                                                   │
│ and message                                                                                   │
│ body from                                                                                     │
│ markdown.                                                                                     │
│                                                                                               │
│     Returns                                                                                   │
│ (frontmatt…                                                                                   │
│ message_bo…                                                                                   │
│                                                                                               │
│     Suppor…                                                                                   │
│ multi-line                                                                                    │
│ dictionary                                                                                    │
│ items in                                                                                      │
│ lists by                                                                                      │
│ preserving                                                                                    │
│ indentatio…                                                                                   │
│     """                                                                                       │
│     if not                                                                                    │
│ content.st…                                                                                   │
│         re…                                                                                   │
│ {}, content                                                                                   │
│                                                                                               │
│     # Split                                                                                   │
│ on ---                                                                                        │
│ markers                                                                                       │
│     parts =                                                                                   │
│ content.sp…                                                                                   │
│ 2)                                                                                            │
│     if                                                                                        │
│ len(parts)                                                                                    │
│ < 3:                                                                                          │
│         re…                                                                                   │
│ {}, content                                                                                   │
│                                                                                               │
│     frontm…                                                                                   │
│ = parts[1]                                                                                    │
│     message                                                                                   │
│ =                                                                                             │
│ parts[2].s…                                                                                   │
│                                                                                               │
│     #                                                                                         │
│ Simple YAML                                                                                   │
│ parser that                                                                                   │
│ handles                                                                                       │
│ indented                                                                                      │
│ list items                                                                                    │
│     frontm…                                                                                   │
│ = {}                                                                                          │
│     lines =                                                                                   │
│ frontmatte…                                                                                   │
│                                                                                               │
│     curren…                                                                                   │
│ = None                                                                                        │
│     curren…                                                                                   │
│ = []                                                                                          │
│     curren…                                                                                   │
│ = {}                                                                                          │
│     in_list                                                                                   │
│ = False                                                                                       │
│     in_dic…                                                                                   │
│ = False                                                                                       │
│                                                                                               │
│     for                                                                                       │
│ line in                                                                                       │
│ lines:                                                                                        │
│         #                                                                                     │
│ Skip empty                                                                                    │
│ lines and                                                                                     │
│ comments                                                                                      │
│         st…                                                                                   │
│ =                                                                                             │
│ line.strip…                                                                                   │
│         if                                                                                    │
│ not                                                                                           │
│ stripped or                                                                                   │
│ stripped.s…                                                                                   │
│           …                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Check                                                                                         │
│ indentation                                                                                   │
│ level                                                                                         │
│         in…                                                                                   │
│ = len(line)                                                                                   │
│ -                                                                                             │
│ len(line.l…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Top-level                                                                                     │
│ key (no                                                                                       │
│ indentation                                                                                   │
│ or minimal)                                                                                   │
│         if                                                                                    │
│ indent == 0                                                                                   │
│ and ':' in                                                                                    │
│ line and                                                                                      │
│ not                                                                                           │
│ line.strip…                                                                                   │
│           …                                                                                   │
│ Save                                                                                          │
│ previous                                                                                      │
│ list/dict                                                                                     │
│ if any                                                                                        │
│           …                                                                                   │
│ in_list and                                                                                   │
│ current_ke…                                                                                   │
│           …                                                                                   │
│ in_dict_it…                                                                                   │
│ and                                                                                           │
│ current_di…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ = {}                                                                                          │
│           …                                                                                   │
│ =                                                                                             │
│ current_li…                                                                                   │
│           …                                                                                   │
│ = False                                                                                       │
│           …                                                                                   │
│ = False                                                                                       │
│           …                                                                                   │
│ = []                                                                                          │
│                                                                                               │
│           …                                                                                   │
│ value =                                                                                       │
│ line.split…                                                                                   │
│ 1)                                                                                            │
│           …                                                                                   │
│ =                                                                                             │
│ key.strip()                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ value.stri…                                                                                   │
│                                                                                               │
│           …                                                                                   │
│ not value:                                                                                    │
│           …                                                                                   │
│ Empty value                                                                                   │
│ - list or                                                                                     │
│ nested                                                                                        │
│ structure                                                                                     │
│ follows                                                                                       │
│           …                                                                                   │
│ = key                                                                                         │
│           …                                                                                   │
│ = True                                                                                        │
│           …                                                                                   │
│ = []                                                                                          │
│           …                                                                                   │
│           …                                                                                   │
│ Simple                                                                                        │
│ key-value                                                                                     │
│ pair                                                                                          │
│           …                                                                                   │
│ =                                                                                             │
│ value.stri…                                                                                   │
│           …                                                                                   │
│ value.lowe…                                                                                   │
│ == 'true':                                                                                    │
│           …                                                                                   │
│ = True                                                                                        │
│           …                                                                                   │
│ value.lowe…                                                                                   │
│ == 'false':                                                                                   │
│           …                                                                                   │
│ = False                                                                                       │
│           …                                                                                   │
│ = value                                                                                       │
│                                                                                               │
│         #                                                                                     │
│ List item                                                                                     │
│ (starts                                                                                       │
│ with -)                                                                                       │
│         el…                                                                                   │
│ stripped.s…                                                                                   │
│ and                                                                                           │
│ in_list:                                                                                      │
│           …                                                                                   │
│ Save                                                                                          │
│ previous                                                                                      │
│ dict item                                                                                     │
│ if any                                                                                        │
│           …                                                                                   │
│ in_dict_it…                                                                                   │
│ and                                                                                           │
│ current_di…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ = {}                                                                                          │
│                                                                                               │
│           …                                                                                   │
│ =                                                                                             │
│ stripped[1…                                                                                   │
│                                                                                               │
│           …                                                                                   │
│ Check if                                                                                      │
│ this is an                                                                                    │
│ inline dict                                                                                   │
│ (key: value                                                                                   │
│ on same                                                                                       │
│ line)                                                                                         │
│           …                                                                                   │
│ ':' in                                                                                        │
│ item_text                                                                                     │
│ and ',' in                                                                                    │
│ item_text:                                                                                    │
│           …                                                                                   │
│ Inline                                                                                        │
│ comma-sepa…                                                                                   │
│ dict: "-                                                                                      │
│ field:                                                                                        │
│ command,                                                                                      │
│ operator:                                                                                     │
│ regex_matc…                                                                                   │
│           …                                                                                   │
│ = {}                                                                                          │
│           …                                                                                   │
│ part in                                                                                       │
│ item_text.…                                                                                   │
│           …                                                                                   │
│ ':' in                                                                                        │
│ part:                                                                                         │
│           …                                                                                   │
│ v =                                                                                           │
│ part.split…                                                                                   │
│ 1)                                                                                            │
│           …                                                                                   │
│ =                                                                                             │
│ v.strip().…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ = False                                                                                       │
│           …                                                                                   │
│ ':' in                                                                                        │
│ item_text:                                                                                    │
│           …                                                                                   │
│ Start of                                                                                      │
│ multi-line                                                                                    │
│ dict item:                                                                                    │
│ "- field:                                                                                     │
│ command"                                                                                      │
│           …                                                                                   │
│ = True                                                                                        │
│           …                                                                                   │
│ v =                                                                                           │
│ item_text.…                                                                                   │
│ 1)                                                                                            │
│           …                                                                                   │
│ =                                                                                             │
│ {k.strip():                                                                                   │
│ v.strip().…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ Simple list                                                                                   │
│ item                                                                                          │
│           …                                                                                   │
│           …                                                                                   │
│ = False                                                                                       │
│                                                                                               │
│         #                                                                                     │
│ Continuati…                                                                                   │
│ of dict                                                                                       │
│ item                                                                                          │
│ (indented                                                                                     │
│ under list                                                                                    │
│ item)                                                                                         │
│         el…                                                                                   │
│ indent > 2                                                                                    │
│ and                                                                                           │
│ in_dict_it…                                                                                   │
│ and ':' in                                                                                    │
│ line:                                                                                         │
│           …                                                                                   │
│ This is a                                                                                     │
│ field of                                                                                      │
│ the current                                                                                   │
│ dict item                                                                                     │
│           …                                                                                   │
│ v =                                                                                           │
│ stripped.s…                                                                                   │
│ 1)                                                                                            │
│           …                                                                                   │
│ =                                                                                             │
│ v.strip().…                                                                                   │
│                                                                                               │
│     # Save                                                                                    │
│ final                                                                                         │
│ list/dict                                                                                     │
│ if any                                                                                        │
│     if                                                                                        │
│ in_list and                                                                                   │
│ current_ke…                                                                                   │
│         if                                                                                    │
│ in_dict_it…                                                                                   │
│ and                                                                                           │
│ current_di…                                                                                   │
│           …                                                                                   │
│         fr…                                                                                   │
│ =                                                                                             │
│ current_li…                                                                                   │
│                                                                                               │
│     return                                                                                    │
│ frontmatte…                                                                                   │
│ message                                                                                       │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ load_rules…                                                                                   │
│ Optional[s…                                                                                   │
│ = None) ->                                                                                    │
│ List[Rule]:                                                                                   │
│     """Load                                                                                   │
│ all hookify                                                                                   │
│ rules from                                                                                    │
│ .claude                                                                                       │
│ directory.                                                                                    │
│                                                                                               │
│     Args:                                                                                     │
│         ev…                                                                                   │
│ Optional                                                                                      │
│ event                                                                                         │
│ filter                                                                                        │
│ ("bash",                                                                                      │
│ "file",                                                                                       │
│ "stop",                                                                                       │
│ etc.)                                                                                         │
│                                                                                               │
│     Return…                                                                                   │
│         Li…                                                                                   │
│ of enabled                                                                                    │
│ Rule                                                                                          │
│ objects                                                                                       │
│ matching                                                                                      │
│ the event.                                                                                    │
│     """                                                                                       │
│     rules =                                                                                   │
│ []                                                                                            │
│                                                                                               │
│     # Find                                                                                    │
│ all                                                                                           │
│ hookify.*.…                                                                                   │
│ files                                                                                         │
│     pattern                                                                                   │
│ =                                                                                             │
│ os.path.jo…                                                                                   │
│ 'hookify.*…                                                                                   │
│     files =                                                                                   │
│ glob.glob(…                                                                                   │
│                                                                                               │
│     for                                                                                       │
│ file_path                                                                                     │
│ in files:                                                                                     │
│         tr…                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ load_rule_…                                                                                   │
│           …                                                                                   │
│ not rule:                                                                                     │
│           …                                                                                   │
│                                                                                               │
│           …                                                                                   │
│ Filter by                                                                                     │
│ event if                                                                                      │
│ specified                                                                                     │
│           …                                                                                   │
│ event:                                                                                        │
│           …                                                                                   │
│ rule.event                                                                                    │
│ != 'all'                                                                                      │
│ and                                                                                           │
│ rule.event                                                                                    │
│ != event:                                                                                     │
│           …                                                                                   │
│                                                                                               │
│           …                                                                                   │
│ Only                                                                                          │
│ include                                                                                       │
│ enabled                                                                                       │
│ rules                                                                                         │
│           …                                                                                   │
│ rule.enabl…                                                                                   │
│           …                                                                                   │
│                                                                                               │
│         ex…                                                                                   │
│ (IOError,                                                                                     │
│ OSError,                                                                                      │
│ Permission…                                                                                   │
│ as e:                                                                                         │
│           …                                                                                   │
│ File I/O                                                                                      │
│ errors -                                                                                      │
│ log and                                                                                       │
│ continue                                                                                      │
│           …                                                                                   │
│ Failed to                                                                                     │
│ read                                                                                          │
│ {file_path…                                                                                   │
│ {e}",                                                                                         │
│ file=sys.s…                                                                                   │
│           …                                                                                   │
│         ex…                                                                                   │
│ (ValueErro…                                                                                   │
│ KeyError,                                                                                     │
│ AttributeE…                                                                                   │
│ TypeError)                                                                                    │
│ as e:                                                                                         │
│           …                                                                                   │
│ Parsing                                                                                       │
│ errors -                                                                                      │
│ log and                                                                                       │
│ continue                                                                                      │
│           …                                                                                   │
│ Failed to                                                                                     │
│ parse                                                                                         │
│ {file_path…                                                                                   │
│ {e}",                                                                                         │
│ file=sys.s…                                                                                   │
│           …                                                                                   │
│         ex…                                                                                   │
│ Exception                                                                                     │
│ as e:                                                                                         │
│           …                                                                                   │
│ Unexpected                                                                                    │
│ errors -                                                                                      │
│ log with                                                                                      │
│ type                                                                                          │
│ details                                                                                       │
│           …                                                                                   │
│ Unexpected                                                                                    │
│ error                                                                                         │
│ loading                                                                                       │
│ {file_path}                                                                                   │
│ ({type(e).…                                                                                   │
│ {e}",                                                                                         │
│ file=sys.s…                                                                                   │
│           …                                                                                   │
│                                                                                               │
│     return                                                                                    │
│ rules                                                                                         │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ load_rule_…                                                                                   │
│ str) ->                                                                                       │
│ Optional[R…                                                                                   │
│     """Load                                                                                   │
│ a single                                                                                      │
│ rule file.                                                                                    │
│                                                                                               │
│     Return…                                                                                   │
│         Ru…                                                                                   │
│ object or                                                                                     │
│ None if                                                                                       │
│ file is                                                                                       │
│ invalid.                                                                                      │
│     """                                                                                       │
│     try:                                                                                      │
│         wi…                                                                                   │
│ open(file_…                                                                                   │
│ 'r') as f:                                                                                    │
│           …                                                                                   │
│ = f.read()                                                                                    │
│                                                                                               │
│         fr…                                                                                   │
│ message =                                                                                     │
│ extract_fr…                                                                                   │
│                                                                                               │
│         if                                                                                    │
│ not                                                                                           │
│ frontmatte…                                                                                   │
│           …                                                                                   │
│ {file_path}                                                                                   │
│ missing                                                                                       │
│ YAML                                                                                          │
│ frontmatter                                                                                   │
│ (must start                                                                                   │
│ with ---)",                                                                                   │
│ file=sys.s…                                                                                   │
│           …                                                                                   │
│ None                                                                                          │
│                                                                                               │
│         ru…                                                                                   │
│ =                                                                                             │
│ Rule.from_…                                                                                   │
│ message)                                                                                      │
│         re…                                                                                   │
│ rule                                                                                          │
│                                                                                               │
│     except                                                                                    │
│ (IOError,                                                                                     │
│ OSError,                                                                                      │
│ Permission…                                                                                   │
│ as e:                                                                                         │
│         pr…                                                                                   │
│ Cannot read                                                                                   │
│ {file_path…                                                                                   │
│ {e}",                                                                                         │
│ file=sys.s…                                                                                   │
│         re…                                                                                   │
│ None                                                                                          │
│     except                                                                                    │
│ (ValueErro…                                                                                   │
│ KeyError,                                                                                     │
│ AttributeE…                                                                                   │
│ TypeError)                                                                                    │
│ as e:                                                                                         │
│         pr…                                                                                   │
│ Malformed                                                                                     │
│ rule file                                                                                     │
│ {file_path…                                                                                   │
│ {e}",                                                                                         │
│ file=sys.s…                                                                                   │
│         re…                                                                                   │
│ None                                                                                          │
│     except                                                                                    │
│ UnicodeDec…                                                                                   │
│ as e:                                                                                         │
│         pr…                                                                                   │
│ Invalid                                                                                       │
│ encoding in                                                                                   │
│ {file_path…                                                                                   │
│ {e}",                                                                                         │
│ file=sys.s…                                                                                   │
│         re…                                                                                   │
│ None                                                                                          │
│     except                                                                                    │
│ Exception                                                                                     │
│ as e:                                                                                         │
│         pr…                                                                                   │
│ Unexpected                                                                                    │
│ error                                                                                         │
│ parsing                                                                                       │
│ {file_path}                                                                                   │
│ ({type(e).…                                                                                   │
│ {e}",                                                                                         │
│ file=sys.s…                                                                                   │
│         re…                                                                                   │
│ None                                                                                          │
│                                                                                               │
│                                                                                               │
│ # For                                                                                         │
│ testing                                                                                       │
│ if __name__                                                                                   │
│ ==                                                                                            │
│ '__main__':                                                                                   │
│     import                                                                                    │
│ sys                                                                                           │
│                                                                                               │
│     # Test                                                                                    │
│ frontmatter                                                                                   │
│ parsing                                                                                       │
│     test_c…                                                                                   │
│ = """---                                                                                      │
│ name:                                                                                         │
│ test-rule                                                                                     │
│ enabled:                                                                                      │
│ true                                                                                          │
│ event: bash                                                                                   │
│ pattern:                                                                                      │
│ "rm -rf"                                                                                      │
│ ---                                                                                           │
│                                                                                               │
│ ⚠️ Dangerous                                                                                   │
│ command                                                                                       │
│ detected!                                                                                     │
│ """                                                                                           │
│                                                                                               │
│     fm, msg                                                                                   │
│ =                                                                                             │
│ extract_fr…                                                                                   │
│     print(…                                                                                   │
│ fm)                                                                                           │
│     print(…                                                                                   │
│ msg)                                                                                          │
│                                                                                               │
│     rule =                                                                                    │
│ Rule.from_…                                                                                   │
│ msg)                                                                                          │
│     print(…                                                                                   │
│ rule)                                                                                         │
│                                                                                               │
│ ```                                                                                           │
│                                                                                               │
│ ## FILE:                                                                                      │
│ plugins/ma…                                                                                   │
│ ```py                                                                                         │
│ #!/usr/bin…                                                                                   │
│ python3                                                                                       │
│ """Rule                                                                                       │
│ evaluation                                                                                    │
│ engine for                                                                                    │
│ hookify                                                                                       │
│ plugin."""                                                                                    │
│                                                                                               │
│ import re                                                                                     │
│ import sys                                                                                    │
│ from                                                                                          │
│ functools                                                                                     │
│ import                                                                                        │
│ lru_cache                                                                                     │
│ from typing                                                                                   │
│ import                                                                                        │
│ List, Dict,                                                                                   │
│ Any,                                                                                          │
│ Optional                                                                                      │
│                                                                                               │
│ # Import                                                                                      │
│ from local                                                                                    │
│ module                                                                                        │
│ from                                                                                          │
│ core.confi…                                                                                   │
│ import                                                                                        │
│ Rule,                                                                                         │
│ Condition                                                                                     │
│                                                                                               │
│                                                                                               │
│ # Cache                                                                                       │
│ compiled                                                                                      │
│ regexes                                                                                       │
│ (max 128                                                                                      │
│ patterns)                                                                                     │
│ @lru_cache…                                                                                   │
│ def                                                                                           │
│ compile_re…                                                                                   │
│ str) ->                                                                                       │
│ re.Pattern:                                                                                   │
│     """Com…                                                                                   │
│ regex                                                                                         │
│ pattern                                                                                       │
│ with                                                                                          │
│ caching.                                                                                      │
│                                                                                               │
│     Args:                                                                                     │
│         pa…                                                                                   │
│ Regex                                                                                         │
│ pattern                                                                                       │
│ string                                                                                        │
│                                                                                               │
│     Return…                                                                                   │
│         Co…                                                                                   │
│ regex                                                                                         │
│ pattern                                                                                       │
│     """                                                                                       │
│     return                                                                                    │
│ re.compile…                                                                                   │
│ re.IGNOREC…                                                                                   │
│                                                                                               │
│                                                                                               │
│ class                                                                                         │
│ RuleEngine:                                                                                   │
│     """Eva…                                                                                   │
│ rules                                                                                         │
│ against                                                                                       │
│ hook input                                                                                    │
│ data."""                                                                                      │
│                                                                                               │
│     def                                                                                       │
│ __init__(s…                                                                                   │
│         ""…                                                                                   │
│ rule                                                                                          │
│ engine."""                                                                                    │
│         #                                                                                     │
│ No need for                                                                                   │
│ instance                                                                                      │
│ cache                                                                                         │
│ anymore -                                                                                     │
│ using                                                                                         │
│ global                                                                                        │
│ lru_cache                                                                                     │
│         pa…                                                                                   │
│                                                                                               │
│     def                                                                                       │
│ evaluate_r…                                                                                   │
│ rules:                                                                                        │
│ List[Rule],                                                                                   │
│ input_data:                                                                                   │
│ Dict[str,                                                                                     │
│ Any]) ->                                                                                      │
│ Dict[str,                                                                                     │
│ Any]:                                                                                         │
│         ""…                                                                                   │
│ all rules                                                                                     │
│ and return                                                                                    │
│ combined                                                                                      │
│ results.                                                                                      │
│                                                                                               │
│         Ch…                                                                                   │
│ all rules                                                                                     │
│ and                                                                                           │
│ accumulates                                                                                   │
│ matches.                                                                                      │
│ Blocking                                                                                      │
│ rules take                                                                                    │
│ priority                                                                                      │
│         ov…                                                                                   │
│ warning                                                                                       │
│ rules. All                                                                                    │
│ matching                                                                                      │
│ rule                                                                                          │
│ messages                                                                                      │
│ are                                                                                           │
│ combined.                                                                                     │
│                                                                                               │
│         Ar…                                                                                   │
│           …                                                                                   │
│ List of                                                                                       │
│ Rule                                                                                          │
│ objects to                                                                                    │
│ evaluate                                                                                      │
│           …                                                                                   │
│ Hook input                                                                                    │
│ JSON                                                                                          │
│ (tool_name,                                                                                   │
│ tool_input,                                                                                   │
│ etc.)                                                                                         │
│                                                                                               │
│         Re…                                                                                   │
│           …                                                                                   │
│ dict with                                                                                     │
│ systemMess…                                                                                   │
│ hookSpecif…                                                                                   │
│ etc.                                                                                          │
│           …                                                                                   │
│ dict {} if                                                                                    │
│ no rules                                                                                      │
│ match.                                                                                        │
│         """                                                                                   │
│         ho…                                                                                   │
│ =                                                                                             │
│ input_data…                                                                                   │
│ '')                                                                                           │
│         bl…                                                                                   │
│ = []                                                                                          │
│         wa…                                                                                   │
│ = []                                                                                          │
│                                                                                               │
│         for                                                                                   │
│ rule in                                                                                       │
│ rules:                                                                                        │
│           …                                                                                   │
│ self._rule…                                                                                   │
│ input_data…                                                                                   │
│           …                                                                                   │
│ rule.action                                                                                   │
│ == 'block':                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ If any                                                                                        │
│ blocking                                                                                      │
│ rules                                                                                         │
│ matched,                                                                                      │
│ block the                                                                                     │
│ operation                                                                                     │
│         if                                                                                    │
│ blocking_r…                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ [f"**[{r.n…                                                                                   │
│ for r in                                                                                      │
│ blocking_r…                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ "\n\n".joi…                                                                                   │
│                                                                                               │
│           …                                                                                   │
│ Use                                                                                           │
│ appropriate                                                                                   │
│ blocking                                                                                      │
│ format                                                                                        │
│ based on                                                                                      │
│ event type                                                                                    │
│           …                                                                                   │
│ hook_event                                                                                    │
│ == 'Stop':                                                                                    │
│           …                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ "block",                                                                                      │
│           …                                                                                   │
│ combined_m…                                                                                   │
│           …                                                                                   │
│ combined_m…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ hook_event                                                                                    │
│ in                                                                                            │
│ ['PreToolU…                                                                                   │
│ 'PostToolU…                                                                                   │
│           …                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ hook_event,                                                                                   │
│           …                                                                                   │
│ "deny"                                                                                        │
│           …                                                                                   │
│           …                                                                                   │
│ combined_m…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ For other                                                                                     │
│ events,                                                                                       │
│ just show                                                                                     │
│ message                                                                                       │
│           …                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ combined_m…                                                                                   │
│           …                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ If only                                                                                       │
│ warnings,                                                                                     │
│ show them                                                                                     │
│ but allow                                                                                     │
│ operation                                                                                     │
│         if                                                                                    │
│ warning_ru…                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ [f"**[{r.n…                                                                                   │
│ for r in                                                                                      │
│ warning_ru…                                                                                   │
│           …                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ "\n\n".joi…                                                                                   │
│           …                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ No matches                                                                                    │
│ - allow                                                                                       │
│ operation                                                                                     │
│         re…                                                                                   │
│ {}                                                                                            │
│                                                                                               │
│     def                                                                                       │
│ _rule_matc…                                                                                   │
│ rule: Rule,                                                                                   │
│ input_data:                                                                                   │
│ Dict[str,                                                                                     │
│ Any]) ->                                                                                      │
│ bool:                                                                                         │
│         ""…                                                                                   │
│ if rule                                                                                       │
│ matches                                                                                       │
│ input data.                                                                                   │
│                                                                                               │
│         Ar…                                                                                   │
│           …                                                                                   │
│ Rule to                                                                                       │
│ evaluate                                                                                      │
│           …                                                                                   │
│ Hook input                                                                                    │
│ data                                                                                          │
│                                                                                               │
│         Re…                                                                                   │
│           …                                                                                   │
│ if rule                                                                                       │
│ matches,                                                                                      │
│ False                                                                                         │
│ otherwise                                                                                     │
│         """                                                                                   │
│         #                                                                                     │
│ Extract                                                                                       │
│ tool                                                                                          │
│ information                                                                                   │
│         to…                                                                                   │
│ =                                                                                             │
│ input_data…                                                                                   │
│ '')                                                                                           │
│         to…                                                                                   │
│ =                                                                                             │
│ input_data…                                                                                   │
│ {})                                                                                           │
│                                                                                               │
│         #                                                                                     │
│ Check tool                                                                                    │
│ matcher if                                                                                    │
│ specified                                                                                     │
│         if                                                                                    │
│ rule.tool_…                                                                                   │
│           …                                                                                   │
│ not                                                                                           │
│ self._matc…                                                                                   │
│ tool_name):                                                                                   │
│           …                                                                                   │
│ False                                                                                         │
│                                                                                               │
│         #                                                                                     │
│ If no                                                                                         │
│ conditions,                                                                                   │
│ don't match                                                                                   │
│         #                                                                                     │
│ (Rules must                                                                                   │
│ have at                                                                                       │
│ least one                                                                                     │
│ condition                                                                                     │
│ to be                                                                                         │
│ valid)                                                                                        │
│         if                                                                                    │
│ not                                                                                           │
│ rule.condi…                                                                                   │
│           …                                                                                   │
│ False                                                                                         │
│                                                                                               │
│         #                                                                                     │
│ All                                                                                           │
│ conditions                                                                                    │
│ must match                                                                                    │
│         for                                                                                   │
│ condition                                                                                     │
│ in                                                                                            │
│ rule.condi…                                                                                   │
│           …                                                                                   │
│ not                                                                                           │
│ self._chec…                                                                                   │
│ tool_name,                                                                                    │
│ tool_input,                                                                                   │
│ input_data…                                                                                   │
│           …                                                                                   │
│ False                                                                                         │
│                                                                                               │
│         re…                                                                                   │
│ True                                                                                          │
│                                                                                               │
│     def                                                                                       │
│ _matches_t…                                                                                   │
│ matcher:                                                                                      │
│ str,                                                                                          │
│ tool_name:                                                                                    │
│ str) ->                                                                                       │
│ bool:                                                                                         │
│         ""…                                                                                   │
│ if                                                                                            │
│ tool_name                                                                                     │
│ matches the                                                                                   │
│ matcher                                                                                       │
│ pattern.                                                                                      │
│                                                                                               │
│         Ar…                                                                                   │
│           …                                                                                   │
│ Pattern                                                                                       │
│ like                                                                                          │
│ "Bash",                                                                                       │
│ "Edit|Writ…                                                                                   │
│ "*"                                                                                           │
│           …                                                                                   │
│ Actual tool                                                                                   │
│ name                                                                                          │
│                                                                                               │
│         Re…                                                                                   │
│           …                                                                                   │
│ if matches                                                                                    │
│         """                                                                                   │
│         if                                                                                    │
│ matcher ==                                                                                    │
│ '*':                                                                                          │
│           …                                                                                   │
│ True                                                                                          │
│                                                                                               │
│         #                                                                                     │
│ Split on |                                                                                    │
│ for OR                                                                                        │
│ matching                                                                                      │
│         pa…                                                                                   │
│ =                                                                                             │
│ matcher.sp…                                                                                   │
│         re…                                                                                   │
│ tool_name                                                                                     │
│ in patterns                                                                                   │
│                                                                                               │
│     def                                                                                       │
│ _check_con…                                                                                   │
│ condition:                                                                                    │
│ Condition,                                                                                    │
│ tool_name:                                                                                    │
│ str,                                                                                          │
│           …                                                                                   │
│ Dict[str,                                                                                     │
│ Any],                                                                                         │
│ input_data:                                                                                   │
│ Dict[str,                                                                                     │
│ Any] =                                                                                        │
│ None) ->                                                                                      │
│ bool:                                                                                         │
│         ""…                                                                                   │
│ if a single                                                                                   │
│ condition                                                                                     │
│ matches.                                                                                      │
│                                                                                               │
│         Ar…                                                                                   │
│           …                                                                                   │
│ Condition                                                                                     │
│ to check                                                                                      │
│           …                                                                                   │
│ Tool being                                                                                    │
│ used                                                                                          │
│           …                                                                                   │
│ Tool input                                                                                    │
│ dict                                                                                          │
│           …                                                                                   │
│ Full hook                                                                                     │
│ input data                                                                                    │
│ (for Stop                                                                                     │
│ events,                                                                                       │
│ etc.)                                                                                         │
│                                                                                               │
│         Re…                                                                                   │
│           …                                                                                   │
│ if                                                                                            │
│ condition                                                                                     │
│ matches                                                                                       │
│         """                                                                                   │
│         #                                                                                     │
│ Extract the                                                                                   │
│ field value                                                                                   │
│ to check                                                                                      │
│         fi…                                                                                   │
│ =                                                                                             │
│ self._extr…                                                                                   │
│ tool_name,                                                                                    │
│ tool_input,                                                                                   │
│ input_data)                                                                                   │
│         if                                                                                    │
│ field_value                                                                                   │
│ is None:                                                                                      │
│           …                                                                                   │
│ False                                                                                         │
│                                                                                               │
│         #                                                                                     │
│ Apply                                                                                         │
│ operator                                                                                      │
│         op…                                                                                   │
│ =                                                                                             │
│ condition.…                                                                                   │
│         pa…                                                                                   │
│ =                                                                                             │
│ condition.…                                                                                   │
│                                                                                               │
│         if                                                                                    │
│ operator ==                                                                                   │
│ 'regex_mat…                                                                                   │
│           …                                                                                   │
│ self._rege…                                                                                   │
│ field_valu…                                                                                   │
│         el…                                                                                   │
│ operator ==                                                                                   │
│ 'contains':                                                                                   │
│           …                                                                                   │
│ pattern in                                                                                    │
│ field_value                                                                                   │
│         el…                                                                                   │
│ operator ==                                                                                   │
│ 'equals':                                                                                     │
│           …                                                                                   │
│ pattern ==                                                                                    │
│ field_value                                                                                   │
│         el…                                                                                   │
│ operator ==                                                                                   │
│ 'not_conta…                                                                                   │
│           …                                                                                   │
│ pattern not                                                                                   │
│ in                                                                                            │
│ field_value                                                                                   │
│         el…                                                                                   │
│ operator ==                                                                                   │
│ 'starts_wi…                                                                                   │
│           …                                                                                   │
│ field_valu…                                                                                   │
│         el…                                                                                   │
│ operator ==                                                                                   │
│ 'ends_with…                                                                                   │
│           …                                                                                   │
│ field_valu…                                                                                   │
│         el…                                                                                   │
│           …                                                                                   │
│ Unknown                                                                                       │
│ operator                                                                                      │
│           …                                                                                   │
│ False                                                                                         │
│                                                                                               │
│     def                                                                                       │
│ _extract_f…                                                                                   │
│ field: str,                                                                                   │
│ tool_name:                                                                                    │
│ str,                                                                                          │
│           …                                                                                   │
│ Dict[str,                                                                                     │
│ Any],                                                                                         │
│ input_data:                                                                                   │
│ Dict[str,                                                                                     │
│ Any] =                                                                                        │
│ None) ->                                                                                      │
│ Optional[s…                                                                                   │
│         ""…                                                                                   │
│ field value                                                                                   │
│ from tool                                                                                     │
│ input or                                                                                      │
│ hook input                                                                                    │
│ data.                                                                                         │
│                                                                                               │
│         Ar…                                                                                   │
│           …                                                                                   │
│ Field name                                                                                    │
│ like                                                                                          │
│ "command",                                                                                    │
│ "new_text",                                                                                   │
│ "file_path…                                                                                   │
│ "reason",                                                                                     │
│ "transcrip…                                                                                   │
│           …                                                                                   │
│ Tool being                                                                                    │
│ used (may                                                                                     │
│ be empty                                                                                      │
│ for Stop                                                                                      │
│ events)                                                                                       │
│           …                                                                                   │
│ Tool input                                                                                    │
│ dict                                                                                          │
│           …                                                                                   │
│ Full hook                                                                                     │
│ input (for                                                                                    │
│ accessing                                                                                     │
│ transcript…                                                                                   │
│ reason,                                                                                       │
│ etc.)                                                                                         │
│                                                                                               │
│         Re…                                                                                   │
│           …                                                                                   │
│ value as                                                                                      │
│ string, or                                                                                    │
│ None if not                                                                                   │
│ found                                                                                         │
│         """                                                                                   │
│         #                                                                                     │
│ Direct                                                                                        │
│ tool_input                                                                                    │
│ fields                                                                                        │
│         if                                                                                    │
│ field in                                                                                      │
│ tool_input:                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ tool_input…                                                                                   │
│           …                                                                                   │
│ isinstance…                                                                                   │
│ str):                                                                                         │
│           …                                                                                   │
│ value                                                                                         │
│           …                                                                                   │
│ str(value)                                                                                    │
│                                                                                               │
│         #                                                                                     │
│ For Stop                                                                                      │
│ events and                                                                                    │
│ other                                                                                         │
│ non-tool                                                                                      │
│ events,                                                                                       │
│ check                                                                                         │
│ input_data                                                                                    │
│         if                                                                                    │
│ input_data:                                                                                   │
│           …                                                                                   │
│ Stop event                                                                                    │
│ specific                                                                                      │
│ fields                                                                                        │
│           …                                                                                   │
│ field ==                                                                                      │
│ 'reason':                                                                                     │
│           …                                                                                   │
│ input_data…                                                                                   │
│ '')                                                                                           │
│           …                                                                                   │
│ field ==                                                                                      │
│ 'transcrip…                                                                                   │
│           …                                                                                   │
│ Read                                                                                          │
│ transcript                                                                                    │
│ file if                                                                                       │
│ path                                                                                          │
│ provided                                                                                      │
│           …                                                                                   │
│ =                                                                                             │
│ input_data…                                                                                   │
│           …                                                                                   │
│ transcript…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ open(trans…                                                                                   │
│ 'r') as f:                                                                                    │
│           …                                                                                   │
│ f.read()                                                                                      │
│           …                                                                                   │
│ FileNotFou…                                                                                   │
│           …                                                                                   │
│ Transcript                                                                                    │
│ file not                                                                                      │
│ found:                                                                                        │
│ {transcrip…                                                                                   │
│ file=sys.s…                                                                                   │
│           …                                                                                   │
│ ''                                                                                            │
│           …                                                                                   │
│ Permission…                                                                                   │
│           …                                                                                   │
│ Permission                                                                                    │
│ denied                                                                                        │
│ reading                                                                                       │
│ transcript:                                                                                   │
│ {transcrip…                                                                                   │
│ file=sys.s…                                                                                   │
│           …                                                                                   │
│ ''                                                                                            │
│           …                                                                                   │
│ (IOError,                                                                                     │
│ OSError) as                                                                                   │
│ e:                                                                                            │
│           …                                                                                   │
│ Error                                                                                         │
│ reading                                                                                       │
│ transcript                                                                                    │
│ {transcrip…                                                                                   │
│ {e}",                                                                                         │
│ file=sys.s…                                                                                   │
│           …                                                                                   │
│ ''                                                                                            │
│           …                                                                                   │
│ UnicodeDec…                                                                                   │
│ as e:                                                                                         │
│           …                                                                                   │
│ Encoding                                                                                      │
│ error in                                                                                      │
│ transcript                                                                                    │
│ {transcrip…                                                                                   │
│ {e}",                                                                                         │
│ file=sys.s…                                                                                   │
│           …                                                                                   │
│ ''                                                                                            │
│           …                                                                                   │
│ field ==                                                                                      │
│ 'user_prom…                                                                                   │
│           …                                                                                   │
│ For                                                                                           │
│ UserPrompt…                                                                                   │
│ events                                                                                        │
│           …                                                                                   │
│ input_data…                                                                                   │
│ '')                                                                                           │
│                                                                                               │
│         #                                                                                     │
│ Handle                                                                                        │
│ special                                                                                       │
│ cases by                                                                                      │
│ tool type                                                                                     │
│         if                                                                                    │
│ tool_name                                                                                     │
│ == 'Bash':                                                                                    │
│           …                                                                                   │
│ field ==                                                                                      │
│ 'command':                                                                                    │
│           …                                                                                   │
│ tool_input…                                                                                   │
│ '')                                                                                           │
│                                                                                               │
│         el…                                                                                   │
│ tool_name                                                                                     │
│ in                                                                                            │
│ ['Write',                                                                                     │
│ 'Edit']:                                                                                      │
│           …                                                                                   │
│ field ==                                                                                      │
│ 'content':                                                                                    │
│           …                                                                                   │
│ Write uses                                                                                    │
│ 'content',                                                                                    │
│ Edit has                                                                                      │
│ 'new_strin…                                                                                   │
│           …                                                                                   │
│ tool_input…                                                                                   │
│ or                                                                                            │
│ tool_input…                                                                                   │
│ '')                                                                                           │
│           …                                                                                   │
│ field ==                                                                                      │
│ 'new_text'                                                                                    │
│ or field ==                                                                                   │
│ 'new_strin…                                                                                   │
│           …                                                                                   │
│ tool_input…                                                                                   │
│ '')                                                                                           │
│           …                                                                                   │
│ field ==                                                                                      │
│ 'old_text'                                                                                    │
│ or field ==                                                                                   │
│ 'old_strin…                                                                                   │
│           …                                                                                   │
│ tool_input…                                                                                   │
│ '')                                                                                           │
│           …                                                                                   │
│ field ==                                                                                      │
│ 'file_path…                                                                                   │
│           …                                                                                   │
│ tool_input…                                                                                   │
│ '')                                                                                           │
│                                                                                               │
│         el…                                                                                   │
│ tool_name                                                                                     │
│ ==                                                                                            │
│ 'MultiEdit…                                                                                   │
│           …                                                                                   │
│ field ==                                                                                      │
│ 'file_path…                                                                                   │
│           …                                                                                   │
│ tool_input…                                                                                   │
│ '')                                                                                           │
│           …                                                                                   │
│ field in                                                                                      │
│ ['new_text…                                                                                   │
│ 'content']:                                                                                   │
│           …                                                                                   │
│ Concatenate                                                                                   │
│ all edits                                                                                     │
│           …                                                                                   │
│ =                                                                                             │
│ tool_input…                                                                                   │
│ [])                                                                                           │
│           …                                                                                   │
│ '                                                                                             │
│ '.join(e.g…                                                                                   │
│ '') for e                                                                                     │
│ in edits)                                                                                     │
│                                                                                               │
│         re…                                                                                   │
│ None                                                                                          │
│                                                                                               │
│     def                                                                                       │
│ _regex_mat…                                                                                   │
│ pattern:                                                                                      │
│ str, text:                                                                                    │
│ str) ->                                                                                       │
│ bool:                                                                                         │
│         ""…                                                                                   │
│ if pattern                                                                                    │
│ matches                                                                                       │
│ text using                                                                                    │
│ regex.                                                                                        │
│                                                                                               │
│         Ar…                                                                                   │
│           …                                                                                   │
│ Regex                                                                                         │
│ pattern                                                                                       │
│           …                                                                                   │
│ Text to                                                                                       │
│ match                                                                                         │
│ against                                                                                       │
│                                                                                               │
│         Re…                                                                                   │
│           …                                                                                   │
│ if pattern                                                                                    │
│ matches                                                                                       │
│         """                                                                                   │
│         tr…                                                                                   │
│           …                                                                                   │
│ Use cached                                                                                    │
│ compiled                                                                                      │
│ regex (LRU                                                                                    │
│ cache with                                                                                    │
│ max 128                                                                                       │
│ patterns)                                                                                     │
│           …                                                                                   │
│ =                                                                                             │
│ compile_re…                                                                                   │
│           …                                                                                   │
│ bool(regex…                                                                                   │
│                                                                                               │
│         ex…                                                                                   │
│ re.error as                                                                                   │
│ e:                                                                                            │
│           …                                                                                   │
│ regex                                                                                         │
│ pattern                                                                                       │
│ '{pattern}…                                                                                   │
│ {e}",                                                                                         │
│ file=sys.s…                                                                                   │
│           …                                                                                   │
│ False                                                                                         │
│                                                                                               │
│                                                                                               │
│ # For                                                                                         │
│ testing                                                                                       │
│ if __name__                                                                                   │
│ ==                                                                                            │
│ '__main__':                                                                                   │
│     from                                                                                      │
│ core.confi…                                                                                   │
│ import                                                                                        │
│ Condition,                                                                                    │
│ Rule                                                                                          │
│                                                                                               │
│     # Test                                                                                    │
│ rule                                                                                          │
│ evaluation                                                                                    │
│     rule =                                                                                    │
│ Rule(                                                                                         │
│         na…                                                                                   │
│         en…                                                                                   │
│         ev…                                                                                   │
│         co…                                                                                   │
│           …                                                                                   │
│ operator="…                                                                                   │
│ pattern=r"…                                                                                   │
│         ],                                                                                    │
│         me…                                                                                   │
│ rm                                                                                            │
│ command!"                                                                                     │
│     )                                                                                         │
│                                                                                               │
│     engine                                                                                    │
│ =                                                                                             │
│ RuleEngine…                                                                                   │
│                                                                                               │
│     # Test                                                                                    │
│ matching                                                                                      │
│ input                                                                                         │
│     test_i…                                                                                   │
│ = {                                                                                           │
│         "t…                                                                                   │
│ "Bash",                                                                                       │
│         "t…                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ "rm -rf                                                                                       │
│ /tmp/test"                                                                                    │
│         }                                                                                     │
│     }                                                                                         │
│                                                                                               │
│     result                                                                                    │
│ =                                                                                             │
│ engine.eva…                                                                                   │
│ test_input)                                                                                   │
│     print(…                                                                                   │
│ result:",                                                                                     │
│ result)                                                                                       │
│                                                                                               │
│     # Test                                                                                    │
│ non-matchi…                                                                                   │
│ input                                                                                         │
│     test_i…                                                                                   │
│ = {                                                                                           │
│         "t…                                                                                   │
│ "Bash",                                                                                       │
│         "t…                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ "ls -la"                                                                                      │
│         }                                                                                     │
│     }                                                                                         │
│                                                                                               │
│     result2                                                                                   │
│ =                                                                                             │
│ engine.eva…                                                                                   │
│ test_input…                                                                                   │
│     print(…                                                                                   │
│ result:",                                                                                     │
│ result2)                                                                                      │
│                                                                                               │
│ ```                                                                                           │
│                                                                                               │
│ ## FILE:                                                                                      │
│ plugins/ma…                                                                                   │
│ ```py                                                                                         │
│ #!/usr/bin…                                                                                   │
│ python3                                                                                       │
│ """PostToo…                                                                                   │
│ hook                                                                                          │
│ executor                                                                                      │
│ for hookify                                                                                   │
│ plugin.                                                                                       │
│                                                                                               │
│ This script                                                                                   │
│ is called                                                                                     │
│ by Claude                                                                                     │
│ Code after                                                                                    │
│ a tool                                                                                        │
│ executes.                                                                                     │
│ It reads                                                                                      │
│ .claude/ho…                                                                                   │
│ files and                                                                                     │
│ evaluates                                                                                     │
│ rules.                                                                                        │
│ """                                                                                           │
│                                                                                               │
│ import os                                                                                     │
│ import sys                                                                                    │
│ import json                                                                                   │
│                                                                                               │
│ # Add                                                                                         │
│ plugin root                                                                                   │
│ to Python                                                                                     │
│ path for                                                                                      │
│ imports                                                                                       │
│ PLUGIN_ROOT                                                                                   │
│ =                                                                                             │
│ os.environ…                                                                                   │
│ if                                                                                            │
│ PLUGIN_ROOT                                                                                   │
│ and                                                                                           │
│ PLUGIN_ROOT                                                                                   │
│ not in                                                                                        │
│ sys.path:                                                                                     │
│     sys.pa…                                                                                   │
│ PLUGIN_ROO…                                                                                   │
│                                                                                               │
│ try:                                                                                          │
│     from                                                                                      │
│ core.confi…                                                                                   │
│ import                                                                                        │
│ load_rules                                                                                    │
│     from                                                                                      │
│ core.rule_…                                                                                   │
│ import                                                                                        │
│ RuleEngine                                                                                    │
│ except                                                                                        │
│ ImportError                                                                                   │
│ as e:                                                                                         │
│     error_…                                                                                   │
│ =                                                                                             │
│ {"systemMe…                                                                                   │
│ f"Hookify                                                                                     │
│ import                                                                                        │
│ error:                                                                                        │
│ {e}"}                                                                                         │
│     print(…                                                                                   │
│ file=sys.s…                                                                                   │
│     sys.ex…                                                                                   │
│                                                                                               │
│                                                                                               │
│ def main():                                                                                   │
│     """Main                                                                                   │
│ entry point                                                                                   │
│ for                                                                                           │
│ PostToolUse                                                                                   │
│ hook."""                                                                                      │
│     try:                                                                                      │
│         #                                                                                     │
│ Read input                                                                                    │
│ from stdin                                                                                    │
│         in…                                                                                   │
│ =                                                                                             │
│ json.load(…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Determine                                                                                     │
│ event type                                                                                    │
│ based on                                                                                      │
│ tool                                                                                          │
│         to…                                                                                   │
│ =                                                                                             │
│ input_data…                                                                                   │
│ '')                                                                                           │
│         ev…                                                                                   │
│ = None                                                                                        │
│         if                                                                                    │
│ tool_name                                                                                     │
│ == 'Bash':                                                                                    │
│           …                                                                                   │
│ = 'bash'                                                                                      │
│         el…                                                                                   │
│ tool_name                                                                                     │
│ in ['Edit',                                                                                   │
│ 'Write',                                                                                      │
│ 'MultiEdit…                                                                                   │
│           …                                                                                   │
│ = 'file'                                                                                      │
│                                                                                               │
│         #                                                                                     │
│ Load rules                                                                                    │
│         ru…                                                                                   │
│ =                                                                                             │
│ load_rules…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Evaluate                                                                                      │
│ rules                                                                                         │
│         en…                                                                                   │
│ =                                                                                             │
│ RuleEngine…                                                                                   │
│         re…                                                                                   │
│ =                                                                                             │
│ engine.eva…                                                                                   │
│ input_data)                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Always                                                                                        │
│ output JSON                                                                                   │
│ (even if                                                                                      │
│ empty)                                                                                        │
│         pr…                                                                                   │
│ file=sys.s…                                                                                   │
│                                                                                               │
│     except                                                                                    │
│ Exception                                                                                     │
│ as e:                                                                                         │
│         er…                                                                                   │
│ = {                                                                                           │
│           …                                                                                   │
│ f"Hookify                                                                                     │
│ error:                                                                                        │
│ {str(e)}"                                                                                     │
│         }                                                                                     │
│         pr…                                                                                   │
│ file=sys.s…                                                                                   │
│                                                                                               │
│     finall…                                                                                   │
│         #                                                                                     │
│ ALWAYS exit                                                                                   │
│ 0                                                                                             │
│         sy…                                                                                   │
│                                                                                               │
│                                                                                               │
│ if __name__                                                                                   │
│ ==                                                                                            │
│ '__main__':                                                                                   │
│     main()                                                                                    │
│                                                                                               │
│ ```                                                                                           │
│                                                                                               │
│ ## FILE:                                                                                      │
│ plugins/ma…                                                                                   │
│ ```py                                                                                         │
│ #!/usr/bin…                                                                                   │
│ python3                                                                                       │
│ """PreTool…                                                                                   │
│ hook                                                                                          │
│ executor                                                                                      │
│ for hookify                                                                                   │
│ plugin.                                                                                       │
│                                                                                               │
│ This script                                                                                   │
│ is called                                                                                     │
│ by Claude                                                                                     │
│ Code before                                                                                   │
│ any tool                                                                                      │
│ executes.                                                                                     │
│ It reads                                                                                      │
│ .claude/ho…                                                                                   │
│ files and                                                                                     │
│ evaluates                                                                                     │
│ rules.                                                                                        │
│ """                                                                                           │
│                                                                                               │
│ import os                                                                                     │
│ import sys                                                                                    │
│ import json                                                                                   │
│                                                                                               │
│ # Add                                                                                         │
│ plugin root                                                                                   │
│ to Python                                                                                     │
│ path for                                                                                      │
│ imports                                                                                       │
│ PLUGIN_ROOT                                                                                   │
│ =                                                                                             │
│ os.environ…                                                                                   │
│ if                                                                                            │
│ PLUGIN_ROOT                                                                                   │
│ and                                                                                           │
│ PLUGIN_ROOT                                                                                   │
│ not in                                                                                        │
│ sys.path:                                                                                     │
│     sys.pa…                                                                                   │
│ PLUGIN_ROO…                                                                                   │
│                                                                                               │
│ try:                                                                                          │
│     from                                                                                      │
│ core.confi…                                                                                   │
│ import                                                                                        │
│ load_rules                                                                                    │
│     from                                                                                      │
│ core.rule_…                                                                                   │
│ import                                                                                        │
│ RuleEngine                                                                                    │
│ except                                                                                        │
│ ImportError                                                                                   │
│ as e:                                                                                         │
│     # If                                                                                      │
│ imports                                                                                       │
│ fail, allow                                                                                   │
│ operation                                                                                     │
│ and log                                                                                       │
│ error                                                                                         │
│     error_…                                                                                   │
│ =                                                                                             │
│ {"systemMe…                                                                                   │
│ f"Hookify                                                                                     │
│ import                                                                                        │
│ error:                                                                                        │
│ {e}"}                                                                                         │
│     print(…                                                                                   │
│ file=sys.s…                                                                                   │
│     sys.ex…                                                                                   │
│                                                                                               │
│                                                                                               │
│ def main():                                                                                   │
│     """Main                                                                                   │
│ entry point                                                                                   │
│ for                                                                                           │
│ PreToolUse                                                                                    │
│ hook."""                                                                                      │
│     try:                                                                                      │
│         #                                                                                     │
│ Read input                                                                                    │
│ from stdin                                                                                    │
│         in…                                                                                   │
│ =                                                                                             │
│ json.load(…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Determine                                                                                     │
│ event type                                                                                    │
│ for                                                                                           │
│ filtering                                                                                     │
│         #                                                                                     │
│ For                                                                                           │
│ PreToolUse,                                                                                   │
│ we use                                                                                        │
│ tool_name                                                                                     │
│ to                                                                                            │
│ determine                                                                                     │
│ "bash" vs                                                                                     │
│ "file"                                                                                        │
│ event                                                                                         │
│         to…                                                                                   │
│ =                                                                                             │
│ input_data…                                                                                   │
│ '')                                                                                           │
│                                                                                               │
│         ev…                                                                                   │
│ = None                                                                                        │
│         if                                                                                    │
│ tool_name                                                                                     │
│ == 'Bash':                                                                                    │
│           …                                                                                   │
│ = 'bash'                                                                                      │
│         el…                                                                                   │
│ tool_name                                                                                     │
│ in ['Edit',                                                                                   │
│ 'Write',                                                                                      │
│ 'MultiEdit…                                                                                   │
│           …                                                                                   │
│ = 'file'                                                                                      │
│                                                                                               │
│         #                                                                                     │
│ Load rules                                                                                    │
│         ru…                                                                                   │
│ =                                                                                             │
│ load_rules…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Evaluate                                                                                      │
│ rules                                                                                         │
│         en…                                                                                   │
│ =                                                                                             │
│ RuleEngine…                                                                                   │
│         re…                                                                                   │
│ =                                                                                             │
│ engine.eva…                                                                                   │
│ input_data)                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Always                                                                                        │
│ output JSON                                                                                   │
│ (even if                                                                                      │
│ empty)                                                                                        │
│         pr…                                                                                   │
│ file=sys.s…                                                                                   │
│                                                                                               │
│     except                                                                                    │
│ Exception                                                                                     │
│ as e:                                                                                         │
│         #                                                                                     │
│ On any                                                                                        │
│ error,                                                                                        │
│ allow the                                                                                     │
│ operation                                                                                     │
│ and log                                                                                       │
│         er…                                                                                   │
│ = {                                                                                           │
│           …                                                                                   │
│ f"Hookify                                                                                     │
│ error:                                                                                        │
│ {str(e)}"                                                                                     │
│         }                                                                                     │
│         pr…                                                                                   │
│ file=sys.s…                                                                                   │
│                                                                                               │
│     finall…                                                                                   │
│         #                                                                                     │
│ ALWAYS exit                                                                                   │
│ 0 - never                                                                                     │
│ block                                                                                         │
│ operations                                                                                    │
│ due to hook                                                                                   │
│ errors                                                                                        │
│         sy…                                                                                   │
│                                                                                               │
│                                                                                               │
│ if __name__                                                                                   │
│ ==                                                                                            │
│ '__main__':                                                                                   │
│     main()                                                                                    │
│                                                                                               │
│ ```                                                                                           │
│                                                                                               │
│ ## FILE:                                                                                      │
│ plugins/ma…                                                                                   │
│ ```py                                                                                         │
│ #!/usr/bin…                                                                                   │
│ python3                                                                                       │
│ """Stop                                                                                       │
│ hook                                                                                          │
│ executor                                                                                      │
│ for hookify                                                                                   │
│ plugin.                                                                                       │
│                                                                                               │
│ This script                                                                                   │
│ is called                                                                                     │
│ by Claude                                                                                     │
│ Code when                                                                                     │
│ agent wants                                                                                   │
│ to stop.                                                                                      │
│ It reads                                                                                      │
│ .claude/ho…                                                                                   │
│ files and                                                                                     │
│ evaluates                                                                                     │
│ stop rules.                                                                                   │
│ """                                                                                           │
│                                                                                               │
│ import os                                                                                     │
│ import sys                                                                                    │
│ import json                                                                                   │
│                                                                                               │
│ # Add                                                                                         │
│ plugin root                                                                                   │
│ to Python                                                                                     │
│ path for                                                                                      │
│ imports                                                                                       │
│ PLUGIN_ROOT                                                                                   │
│ =                                                                                             │
│ os.environ…                                                                                   │
│ if                                                                                            │
│ PLUGIN_ROOT                                                                                   │
│ and                                                                                           │
│ PLUGIN_ROOT                                                                                   │
│ not in                                                                                        │
│ sys.path:                                                                                     │
│     sys.pa…                                                                                   │
│ PLUGIN_ROO…                                                                                   │
│                                                                                               │
│ try:                                                                                          │
│     from                                                                                      │
│ core.confi…                                                                                   │
│ import                                                                                        │
│ load_rules                                                                                    │
│     from                                                                                      │
│ core.rule_…                                                                                   │
│ import                                                                                        │
│ RuleEngine                                                                                    │
│ except                                                                                        │
│ ImportError                                                                                   │
│ as e:                                                                                         │
│     error_…                                                                                   │
│ =                                                                                             │
│ {"systemMe…                                                                                   │
│ f"Hookify                                                                                     │
│ import                                                                                        │
│ error:                                                                                        │
│ {e}"}                                                                                         │
│     print(…                                                                                   │
│ file=sys.s…                                                                                   │
│     sys.ex…                                                                                   │
│                                                                                               │
│                                                                                               │
│ def main():                                                                                   │
│     """Main                                                                                   │
│ entry point                                                                                   │
│ for Stop                                                                                      │
│ hook."""                                                                                      │
│     try:                                                                                      │
│         #                                                                                     │
│ Read input                                                                                    │
│ from stdin                                                                                    │
│         in…                                                                                   │
│ =                                                                                             │
│ json.load(…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Load stop                                                                                     │
│ rules                                                                                         │
│         ru…                                                                                   │
│ =                                                                                             │
│ load_rules…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Evaluate                                                                                      │
│ rules                                                                                         │
│         en…                                                                                   │
│ =                                                                                             │
│ RuleEngine…                                                                                   │
│         re…                                                                                   │
│ =                                                                                             │
│ engine.eva…                                                                                   │
│ input_data)                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Always                                                                                        │
│ output JSON                                                                                   │
│ (even if                                                                                      │
│ empty)                                                                                        │
│         pr…                                                                                   │
│ file=sys.s…                                                                                   │
│                                                                                               │
│     except                                                                                    │
│ Exception                                                                                     │
│ as e:                                                                                         │
│         #                                                                                     │
│ On any                                                                                        │
│ error,                                                                                        │
│ allow the                                                                                     │
│ operation                                                                                     │
│         er…                                                                                   │
│ = {                                                                                           │
│           …                                                                                   │
│ f"Hookify                                                                                     │
│ error:                                                                                        │
│ {str(e)}"                                                                                     │
│         }                                                                                     │
│         pr…                                                                                   │
│ file=sys.s…                                                                                   │
│                                                                                               │
│     finall…                                                                                   │
│         #                                                                                     │
│ ALWAYS exit                                                                                   │
│ 0                                                                                             │
│         sy…                                                                                   │
│                                                                                               │
│                                                                                               │
│ if __name__                                                                                   │
│ ==                                                                                            │
│ '__main__':                                                                                   │
│     main()                                                                                    │
│                                                                                               │
│ ```                                                                                           │
│                                                                                               │
│ ## FILE:                                                                                      │
│ plugins/ma…                                                                                   │
│ ```py                                                                                         │
│ #!/usr/bin…                                                                                   │
│ python3                                                                                       │
│ """UserPro…                                                                                   │
│ hook                                                                                          │
│ executor                                                                                      │
│ for hookify                                                                                   │
│ plugin.                                                                                       │
│                                                                                               │
│ This script                                                                                   │
│ is called                                                                                     │
│ by Claude                                                                                     │
│ Code when                                                                                     │
│ user                                                                                          │
│ submits a                                                                                     │
│ prompt.                                                                                       │
│ It reads                                                                                      │
│ .claude/ho…                                                                                   │
│ files and                                                                                     │
│ evaluates                                                                                     │
│ rules.                                                                                        │
│ """                                                                                           │
│                                                                                               │
│ import os                                                                                     │
│ import sys                                                                                    │
│ import json                                                                                   │
│                                                                                               │
│ # Add                                                                                         │
│ plugin root                                                                                   │
│ to Python                                                                                     │
│ path for                                                                                      │
│ imports                                                                                       │
│ PLUGIN_ROOT                                                                                   │
│ =                                                                                             │
│ os.environ…                                                                                   │
│ if                                                                                            │
│ PLUGIN_ROOT                                                                                   │
│ and                                                                                           │
│ PLUGIN_ROOT                                                                                   │
│ not in                                                                                        │
│ sys.path:                                                                                     │
│     sys.pa…                                                                                   │
│ PLUGIN_ROO…                                                                                   │
│                                                                                               │
│ try:                                                                                          │
│     from                                                                                      │
│ core.confi…                                                                                   │
│ import                                                                                        │
│ load_rules                                                                                    │
│     from                                                                                      │
│ core.rule_…                                                                                   │
│ import                                                                                        │
│ RuleEngine                                                                                    │
│ except                                                                                        │
│ ImportError                                                                                   │
│ as e:                                                                                         │
│     error_…                                                                                   │
│ =                                                                                             │
│ {"systemMe…                                                                                   │
│ f"Hookify                                                                                     │
│ import                                                                                        │
│ error:                                                                                        │
│ {e}"}                                                                                         │
│     print(…                                                                                   │
│ file=sys.s…                                                                                   │
│     sys.ex…                                                                                   │
│                                                                                               │
│                                                                                               │
│ def main():                                                                                   │
│     """Main                                                                                   │
│ entry point                                                                                   │
│ for                                                                                           │
│ UserPrompt…                                                                                   │
│ hook."""                                                                                      │
│     try:                                                                                      │
│         #                                                                                     │
│ Read input                                                                                    │
│ from stdin                                                                                    │
│         in…                                                                                   │
│ =                                                                                             │
│ json.load(…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Load user                                                                                     │
│ prompt                                                                                        │
│ rules                                                                                         │
│         ru…                                                                                   │
│ =                                                                                             │
│ load_rules…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Evaluate                                                                                      │
│ rules                                                                                         │
│         en…                                                                                   │
│ =                                                                                             │
│ RuleEngine…                                                                                   │
│         re…                                                                                   │
│ =                                                                                             │
│ engine.eva…                                                                                   │
│ input_data)                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Always                                                                                        │
│ output JSON                                                                                   │
│ (even if                                                                                      │
│ empty)                                                                                        │
│         pr…                                                                                   │
│ file=sys.s…                                                                                   │
│                                                                                               │
│     except                                                                                    │
│ Exception                                                                                     │
│ as e:                                                                                         │
│         er…                                                                                   │
│ = {                                                                                           │
│           …                                                                                   │
│ f"Hookify                                                                                     │
│ error:                                                                                        │
│ {str(e)}"                                                                                     │
│         }                                                                                     │
│         pr…                                                                                   │
│ file=sys.s…                                                                                   │
│                                                                                               │
│     finall…                                                                                   │
│         #                                                                                     │
│ ALWAYS exit                                                                                   │
│ 0                                                                                             │
│         sy…                                                                                   │
│                                                                                               │
│                                                                                               │
│ if __name__                                                                                   │
│ ==                                                                                            │
│ '__main__':                                                                                   │
│     main()                                                                                    │
│                                                                                               │
│ ```                                                                                           │
│                                                                                               │
│ ## FILE:                                                                                      │
│ plugins/ma…                                                                                   │
│ ```py                                                                                         │
│ #!/usr/bin…                                                                                   │
│ python3                                                                                       │
│ """                                                                                           │
│ Security                                                                                      │
│ Reminder                                                                                      │
│ Hook for                                                                                      │
│ Claude Code                                                                                   │
│ This hook                                                                                     │
│ checks for                                                                                    │
│ security                                                                                      │
│ patterns in                                                                                   │
│ file edits                                                                                    │
│ and warns                                                                                     │
│ about                                                                                         │
│ potential                                                                                     │
│ vulnerabil…                                                                                   │
│ """                                                                                           │
│                                                                                               │
│ import json                                                                                   │
│ import os                                                                                     │
│ import                                                                                        │
│ random                                                                                        │
│ import sys                                                                                    │
│ from                                                                                          │
│ datetime                                                                                      │
│ import                                                                                        │
│ datetime                                                                                      │
│                                                                                               │
│ # Debug log                                                                                   │
│ file                                                                                          │
│ DEBUG_LOG_…                                                                                   │
│ =                                                                                             │
│ "/tmp/secu…                                                                                   │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ debug_log(…                                                                                   │
│     """App…                                                                                   │
│ debug                                                                                         │
│ message to                                                                                    │
│ log file                                                                                      │
│ with                                                                                          │
│ timestamp.…                                                                                   │
│     try:                                                                                      │
│         ti…                                                                                   │
│ =                                                                                             │
│ datetime.n…                                                                                   │
│ %H:%M:%S.%…                                                                                   │
│         wi…                                                                                   │
│ open(DEBUG…                                                                                   │
│ "a") as f:                                                                                    │
│           …                                                                                   │
│ {message}\…                                                                                   │
│     except                                                                                    │
│ Exception                                                                                     │
│ as e:                                                                                         │
│         #                                                                                     │
│ Silently                                                                                      │
│ ignore                                                                                        │
│ logging                                                                                       │
│ errors to                                                                                     │
│ avoid                                                                                         │
│ disrupting                                                                                    │
│ the hook                                                                                      │
│         pa…                                                                                   │
│                                                                                               │
│                                                                                               │
│ # State                                                                                       │
│ file to                                                                                       │
│ track                                                                                         │
│ warnings                                                                                      │
│ shown                                                                                         │
│ (session-s…                                                                                   │
│ using                                                                                         │
│ session ID)                                                                                   │
│                                                                                               │
│ # Security                                                                                    │
│ patterns                                                                                      │
│ configurat…                                                                                   │
│ SECURITY_P…                                                                                   │
│ = [                                                                                           │
│     {                                                                                         │
│         "r…                                                                                   │
│ "github_ac…                                                                                   │
│         "p…                                                                                   │
│ lambda                                                                                        │
│ path:                                                                                         │
│ ".github/w…                                                                                   │
│ in path                                                                                       │
│         and                                                                                   │
│ (path.ends…                                                                                   │
│ or                                                                                            │
│ path.endsw…                                                                                   │
│         "r…                                                                                   │
│ """You are                                                                                    │
│ editing a                                                                                     │
│ GitHub                                                                                        │
│ Actions                                                                                       │
│ workflow                                                                                      │
│ file. Be                                                                                      │
│ aware of                                                                                      │
│ these                                                                                         │
│ security                                                                                      │
│ risks:                                                                                        │
│                                                                                               │
│ 1.                                                                                            │
│ **Command                                                                                     │
│ Injection*…                                                                                   │
│ Never use                                                                                     │
│ untrusted                                                                                     │
│ input (like                                                                                   │
│ issue                                                                                         │
│ titles, PR                                                                                    │
│ descriptio…                                                                                   │
│ commit                                                                                        │
│ messages)                                                                                     │
│ directly in                                                                                   │
│ run:                                                                                          │
│ commands                                                                                      │
│ without                                                                                       │
│ proper                                                                                        │
│ escaping                                                                                      │
│ 2. **Use                                                                                      │
│ environment                                                                                   │
│ variables*…                                                                                   │
│ Instead of                                                                                    │
│ ${{                                                                                           │
│ github.eve…                                                                                   │
│ }}, use                                                                                       │
│ env: with                                                                                     │
│ proper                                                                                        │
│ quoting                                                                                       │
│ 3. **Review                                                                                   │
│ the                                                                                           │
│ guide**:                                                                                      │
│ https://gi…                                                                                   │
│                                                                                               │
│ Example of                                                                                    │
│ UNSAFE                                                                                        │
│ pattern to                                                                                    │
│ avoid:                                                                                        │
│ run: echo                                                                                     │
│ "${{                                                                                          │
│ github.eve…                                                                                   │
│ }}"                                                                                           │
│                                                                                               │
│ Example of                                                                                    │
│ SAFE                                                                                          │
│ pattern:                                                                                      │
│ env:                                                                                          │
│   TITLE:                                                                                      │
│ ${{                                                                                           │
│ github.eve…                                                                                   │
│ }}                                                                                            │
│ run: echo                                                                                     │
│ "$TITLE"                                                                                      │
│                                                                                               │
│ Other risky                                                                                   │
│ inputs to                                                                                     │
│ be careful                                                                                    │
│ with:                                                                                         │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.eve…                                                                                   │
│ -                                                                                             │
│ github.hea…                                                                                   │
│     },                                                                                        │
│     {                                                                                         │
│         "r…                                                                                   │
│ "child_pro…                                                                                   │
│         "s…                                                                                   │
│ ["child_pr…                                                                                   │
│ "exec(",                                                                                      │
│ "execSync(…                                                                                   │
│         "r…                                                                                   │
│ """⚠️                                                                                          │
│ Security                                                                                      │
│ Warning:                                                                                      │
│ Using                                                                                         │
│ child_proc…                                                                                   │
│ can lead to                                                                                   │
│ command                                                                                       │
│ injection                                                                                     │
│ vulnerabil…                                                                                   │
│                                                                                               │
│ This                                                                                          │
│ codebase                                                                                      │
│ provides a                                                                                    │
│ safer                                                                                         │
│ alternativ…                                                                                   │
│ src/utils/…                                                                                   │
│                                                                                               │
│ Instead of:                                                                                   │
│   exec(`co…                                                                                   │
│ ${userInpu…                                                                                   │
│                                                                                               │
│ Use:                                                                                          │
│   import {                                                                                    │
│ execFileNo…                                                                                   │
│ } from                                                                                        │
│ '../utils/…                                                                                   │
│   await                                                                                       │
│ execFileNo…                                                                                   │
│ [userInput…                                                                                   │
│                                                                                               │
│ The                                                                                           │
│ execFileNo…                                                                                   │
│ utility:                                                                                      │
│ - Uses                                                                                        │
│ execFile                                                                                      │
│ instead of                                                                                    │
│ exec                                                                                          │
│ (prevents                                                                                     │
│ shell                                                                                         │
│ injection)                                                                                    │
│ - Handles                                                                                     │
│ Windows                                                                                       │
│ compatibil…                                                                                   │
│ automatica…                                                                                   │
│ - Provides                                                                                    │
│ proper                                                                                        │
│ error                                                                                         │
│ handling                                                                                      │
│ - Returns                                                                                     │
│ structured                                                                                    │
│ output with                                                                                   │
│ stdout,                                                                                       │
│ stderr, and                                                                                   │
│ status                                                                                        │
│                                                                                               │
│ Only use                                                                                      │
│ exec() if                                                                                     │
│ you                                                                                           │
│ absolutely                                                                                    │
│ need shell                                                                                    │
│ features                                                                                      │
│ and the                                                                                       │
│ input is                                                                                      │
│ guaranteed                                                                                    │
│ to be                                                                                         │
│ safe.""",                                                                                     │
│     },                                                                                        │
│     {                                                                                         │
│         "r…                                                                                   │
│ "new_funct…                                                                                   │
│         "s…                                                                                   │
│ ["new                                                                                         │
│ Function"],                                                                                   │
│         "r…                                                                                   │
│ "⚠️ Security                                                                                   │
│ Warning:                                                                                      │
│ Using new                                                                                     │
│ Function()                                                                                    │
│ with                                                                                          │
│ dynamic                                                                                       │
│ strings can                                                                                   │
│ lead to                                                                                       │
│ code                                                                                          │
│ injection                                                                                     │
│ vulnerabil…                                                                                   │
│ Consider                                                                                      │
│ alternative                                                                                   │
│ approaches                                                                                    │
│ that don't                                                                                    │
│ evaluate                                                                                      │
│ arbitrary                                                                                     │
│ code. Only                                                                                    │
│ use new                                                                                       │
│ Function()                                                                                    │
│ if you                                                                                        │
│ truly need                                                                                    │
│ to evaluate                                                                                   │
│ arbitrary                                                                                     │
│ dynamic                                                                                       │
│ code.",                                                                                       │
│     },                                                                                        │
│     {                                                                                         │
│         "r…                                                                                   │
│ "eval_inje…                                                                                   │
│         "s…                                                                                   │
│ ["eval("],                                                                                    │
│         "r…                                                                                   │
│ "⚠️ Security                                                                                   │
│ Warning:                                                                                      │
│ eval()                                                                                        │
│ executes                                                                                      │
│ arbitrary                                                                                     │
│ code and is                                                                                   │
│ a major                                                                                       │
│ security                                                                                      │
│ risk.                                                                                         │
│ Consider                                                                                      │
│ using                                                                                         │
│ JSON.parse…                                                                                   │
│ for data                                                                                      │
│ parsing or                                                                                    │
│ alternative                                                                                   │
│ design                                                                                        │
│ patterns                                                                                      │
│ that don't                                                                                    │
│ require                                                                                       │
│ code                                                                                          │
│ evaluation.                                                                                   │
│ Only use                                                                                      │
│ eval() if                                                                                     │
│ you truly                                                                                     │
│ need to                                                                                       │
│ evaluate                                                                                      │
│ arbitrary                                                                                     │
│ code.",                                                                                       │
│     },                                                                                        │
│     {                                                                                         │
│         "r…                                                                                   │
│ "react_dan…                                                                                   │
│         "s…                                                                                   │
│ ["dangerou…                                                                                   │
│         "r…                                                                                   │
│ "⚠️ Security                                                                                   │
│ Warning:                                                                                      │
│ dangerousl…                                                                                   │
│ can lead to                                                                                   │
│ XSS                                                                                           │
│ vulnerabil…                                                                                   │
│ if used                                                                                       │
│ with                                                                                          │
│ untrusted                                                                                     │
│ content.                                                                                      │
│ Ensure all                                                                                    │
│ content is                                                                                    │
│ properly                                                                                      │
│ sanitized                                                                                     │
│ using an                                                                                      │
│ HTML                                                                                          │
│ sanitizer                                                                                     │
│ library                                                                                       │
│ like                                                                                          │
│ DOMPurify,                                                                                    │
│ or use safe                                                                                   │
│ alternativ…                                                                                   │
│     },                                                                                        │
│     {                                                                                         │
│         "r…                                                                                   │
│ "document_…                                                                                   │
│         "s…                                                                                   │
│ ["document…                                                                                   │
│         "r…                                                                                   │
│ "⚠️ Security                                                                                   │
│ Warning:                                                                                      │
│ document.w…                                                                                   │
│ can be                                                                                        │
│ exploited                                                                                     │
│ for XSS                                                                                       │
│ attacks and                                                                                   │
│ has                                                                                           │
│ performance                                                                                   │
│ issues. Use                                                                                   │
│ DOM                                                                                           │
│ manipulati…                                                                                   │
│ methods                                                                                       │
│ like                                                                                          │
│ createElem…                                                                                   │
│ and                                                                                           │
│ appendChil…                                                                                   │
│ instead.",                                                                                    │
│     },                                                                                        │
│     {                                                                                         │
│         "r…                                                                                   │
│ "innerHTML…                                                                                   │
│         "s…                                                                                   │
│ [".innerHT…                                                                                   │
│ =",                                                                                           │
│ ".innerHTM…                                                                                   │
│         "r…                                                                                   │
│ "⚠️ Security                                                                                   │
│ Warning:                                                                                      │
│ Setting                                                                                       │
│ innerHTML                                                                                     │
│ with                                                                                          │
│ untrusted                                                                                     │
│ content can                                                                                   │
│ lead to XSS                                                                                   │
│ vulnerabil…                                                                                   │
│ Use                                                                                           │
│ textContent                                                                                   │
│ for plain                                                                                     │
│ text or                                                                                       │
│ safe DOM                                                                                      │
│ methods for                                                                                   │
│ HTML                                                                                          │
│ content. If                                                                                   │
│ you need                                                                                      │
│ HTML                                                                                          │
│ support,                                                                                      │
│ consider                                                                                      │
│ using an                                                                                      │
│ HTML                                                                                          │
│ sanitizer                                                                                     │
│ library                                                                                       │
│ such as                                                                                       │
│ DOMPurify.…                                                                                   │
│     },                                                                                        │
│     {                                                                                         │
│         "r…                                                                                   │
│ "pickle_de…                                                                                   │
│         "s…                                                                                   │
│ ["pickle"],                                                                                   │
│         "r…                                                                                   │
│ "⚠️ Security                                                                                   │
│ Warning:                                                                                      │
│ Using                                                                                         │
│ pickle with                                                                                   │
│ untrusted                                                                                     │
│ content can                                                                                   │
│ lead to                                                                                       │
│ arbitrary                                                                                     │
│ code                                                                                          │
│ execution.                                                                                    │
│ Consider                                                                                      │
│ using JSON                                                                                    │
│ or other                                                                                      │
│ safe                                                                                          │
│ serializat…                                                                                   │
│ formats                                                                                       │
│ instead.                                                                                      │
│ Only use                                                                                      │
│ pickle if                                                                                     │
│ it is                                                                                         │
│ explicitly                                                                                    │
│ needed or                                                                                     │
│ requested                                                                                     │
│ by the                                                                                        │
│ user.",                                                                                       │
│     },                                                                                        │
│     {                                                                                         │
│         "r…                                                                                   │
│ "os_system…                                                                                   │
│         "s…                                                                                   │
│ ["os.syste…                                                                                   │
│ "from os                                                                                      │
│ import                                                                                        │
│ system"],                                                                                     │
│         "r…                                                                                   │
│ "⚠️ Security                                                                                   │
│ Warning:                                                                                      │
│ This code                                                                                     │
│ appears to                                                                                    │
│ use                                                                                           │
│ os.system.                                                                                    │
│ This should                                                                                   │
│ only be                                                                                       │
│ used with                                                                                     │
│ static                                                                                        │
│ arguments                                                                                     │
│ and never                                                                                     │
│ with                                                                                          │
│ arguments                                                                                     │
│ that could                                                                                    │
│ be                                                                                            │
│ user-contr…                                                                                   │
│     },                                                                                        │
│ ]                                                                                             │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ get_state_…                                                                                   │
│     """Get                                                                                    │
│ session-sp…                                                                                   │
│ state file                                                                                    │
│ path."""                                                                                      │
│     return                                                                                    │
│ os.path.ex…                                                                                   │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ cleanup_ol…                                                                                   │
│     """Rem…                                                                                   │
│ state files                                                                                   │
│ older than                                                                                    │
│ 30 days."""                                                                                   │
│     try:                                                                                      │
│         st…                                                                                   │
│ =                                                                                             │
│ os.path.ex…                                                                                   │
│         if                                                                                    │
│ not                                                                                           │
│ os.path.ex…                                                                                   │
│           …                                                                                   │
│                                                                                               │
│         cu…                                                                                   │
│ =                                                                                             │
│ datetime.n…                                                                                   │
│         th…                                                                                   │
│ =                                                                                             │
│ current_ti…                                                                                   │
│ - (30 * 24                                                                                    │
│ * 60 * 60)                                                                                    │
│                                                                                               │
│         for                                                                                   │
│ filename in                                                                                   │
│ os.listdir…                                                                                   │
│           …                                                                                   │
│ filename.s…                                                                                   │
│ and                                                                                           │
│ filename.e…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ os.path.jo…                                                                                   │
│ filename)                                                                                     │
│           …                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ os.path.ge…                                                                                   │
│           …                                                                                   │
│ file_mtime                                                                                    │
│ <                                                                                             │
│ thirty_day…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ (OSError,                                                                                     │
│ IOError):                                                                                     │
│           …                                                                                   │
│ # Ignore                                                                                      │
│ errors for                                                                                    │
│ individual                                                                                    │
│ file                                                                                          │
│ cleanup                                                                                       │
│     except                                                                                    │
│ Exception:                                                                                    │
│         pa…                                                                                   │
│ # Silently                                                                                    │
│ ignore                                                                                        │
│ cleanup                                                                                       │
│ errors                                                                                        │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ load_state…                                                                                   │
│     """Load                                                                                   │
│ the state                                                                                     │
│ of shown                                                                                      │
│ warnings                                                                                      │
│ from                                                                                          │
│ file."""                                                                                      │
│     state_…                                                                                   │
│ =                                                                                             │
│ get_state_…                                                                                   │
│     if                                                                                        │
│ os.path.ex…                                                                                   │
│         tr…                                                                                   │
│           …                                                                                   │
│ open(state…                                                                                   │
│ "r") as f:                                                                                    │
│           …                                                                                   │
│ set(json.l…                                                                                   │
│         ex…                                                                                   │
│ (json.JSON…                                                                                   │
│ IOError):                                                                                     │
│           …                                                                                   │
│ set()                                                                                         │
│     return                                                                                    │
│ set()                                                                                         │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ save_state…                                                                                   │
│ shown_warn…                                                                                   │
│     """Save                                                                                   │
│ the state                                                                                     │
│ of shown                                                                                      │
│ warnings to                                                                                   │
│ file."""                                                                                      │
│     state_…                                                                                   │
│ =                                                                                             │
│ get_state_…                                                                                   │
│     try:                                                                                      │
│         os…                                                                                   │
│ exist_ok=T…                                                                                   │
│         wi…                                                                                   │
│ open(state…                                                                                   │
│ "w") as f:                                                                                    │
│           …                                                                                   │
│ f)                                                                                            │
│     except                                                                                    │
│ IOError as                                                                                    │
│ e:                                                                                            │
│         de…                                                                                   │
│ to save                                                                                       │
│ state file:                                                                                   │
│ {e}")                                                                                         │
│         pa…                                                                                   │
│ # Fail                                                                                        │
│ silently if                                                                                   │
│ we can't                                                                                      │
│ save state                                                                                    │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ check_patt…                                                                                   │
│ content):                                                                                     │
│     """Che…                                                                                   │
│ if file                                                                                       │
│ path or                                                                                       │
│ content                                                                                       │
│ matches any                                                                                   │
│ security                                                                                      │
│ patterns."…                                                                                   │
│     #                                                                                         │
│ Normalize                                                                                     │
│ path by                                                                                       │
│ removing                                                                                      │
│ leading                                                                                       │
│ slashes                                                                                       │
│     normal…                                                                                   │
│ =                                                                                             │
│ file_path.…                                                                                   │
│                                                                                               │
│     for                                                                                       │
│ pattern in                                                                                    │
│ SECURITY_P…                                                                                   │
│         #                                                                                     │
│ Check                                                                                         │
│ path-based                                                                                    │
│ patterns                                                                                      │
│         if                                                                                    │
│ "path_chec…                                                                                   │
│ in pattern                                                                                    │
│ and                                                                                           │
│ pattern["p…                                                                                   │
│           …                                                                                   │
│ pattern["r…                                                                                   │
│ pattern["r…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Check                                                                                         │
│ content-ba…                                                                                   │
│ patterns                                                                                      │
│         if                                                                                    │
│ "substring…                                                                                   │
│ in pattern                                                                                    │
│ and                                                                                           │
│ content:                                                                                      │
│           …                                                                                   │
│ substring                                                                                     │
│ in                                                                                            │
│ pattern["s…                                                                                   │
│           …                                                                                   │
│ substring                                                                                     │
│ in content:                                                                                   │
│           …                                                                                   │
│ pattern["r…                                                                                   │
│ pattern["r…                                                                                   │
│                                                                                               │
│     return                                                                                    │
│ None, None                                                                                    │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ extract_co…                                                                                   │
│ tool_input…                                                                                   │
│     """Ext…                                                                                   │
│ content to                                                                                    │
│ check from                                                                                    │
│ tool input                                                                                    │
│ based on                                                                                      │
│ tool                                                                                          │
│ type."""                                                                                      │
│     if                                                                                        │
│ tool_name                                                                                     │
│ == "Write":                                                                                   │
│         re…                                                                                   │
│ tool_input…                                                                                   │
│ "")                                                                                           │
│     elif                                                                                      │
│ tool_name                                                                                     │
│ == "Edit":                                                                                    │
│         re…                                                                                   │
│ tool_input…                                                                                   │
│ "")                                                                                           │
│     elif                                                                                      │
│ tool_name                                                                                     │
│ ==                                                                                            │
│ "MultiEdit…                                                                                   │
│         ed…                                                                                   │
│ =                                                                                             │
│ tool_input…                                                                                   │
│ [])                                                                                           │
│         if                                                                                    │
│ edits:                                                                                        │
│           …                                                                                   │
│ "                                                                                             │
│ ".join(edi…                                                                                   │
│ "") for                                                                                       │
│ edit in                                                                                       │
│ edits)                                                                                        │
│         re…                                                                                   │
│ ""                                                                                            │
│                                                                                               │
│     return                                                                                    │
│ ""                                                                                            │
│                                                                                               │
│                                                                                               │
│ def main():                                                                                   │
│     """Main                                                                                   │
│ hook                                                                                          │
│ function."…                                                                                   │
│     # Check                                                                                   │
│ if security                                                                                   │
│ reminders                                                                                     │
│ are enabled                                                                                   │
│     securi…                                                                                   │
│ =                                                                                             │
│ os.environ…                                                                                   │
│ "1")                                                                                          │
│                                                                                               │
│     # Only                                                                                    │
│ run if                                                                                        │
│ security                                                                                      │
│ reminders                                                                                     │
│ are enabled                                                                                   │
│     if                                                                                        │
│ security_r…                                                                                   │
│ == "0":                                                                                       │
│         sy…                                                                                   │
│                                                                                               │
│     #                                                                                         │
│ Periodical…                                                                                   │
│ clean up                                                                                      │
│ old state                                                                                     │
│ files (10%                                                                                    │
│ chance per                                                                                    │
│ run)                                                                                          │
│     if                                                                                        │
│ random.ran…                                                                                   │
│ < 0.1:                                                                                        │
│         cl…                                                                                   │
│                                                                                               │
│     # Read                                                                                    │
│ input from                                                                                    │
│ stdin                                                                                         │
│     try:                                                                                      │
│         ra…                                                                                   │
│ =                                                                                             │
│ sys.stdin.…                                                                                   │
│         in…                                                                                   │
│ =                                                                                             │
│ json.loads…                                                                                   │
│     except                                                                                    │
│ json.JSOND…                                                                                   │
│ as e:                                                                                         │
│         de…                                                                                   │
│ decode                                                                                        │
│ error:                                                                                        │
│ {e}")                                                                                         │
│         sy…                                                                                   │
│ # Allow                                                                                       │
│ tool to                                                                                       │
│ proceed if                                                                                    │
│ we can't                                                                                      │
│ parse input                                                                                   │
│                                                                                               │
│     #                                                                                         │
│ Extract                                                                                       │
│ session ID                                                                                    │
│ and tool                                                                                      │
│ information                                                                                   │
│ from the                                                                                      │
│ hook input                                                                                    │
│     sessio…                                                                                   │
│ =                                                                                             │
│ input_data…                                                                                   │
│ "default")                                                                                    │
│     tool_n…                                                                                   │
│ =                                                                                             │
│ input_data…                                                                                   │
│ "")                                                                                           │
│     tool_i…                                                                                   │
│ =                                                                                             │
│ input_data…                                                                                   │
│ {})                                                                                           │
│                                                                                               │
│     # Check                                                                                   │
│ if this is                                                                                    │
│ a relevant                                                                                    │
│ tool                                                                                          │
│     if                                                                                        │
│ tool_name                                                                                     │
│ not in                                                                                        │
│ ["Edit",                                                                                      │
│ "Write",                                                                                      │
│ "MultiEdit…                                                                                   │
│         sy…                                                                                   │
│ # Allow                                                                                       │
│ non-file                                                                                      │
│ tools to                                                                                      │
│ proceed                                                                                       │
│                                                                                               │
│     #                                                                                         │
│ Extract                                                                                       │
│ file path                                                                                     │
│ from                                                                                          │
│ tool_input                                                                                    │
│     file_p…                                                                                   │
│ =                                                                                             │
│ tool_input…                                                                                   │
│ "")                                                                                           │
│     if not                                                                                    │
│ file_path:                                                                                    │
│         sy…                                                                                   │
│ # Allow if                                                                                    │
│ no file                                                                                       │
│ path                                                                                          │
│                                                                                               │
│     #                                                                                         │
│ Extract                                                                                       │
│ content to                                                                                    │
│ check                                                                                         │
│     content                                                                                   │
│ =                                                                                             │
│ extract_co…                                                                                   │
│ tool_input)                                                                                   │
│                                                                                               │
│     # Check                                                                                   │
│ for                                                                                           │
│ security                                                                                      │
│ patterns                                                                                      │
│     rule_n…                                                                                   │
│ reminder =                                                                                    │
│ check_patt…                                                                                   │
│ content)                                                                                      │
│                                                                                               │
│     if                                                                                        │
│ rule_name                                                                                     │
│ and                                                                                           │
│ reminder:                                                                                     │
│         #                                                                                     │
│ Create                                                                                        │
│ unique                                                                                        │
│ warning key                                                                                   │
│         wa…                                                                                   │
│ =                                                                                             │
│ f"{file_pa…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Load                                                                                          │
│ existing                                                                                      │
│ warnings                                                                                      │
│ for this                                                                                      │
│ session                                                                                       │
│         sh…                                                                                   │
│ =                                                                                             │
│ load_state…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Check if                                                                                      │
│ we've                                                                                         │
│ already                                                                                       │
│ shown this                                                                                    │
│ warning in                                                                                    │
│ this                                                                                          │
│ session                                                                                       │
│         if                                                                                    │
│ warning_key                                                                                   │
│ not in                                                                                        │
│ shown_warn…                                                                                   │
│           …                                                                                   │
│ Add to                                                                                        │
│ shown                                                                                         │
│ warnings                                                                                      │
│ and save                                                                                      │
│           …                                                                                   │
│           …                                                                                   │
│ shown_warn…                                                                                   │
│                                                                                               │
│           …                                                                                   │
│ Output the                                                                                    │
│ warning to                                                                                    │
│ stderr and                                                                                    │
│ block                                                                                         │
│ execution                                                                                     │
│           …                                                                                   │
│ file=sys.s…                                                                                   │
│           …                                                                                   │
│ # Block                                                                                       │
│ tool                                                                                          │
│ execution                                                                                     │
│ (exit code                                                                                    │
│ 2 for                                                                                         │
│ PreToolUse                                                                                    │
│ hooks)                                                                                        │
│                                                                                               │
│     # Allow                                                                                   │
│ tool to                                                                                       │
│ proceed                                                                                       │
│     sys.ex…                                                                                   │
│                                                                                               │
│                                                                                               │
│ if __name__                                                                                   │
│ ==                                                                                            │
│ "__main__":                                                                                   │
│     main()                                                                                    │
│                                                                                               │
│ ```                                                                                           │
│                                                                                               │
│ ## FILE:                                                                                      │
│ skills/bat…                                                                                   │
│ ```py                                                                                         │
│ # ///                                                                                         │
│ script                                                                                        │
│ #                                                                                             │
│ dependenci…                                                                                   │
│ = [                                                                                           │
│ #                                                                                             │
│ "jinja2",                                                                                     │
│ # ]                                                                                           │
│ # ///                                                                                         │
│                                                                                               │
│ import                                                                                        │
│ asyncio                                                                                       │
│ import sys                                                                                    │
│ import json                                                                                   │
│ import os                                                                                     │
│ import                                                                                        │
│ shutil                                                                                        │
│ import                                                                                        │
│ argparse                                                                                      │
│ import                                                                                        │
│ subprocess                                                                                    │
│ from                                                                                          │
│ pathlib                                                                                       │
│ import Path                                                                                   │
│ from                                                                                          │
│ datetime                                                                                      │
│ import                                                                                        │
│ datetime                                                                                      │
│ from jinja2                                                                                   │
│ import                                                                                        │
│ Template                                                                                      │
│                                                                                               │
│ # ---                                                                                         │
│ DEFAULTS                                                                                      │
│ ---                                                                                           │
│ DEFAULT_MA…                                                                                   │
│ = 5                                                                                           │
│ DEFAULT_TI…                                                                                   │
│ = 600                                                                                         │
│ BATCH_DIR_…                                                                                   │
│ =                                                                                             │
│ "batch_run…                                                                                   │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ check_sand…                                                                                   │
│     """                                                                                       │
│     Check                                                                                     │
│ if Claude                                                                                     │
│ Code                                                                                          │
│ sandboxing                                                                                    │
│ is enabled.                                                                                   │
│     Returns                                                                                   │
│ True if                                                                                       │
│ sandbox                                                                                       │
│ mode is                                                                                       │
│ active,                                                                                       │
│ False                                                                                         │
│ otherwise.                                                                                    │
│     """                                                                                       │
│     try:                                                                                      │
│         #                                                                                     │
│ Check for                                                                                     │
│ sandbox                                                                                       │
│ configurat…                                                                                   │
│ in settings                                                                                   │
│         se…                                                                                   │
│ =                                                                                             │
│ Path.home()                                                                                   │
│ / ".claude"                                                                                   │
│ /                                                                                             │
│ "settings.…                                                                                   │
│         if                                                                                    │
│ settings_p…                                                                                   │
│           …                                                                                   │
│ open(setti…                                                                                   │
│ as f:                                                                                         │
│           …                                                                                   │
│ =                                                                                             │
│ json.load(…                                                                                   │
│           …                                                                                   │
│ Check if                                                                                      │
│ sandbox is                                                                                    │
│ configured                                                                                    │
│           …                                                                                   │
│ "sandbox"                                                                                     │
│ in                                                                                            │
│ settings:                                                                                     │
│           …                                                                                   │
│ True                                                                                          │
│         re…                                                                                   │
│ False                                                                                         │
│     except                                                                                    │
│ Exception:                                                                                    │
│         re…                                                                                   │
│ False                                                                                         │
│                                                                                               │
│                                                                                               │
│ async def                                                                                     │
│ run_worker…                                                                                   │
│ run_id,                                                                                       │
│ index,                                                                                        │
│ item,                                                                                         │
│ skill_name,                                                                                   │
│ user_templ…                                                                                   │
│ timeout):                                                                                     │
│     """                                                                                       │
│     Spawns                                                                                    │
│ a single                                                                                      │
│ isolated                                                                                      │
│ Claude Code                                                                                   │
│ instance.                                                                                     │
│     """                                                                                       │
│     async                                                                                     │
│ with sem:                                                                                     │
│         #                                                                                     │
│ 1. Setup                                                                                      │
│ Isolation                                                                                     │
│         #                                                                                     │
│ We create a                                                                                   │
│ folder, but                                                                                   │
│ we DO NOT                                                                                     │
│ change the                                                                                    │
│ CWD of the                                                                                    │
│ subprocess.                                                                                   │
│         #                                                                                     │
│ This                                                                                          │
│ ensures                                                                                       │
│ Claude                                                                                        │
│ still sees                                                                                    │
│ .claude/co…                                                                                   │
│ and                                                                                           │
│ project-le…                                                                                   │
│ skills.                                                                                       │
│         ta…                                                                                   │
│ =                                                                                             │
│ os.path.ab…                                                                                   │
│           …                                                                                   │
│ run_id,                                                                                       │
│ f"task_{in…                                                                                   │
│         )                                                                                     │
│         os…                                                                                   │
│ exist_ok=T…                                                                                   │
│                                                                                               │
│         ou…                                                                                   │
│ =                                                                                             │
│ os.path.jo…                                                                                   │
│ "result.js…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ 2. Render                                                                                     │
│ Prompt                                                                                        │
│         #                                                                                     │
│ We inject                                                                                     │
│ strict                                                                                        │
│ instructio…                                                                                   │
│ about where                                                                                   │
│ to write.                                                                                     │
│         sy…                                                                                   │
│ = (                                                                                           │
│           …                                                                                   │
│ OVERRIDE:                                                                                     │
│ You are a                                                                                     │
│ headless                                                                                      │
│ worker                                                                                        │
│ agent. "                                                                                      │
│           …                                                                                   │
│ are                                                                                           │
│ restricted                                                                                    │
│ to working                                                                                    │
│ strictly                                                                                      │
│ within this                                                                                   │
│ directory:                                                                                    │
│ {task_dir}.                                                                                   │
│ "                                                                                             │
│           …                                                                                   │
│ have                                                                                          │
│ permission                                                                                    │
│ to use the                                                                                    │
│ '{skill_na…                                                                                   │
│ tool. "                                                                                       │
│           …                                                                                   │
│ not ask for                                                                                   │
│ confirmati…                                                                                   │
│ Do not                                                                                        │
│ output                                                                                        │
│ conversati…                                                                                   │
│ filler. "                                                                                     │
│           …                                                                                   │
│ the task                                                                                      │
│ and save                                                                                      │
│ the final                                                                                     │
│ structured                                                                                    │
│ data to:                                                                                      │
│ {output_fi…                                                                                   │
│         )                                                                                     │
│                                                                                               │
│         tr…                                                                                   │
│           …                                                                                   │
│ Jinja2                                                                                        │
│ rendering                                                                                     │
│ for the                                                                                       │
│ user's                                                                                        │
│ specific                                                                                      │
│ task                                                                                          │
│           …                                                                                   │
│ =                                                                                             │
│ Template(u…                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ t.render(i…                                                                                   │
│ task_id=in…                                                                                   │
│ output_fil…                                                                                   │
│         ex…                                                                                   │
│ Exception                                                                                     │
│ as e:                                                                                         │
│           …                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ "error",                                                                                      │
│           …                                                                                   │
│ item,                                                                                         │
│           …                                                                                   │
│ f"Template                                                                                    │
│ Error:                                                                                        │
│ {str(e)}",                                                                                    │
│           …                                                                                   │
│ task_dir,                                                                                     │
│           …                                                                                   │
│                                                                                               │
│         fu…                                                                                   │
│ = (                                                                                           │
│           …                                                                                   │
│ INPUT:                                                                                        │
│ {item}\nIN…                                                                                   │
│ {task_prom…                                                                                   │
│         )                                                                                     │
│                                                                                               │
│         #                                                                                     │
│ 3.                                                                                            │
│ Construct                                                                                     │
│ Command                                                                                       │
│         #                                                                                     │
│ Use Claude                                                                                    │
│ Code                                                                                          │
│ directly -                                                                                    │
│ native                                                                                        │
│ sandboxing                                                                                    │
│ will                                                                                          │
│ restrict to                                                                                   │
│ task_dir                                                                                      │
│         cmd                                                                                   │
│ =                                                                                             │
│ ["claude",                                                                                    │
│ "-p",                                                                                         │
│ full_promp…                                                                                   │
│ "--dangero…                                                                                   │
│                                                                                               │
│         pr…                                                                                   │
│ Starting                                                                                      │
│ task for:                                                                                     │
│ {item} (🔒                                                                                    │
│ Sandboxed                                                                                     │
│ to                                                                                            │
│ {task_dir}…                                                                                   │
│                                                                                               │
│         tr…                                                                                   │
│           …                                                                                   │
│ 4. Execute                                                                                    │
│ with                                                                                          │
│ task_dir as                                                                                   │
│ working                                                                                       │
│ directory                                                                                     │
│           …                                                                                   │
│ Claude's                                                                                      │
│ sandbox                                                                                       │
│ will                                                                                          │
│ restrict                                                                                      │
│ filesystem                                                                                    │
│ writes to                                                                                     │
│ this                                                                                          │
│ directory                                                                                     │
│           …                                                                                   │
│ = await                                                                                       │
│ asyncio.cr…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ # Critical:                                                                                   │
│ Sets                                                                                          │
│ working                                                                                       │
│ directory                                                                                     │
│ for sandbox                                                                                   │
│           …                                                                                   │
│                                                                                               │
│           …                                                                                   │
│ Wait with                                                                                     │
│ timeout                                                                                       │
│           …                                                                                   │
│ stderr =                                                                                      │
│ await                                                                                         │
│ asyncio.wa…                                                                                   │
│           …                                                                                   │
│ timeout=ti…                                                                                   │
│           …                                                                                   │
│                                                                                               │
│           …                                                                                   │
│ 5. Harvest                                                                                    │
│ Results                                                                                       │
│           …                                                                                   │
│ process.re…                                                                                   │
│ == 0:                                                                                         │
│           …                                                                                   │
│ Check if                                                                                      │
│ the output                                                                                    │
│ file                                                                                          │
│ actually                                                                                      │
│ exists                                                                                        │
│           …                                                                                   │
│ os.path.ex…                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ open(outpu…                                                                                   │
│ "r") as f:                                                                                    │
│           …                                                                                   │
│ =                                                                                             │
│ json.load(…                                                                                   │
│           …                                                                                   │
│ Success.")                                                                                    │
│           …                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ "success",                                                                                    │
│           …                                                                                   │
│ item,                                                                                         │
│           …                                                                                   │
│ data,                                                                                         │
│           …                                                                                   │
│ task_dir,                                                                                     │
│           …                                                                                   │
│           …                                                                                   │
│ json.JSOND…                                                                                   │
│           …                                                                                   │
│ Failed:                                                                                       │
│ Output was                                                                                    │
│ not valid                                                                                     │
│ JSON.")                                                                                       │
│           …                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ "error",                                                                                      │
│           …                                                                                   │
│ item,                                                                                         │
│           …                                                                                   │
│ "Invalid                                                                                      │
│ JSON in                                                                                       │
│ output                                                                                        │
│ file",                                                                                        │
│           …                                                                                   │
│ task_dir,                                                                                     │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ Failed: No                                                                                    │
│ output file                                                                                   │
│ found.")                                                                                      │
│           …                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ "error",                                                                                      │
│           …                                                                                   │
│ item,                                                                                         │
│           …                                                                                   │
│ "Output                                                                                       │
│ file                                                                                          │
│ missing",                                                                                     │
│           …                                                                                   │
│ stdout.dec…                                                                                   │
│           …                                                                                   │
│ task_dir,                                                                                     │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ Crushed                                                                                       │
│ (Exit Code                                                                                    │
│ {process.r…                                                                                   │
│           …                                                                                   │
│ {                                                                                             │
│           …                                                                                   │
│ "error",                                                                                      │
│           …                                                                                   │
│ item,                                                                                         │
│           …                                                                                   │
│ stderr.dec…                                                                                   │
│           …                                                                                   │
│ task_dir,                                                                                     │
│           …                                                                                   │
│                                                                                               │
│         ex…                                                                                   │
│ asyncio.Ti…                                                                                   │
│           …                                                                                   │
│ Timed out                                                                                     │
│ after                                                                                         │
│ {timeout}s.                                                                                   │
│ Killing.")                                                                                    │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│           …                                                                                   │
│ {"status":                                                                                    │
│ "timeout",                                                                                    │
│ "item":                                                                                       │
│ item,                                                                                         │
│ "task_dir":                                                                                   │
│ task_dir}                                                                                     │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ cleanup_an…                                                                                   │
│ run_dir,                                                                                      │
│ results):                                                                                     │
│     """                                                                                       │
│     Move                                                                                      │
│ artifacts                                                                                     │
│ to output                                                                                     │
│ directory                                                                                     │
│ in CWD and                                                                                    │
│ clean up                                                                                      │
│ temp                                                                                          │
│ directorie…                                                                                   │
│     """                                                                                       │
│     cwd =                                                                                     │
│ os.getcwd()                                                                                   │
│     output…                                                                                   │
│ =                                                                                             │
│ os.path.jo…                                                                                   │
│ f"batch_re…                                                                                   │
│     os.mak…                                                                                   │
│ exist_ok=T…                                                                                   │
│                                                                                               │
│     print(…                                                                                   │
│ Cleanup &                                                                                     │
│ Finalize                                                                                      │
│ ---")                                                                                         │
│     print(…                                                                                   │
│ artifacts                                                                                     │
│ to:                                                                                           │
│ {output_di…                                                                                   │
│                                                                                               │
│     moved_…                                                                                   │
│ = 0                                                                                           │
│     for                                                                                       │
│ result in                                                                                     │
│ results:                                                                                      │
│         if                                                                                    │
│ result["st…                                                                                   │
│ ==                                                                                            │
│ "success"                                                                                     │
│ and                                                                                           │
│ "task_dir"                                                                                    │
│ in result:                                                                                    │
│           …                                                                                   │
│ =                                                                                             │
│ result["ta…                                                                                   │
│           …                                                                                   │
│ Move all                                                                                      │
│ files                                                                                         │
│ except                                                                                        │
│ result.json                                                                                   │
│ and .py                                                                                       │
│ scripts                                                                                       │
│           …                                                                                   │
│ os.path.ex…                                                                                   │
│           …                                                                                   │
│ filename in                                                                                   │
│ os.listdir…                                                                                   │
│           …                                                                                   │
│ filename.e…                                                                                   │
│ ".xlsx",                                                                                      │
│ ".md",                                                                                        │
│ ".csv")):                                                                                     │
│           …                                                                                   │
│ filename !=                                                                                   │
│ "result.js…                                                                                   │
│ # Skip the                                                                                    │
│ internal                                                                                      │
│ result file                                                                                   │
│           …                                                                                   │
│ =                                                                                             │
│ os.path.jo…                                                                                   │
│ filename)                                                                                     │
│           …                                                                                   │
│ =                                                                                             │
│ os.path.jo…                                                                                   │
│ filename)                                                                                     │
│           …                                                                                   │
│ dst)                                                                                          │
│           …                                                                                   │
│ += 1                                                                                          │
│                                                                                               │
│     # Save                                                                                    │
│ summary to                                                                                    │
│ output                                                                                        │
│ directory                                                                                     │
│     summar…                                                                                   │
│ =                                                                                             │
│ os.path.jo…                                                                                   │
│ "summary.j…                                                                                   │
│     with                                                                                      │
│ open(summa…                                                                                   │
│ "w") as f:                                                                                    │
│         js…                                                                                   │
│ f,                                                                                            │
│ indent=2)                                                                                     │
│                                                                                               │
│     print(…                                                                                   │
│ {moved_cou…                                                                                   │
│ artifact                                                                                      │
│ files")                                                                                       │
│     print(…                                                                                   │
│ saved to:                                                                                     │
│ {summary_p…                                                                                   │
│                                                                                               │
│     #                                                                                         │
│ Delete temp                                                                                   │
│ batch_runs                                                                                    │
│ directory                                                                                     │
│     try:                                                                                      │
│         sh…                                                                                   │
│         pr…                                                                                   │
│ up temp                                                                                       │
│ directory:                                                                                    │
│ {BATCH_DIR…                                                                                   │
│     except                                                                                    │
│ Exception                                                                                     │
│ as e:                                                                                         │
│         pr…                                                                                   │
│ Could not                                                                                     │
│ delete temp                                                                                   │
│ directory:                                                                                    │
│ {e}")                                                                                         │
│                                                                                               │
│     return                                                                                    │
│ output_dir                                                                                    │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ check_and_…                                                                                   │
│     """                                                                                       │
│     Check                                                                                     │
│ sandbox                                                                                       │
│ configurat…                                                                                   │
│ immediately                                                                                   │
│ and provide                                                                                   │
│ clear setup                                                                                   │
│ instructio…                                                                                   │
│     Returns                                                                                   │
│ True if                                                                                       │
│ should                                                                                        │
│ continue,                                                                                     │
│ False if                                                                                      │
│ should                                                                                        │
│ exit.                                                                                         │
│     """                                                                                       │
│     sandbo…                                                                                   │
│ =                                                                                             │
│ check_sand…                                                                                   │
│                                                                                               │
│     if not                                                                                    │
│ sandbox_en…                                                                                   │
│         pr…                                                                                   │
│ + "="*70)                                                                                     │
│         pr…                                                                                   │
│ SECURITY                                                                                      │
│ WARNING:                                                                                      │
│ Claude Code                                                                                   │
│ Sandboxing                                                                                    │
│ Not                                                                                           │
│ Enabled")                                                                                     │
│         pr…                                                                                   │
│         pr…                                                                                   │
│ Sandboxing                                                                                    │
│ protects                                                                                      │
│ your                                                                                          │
│ filesystem                                                                                    │
│ during                                                                                        │
│ batch                                                                                         │
│ execution.…                                                                                   │
│         pr…                                                                                   │
│ Without it,                                                                                   │
│ workers                                                                                       │
│ have full                                                                                     │
│ access to                                                                                     │
│ all your                                                                                      │
│ files.\n")                                                                                    │
│         pr…                                                                                   │
│ To enable                                                                                     │
│ sandboxing                                                                                    │
│ (one-time                                                                                     │
│ setup):\n")                                                                                   │
│         pr…                                                                                   │
│ 1. In                                                                                         │
│ Claude                                                                                        │
│ Code, run                                                                                     │
│ this                                                                                          │
│ command:")                                                                                    │
│         pr…                                                                                   │
│ >                                                                                             │
│ /sandbox\n…                                                                                   │
│         pr…                                                                                   │
│ 2. Choose:                                                                                    │
│ 'Auto-allow                                                                                   │
│ mode'")                                                                                       │
│         pr…                                                                                   │
│ (This                                                                                         │
│ auto-appro…                                                                                   │
│ sandboxed                                                                                     │
│ commands)\…                                                                                   │
│         pr…                                                                                   │
│ 3. Restart                                                                                    │
│ batch-disp…                                                                                   │
│         pr…                                                                                   │
│ Or run with                                                                                   │
│ --skip-san…                                                                                   │
│ to proceed                                                                                    │
│ anyway (NOT                                                                                   │
│ RECOMMENDE…                                                                                   │
│         pr…                                                                                   │
│ + "\n")                                                                                       │
│         re…                                                                                   │
│ False                                                                                         │
│                                                                                               │
│     return                                                                                    │
│ True                                                                                          │
│                                                                                               │
│                                                                                               │
│ async def                                                                                     │
│ main():                                                                                       │
│     parser                                                                                    │
│ =                                                                                             │
│ argparse.A…                                                                                   │
│         de…                                                                                   │
│ dispatch:                                                                                     │
│ Run a skill                                                                                   │
│ in parallel                                                                                   │
│ across                                                                                        │
│ multiple                                                                                      │
│ inputs",                                                                                      │
│         fo…                                                                                   │
│         ep…                                                                                   │
│ Examples:                                                                                     │
│   # Basic                                                                                     │
│ usage (uses                                                                                   │
│ Claude                                                                                        │
│ Code's                                                                                        │
│ native                                                                                        │
│ sandboxing)                                                                                   │
│   batch_ru…                                                                                   │
│ catalog-sc…                                                                                   │
│ '["url1",                                                                                     │
│ "url2"]'                                                                                      │
│ "Scrape {{                                                                                    │
│ item }}"                                                                                      │
│                                                                                               │
│   # With                                                                                      │
│ custom                                                                                        │
│ timeout (10                                                                                   │
│ minutes)                                                                                      │
│   batch_ru…                                                                                   │
│ catalog-sc…                                                                                   │
│ '["url1",                                                                                     │
│ "url2"]'                                                                                      │
│ "Scrape {{                                                                                    │
│ item }}"                                                                                      │
│ --timeout                                                                                     │
│ 600                                                                                           │
│                                                                                               │
│   # With                                                                                      │
│ custom                                                                                        │
│ concurrency                                                                                   │
│ (limit to 3                                                                                   │
│ parallel                                                                                      │
│ workers)                                                                                      │
│   batch_ru…                                                                                   │
│ my-skill                                                                                      │
│ '["a", "b",                                                                                   │
│ "c"]'                                                                                         │
│ "Process {{                                                                                   │
│ item }}"                                                                                      │
│ --max-work…                                                                                   │
│ 3                                                                                             │
│                                                                                               │
│ Note:                                                                                         │
│ Requires                                                                                      │
│ Claude Code                                                                                   │
│ sandboxing                                                                                    │
│ to be                                                                                         │
│ enabled.                                                                                      │
│ Run                                                                                           │
│ /sandbox to                                                                                   │
│ configure.                                                                                    │
│         ""…                                                                                   │
│     )                                                                                         │
│     parser…                                                                                   │
│ help="Name                                                                                    │
│ of the                                                                                        │
│ skill to                                                                                      │
│ execute")                                                                                     │
│     parser…                                                                                   │
│         "i…                                                                                   │
│ help='JSON                                                                                    │
│ array of                                                                                      │
│ inputs                                                                                        │
│ (e.g.,                                                                                        │
│ \'["url1",                                                                                    │
│ "url2"]\')'                                                                                   │
│     )                                                                                         │
│     parser…                                                                                   │
│ help="Jinj…                                                                                   │
│ template                                                                                      │
│ for task                                                                                      │
│ instructio…                                                                                   │
│     parser…                                                                                   │
│         "-…                                                                                   │
│         ty…                                                                                   │
│         de…                                                                                   │
│         he…                                                                                   │
│ per task in                                                                                   │
│ seconds                                                                                       │
│ (default:                                                                                     │
│ {DEFAULT_T…                                                                                   │
│     )                                                                                         │
│     parser…                                                                                   │
│         "-…                                                                                   │
│         ty…                                                                                   │
│         de…                                                                                   │
│         he…                                                                                   │
│ concurrent                                                                                    │
│ workers                                                                                       │
│ (default:                                                                                     │
│ {DEFAULT_M…                                                                                   │
│     )                                                                                         │
│     parser…                                                                                   │
│         "-…                                                                                   │
│         ac…                                                                                   │
│         he…                                                                                   │
│ checking if                                                                                   │
│ Claude Code                                                                                   │
│ sandboxing                                                                                    │
│ is enabled                                                                                    │
│ (not                                                                                          │
│ recommende…                                                                                   │
│     )                                                                                         │
│                                                                                               │
│     args =                                                                                    │
│ parser.par…                                                                                   │
│                                                                                               │
│     # Check                                                                                   │
│ sandboxing                                                                                    │
│ IMMEDIATELY                                                                                   │
│ (unless                                                                                       │
│ explicitly                                                                                    │
│ skipped)                                                                                      │
│     if not                                                                                    │
│ args.skip_…                                                                                   │
│         if                                                                                    │
│ not                                                                                           │
│ check_and_…                                                                                   │
│           …                                                                                   │
│                                                                                               │
│     try:                                                                                      │
│         in…                                                                                   │
│ =                                                                                             │
│ json.loads…                                                                                   │
│         if                                                                                    │
│ not                                                                                           │
│ isinstance…                                                                                   │
│ list):                                                                                        │
│           …                                                                                   │
│ Inputs must                                                                                   │
│ be a JSON                                                                                     │
│ array")                                                                                       │
│           …                                                                                   │
│     except                                                                                    │
│ json.JSOND…                                                                                   │
│ as e:                                                                                         │
│         pr…                                                                                   │
│ Invalid                                                                                       │
│ JSON in                                                                                       │
│ inputs:                                                                                       │
│ {e}")                                                                                         │
│         sy…                                                                                   │
│                                                                                               │
│     run_id                                                                                    │
│ =                                                                                             │
│ datetime.n…                                                                                   │
│     run_dir                                                                                   │
│ =                                                                                             │
│ os.path.jo…                                                                                   │
│ run_id)                                                                                       │
│     os.mak…                                                                                   │
│ exist_ok=T…                                                                                   │
│                                                                                               │
│     print(…                                                                                   │
│ Batch                                                                                         │
│ Dispatch                                                                                      │
│ Initiated                                                                                     │
│ ---")                                                                                         │
│     print(…                                                                                   │
│ ID:                                                                                           │
│ {run_id}")                                                                                    │
│     print(…                                                                                   │
│ {len(input…                                                                                   │
│     print(…                                                                                   │
│ {args.skil…                                                                                   │
│     print(…                                                                                   │
│ {args.time…                                                                                   │
│ per task")                                                                                    │
│     print(…                                                                                   │
│ Workers:                                                                                      │
│ {args.max_…                                                                                   │
│     print(…                                                                                   │
│ 🔒 Claude                                                                                     │
│ Code                                                                                          │
│ Sandbox")                                                                                     │
│                                                                                               │
│     sem =                                                                                     │
│ asyncio.Se…                                                                                   │
│                                                                                               │
│     tasks =                                                                                   │
│ [                                                                                             │
│         ru…                                                                                   │
│ run_id, i,                                                                                    │
│ item,                                                                                         │
│ args.skill,                                                                                   │
│ args.templ…                                                                                   │
│ args.timeo…                                                                                   │
│         for                                                                                   │
│ i, item in                                                                                    │
│ enumerate(…                                                                                   │
│     ]                                                                                         │
│                                                                                               │
│     # Run                                                                                     │
│ all                                                                                           │
│     results                                                                                   │
│ = await                                                                                       │
│ asyncio.ga…                                                                                   │
│                                                                                               │
│     # Count                                                                                   │
│ successes/…                                                                                   │
│     succes…                                                                                   │
│ = sum(1 for                                                                                   │
│ r in                                                                                          │
│ results if                                                                                    │
│ r["status"]                                                                                   │
│ ==                                                                                            │
│ "success")                                                                                    │
│     error_…                                                                                   │
│ = sum(1 for                                                                                   │
│ r in                                                                                          │
│ results if                                                                                    │
│ r["status"]                                                                                   │
│ == "error")                                                                                   │
│     timeou…                                                                                   │
│ = sum(1 for                                                                                   │
│ r in                                                                                          │
│ results if                                                                                    │
│ r["status"]                                                                                   │
│ ==                                                                                            │
│ "timeout")                                                                                    │
│                                                                                               │
│     print(…                                                                                   │
│ Batch Job                                                                                     │
│ Complete                                                                                      │
│ ---")                                                                                         │
│     print(…                                                                                   │
│ {success_c…                                                                                   │
│     if                                                                                        │
│ error_count                                                                                   │
│ > 0:                                                                                          │
│         pr…                                                                                   │
│ {error_cou…                                                                                   │
│     if                                                                                        │
│ timeout_co…                                                                                   │
│ > 0:                                                                                          │
│         pr…                                                                                   │
│ {timeout_c…                                                                                   │
│                                                                                               │
│     #                                                                                         │
│ Cleanup and                                                                                   │
│ finalize                                                                                      │
│     output…                                                                                   │
│ =                                                                                             │
│ cleanup_an…                                                                                   │
│ run_dir,                                                                                      │
│ results)                                                                                      │
│                                                                                               │
│     print(…                                                                                   │
│ output                                                                                        │
│ directory:                                                                                    │
│ {output_di…                                                                                   │
│                                                                                               │
│                                                                                               │
│ if __name__                                                                                   │
│ ==                                                                                            │
│ "__main__":                                                                                   │
│     asynci…                                                                                   │
│                                                                                               │
│ ```                                                                                           │
│                                                                                               │
│ ## FILE:                                                                                      │
│ skills/ski…                                                                                   │
│ ```py                                                                                         │
│ #!/usr/bin…                                                                                   │
│ python3                                                                                       │
│ """                                                                                           │
│ Skill                                                                                         │
│ Initializer                                                                                   │
│ - Creates a                                                                                   │
│ new skill                                                                                     │
│ from                                                                                          │
│ template                                                                                      │
│                                                                                               │
│ Usage:                                                                                        │
│     init_s…                                                                                   │
│ <skill-nam…                                                                                   │
│ --path                                                                                        │
│ <path>                                                                                        │
│                                                                                               │
│ Examples:                                                                                     │
│     init_s…                                                                                   │
│ my-new-ski…                                                                                   │
│ --path                                                                                        │
│ skills/pub…                                                                                   │
│     init_s…                                                                                   │
│ my-api-hel…                                                                                   │
│ --path                                                                                        │
│ skills/pri…                                                                                   │
│     init_s…                                                                                   │
│ custom-ski…                                                                                   │
│ --path                                                                                        │
│ /custom/lo…                                                                                   │
│ """                                                                                           │
│                                                                                               │
│ import sys                                                                                    │
│ from                                                                                          │
│ pathlib                                                                                       │
│ import Path                                                                                   │
│                                                                                               │
│                                                                                               │
│ SKILL_TEMP…                                                                                   │
│ = """---                                                                                      │
│ name:                                                                                         │
│ {skill_nam…                                                                                   │
│ descriptio…                                                                                   │
│ [TODO:                                                                                        │
│ Complete                                                                                      │
│ and                                                                                           │
│ informative                                                                                   │
│ explanation                                                                                   │
│ of what the                                                                                   │
│ skill does                                                                                    │
│ and when to                                                                                   │
│ use it.                                                                                       │
│ Include                                                                                       │
│ WHEN to use                                                                                   │
│ this skill                                                                                    │
│ - specific                                                                                    │
│ scenarios,                                                                                    │
│ file types,                                                                                   │
│ or tasks                                                                                      │
│ that                                                                                          │
│ trigger                                                                                       │
│ it.]                                                                                          │
│ ---                                                                                           │
│                                                                                               │
│ #                                                                                             │
│ {skill_tit…                                                                                   │
│                                                                                               │
│ ## Overview                                                                                   │
│                                                                                               │
│ [TODO: 1-2                                                                                    │
│ sentences                                                                                     │
│ explaining                                                                                    │
│ what this                                                                                     │
│ skill                                                                                         │
│ enables]                                                                                      │
│                                                                                               │
│ ##                                                                                            │
│ Structuring                                                                                   │
│ This Skill                                                                                    │
│                                                                                               │
│ [TODO:                                                                                        │
│ Choose the                                                                                    │
│ structure                                                                                     │
│ that best                                                                                     │
│ fits this                                                                                     │
│ skill's                                                                                       │
│ purpose.                                                                                      │
│ Common                                                                                        │
│ patterns:                                                                                     │
│                                                                                               │
│ **1.                                                                                          │
│ Workflow-B…                                                                                   │
│ (best for                                                                                     │
│ sequential                                                                                    │
│ processes)                                                                                    │
│ - Works                                                                                       │
│ well when                                                                                     │
│ there are                                                                                     │
│ clear                                                                                         │
│ step-by-st…                                                                                   │
│ procedures                                                                                    │
│ - Example:                                                                                    │
│ DOCX skill                                                                                    │
│ with                                                                                          │
│ "Workflow                                                                                     │
│ Decision                                                                                      │
│ Tree" →                                                                                       │
│ "Reading" →                                                                                   │
│ "Creating"                                                                                    │
│ → "Editing"                                                                                   │
│ -                                                                                             │
│ Structure:                                                                                    │
│ ## Overview                                                                                   │
│ → ##                                                                                          │
│ Workflow                                                                                      │
│ Decision                                                                                      │
│ Tree → ##                                                                                     │
│ Step 1 → ##                                                                                   │
│ Step 2...                                                                                     │
│                                                                                               │
│ **2.                                                                                          │
│ Task-Based…                                                                                   │
│ (best for                                                                                     │
│ tool                                                                                          │
│ collection…                                                                                   │
│ - Works                                                                                       │
│ well when                                                                                     │
│ the skill                                                                                     │
│ offers                                                                                        │
│ different                                                                                     │
│ operations…                                                                                   │
│ - Example:                                                                                    │
│ PDF skill                                                                                     │
│ with "Quick                                                                                   │
│ Start" →                                                                                      │
│ "Merge                                                                                        │
│ PDFs" →                                                                                       │
│ "Split                                                                                        │
│ PDFs" →                                                                                       │
│ "Extract                                                                                      │
│ Text"                                                                                         │
│ -                                                                                             │
│ Structure:                                                                                    │
│ ## Overview                                                                                   │
│ → ## Quick                                                                                    │
│ Start → ##                                                                                    │
│ Task                                                                                          │
│ Category 1                                                                                    │
│ → ## Task                                                                                     │
│ Category                                                                                      │
│ 2...                                                                                          │
│                                                                                               │
│ **3.                                                                                          │
│ Reference/…                                                                                   │
│ (best for                                                                                     │
│ standards                                                                                     │
│ or                                                                                            │
│ specificat…                                                                                   │
│ - Works                                                                                       │
│ well for                                                                                      │
│ brand                                                                                         │
│ guidelines,                                                                                   │
│ coding                                                                                        │
│ standards,                                                                                    │
│ or                                                                                            │
│ requiremen…                                                                                   │
│ - Example:                                                                                    │
│ Brand                                                                                         │
│ styling                                                                                       │
│ with "Brand                                                                                   │
│ Guidelines"                                                                                   │
│ → "Colors"                                                                                    │
│ →                                                                                             │
│ "Typograph…                                                                                   │
│ →                                                                                             │
│ "Features"                                                                                    │
│ -                                                                                             │
│ Structure:                                                                                    │
│ ## Overview                                                                                   │
│ → ##                                                                                          │
│ Guidelines                                                                                    │
│ → ##                                                                                          │
│ Specificat…                                                                                   │
│ → ##                                                                                          │
│ Usage...                                                                                      │
│                                                                                               │
│ **4.                                                                                          │
│ Capabiliti…                                                                                   │
│ (best for                                                                                     │
│ integrated                                                                                    │
│ systems)                                                                                      │
│ - Works                                                                                       │
│ well when                                                                                     │
│ the skill                                                                                     │
│ provides                                                                                      │
│ multiple                                                                                      │
│ interrelat…                                                                                   │
│ features                                                                                      │
│ - Example:                                                                                    │
│ Product                                                                                       │
│ Management                                                                                    │
│ with "Core                                                                                    │
│ Capabiliti…                                                                                   │
│ → numbered                                                                                    │
│ capability                                                                                    │
│ list                                                                                          │
│ -                                                                                             │
│ Structure:                                                                                    │
│ ## Overview                                                                                   │
│ → ## Core                                                                                     │
│ Capabiliti…                                                                                   │
│ → ### 1.                                                                                      │
│ Feature →                                                                                     │
│ ### 2.                                                                                        │
│ Feature...                                                                                    │
│                                                                                               │
│ Patterns                                                                                      │
│ can be                                                                                        │
│ mixed and                                                                                     │
│ matched as                                                                                    │
│ needed.                                                                                       │
│ Most skills                                                                                   │
│ combine                                                                                       │
│ patterns                                                                                      │
│ (e.g.,                                                                                        │
│ start with                                                                                    │
│ task-based,                                                                                   │
│ add                                                                                           │
│ workflow                                                                                      │
│ for complex                                                                                   │
│ operations…                                                                                   │
│                                                                                               │
│ Delete this                                                                                   │
│ entire                                                                                        │
│ "Structuri…                                                                                   │
│ This Skill"                                                                                   │
│ section                                                                                       │
│ when done -                                                                                   │
│ it's just                                                                                     │
│ guidance.]                                                                                    │
│                                                                                               │
│ ## [TODO:                                                                                     │
│ Replace                                                                                       │
│ with the                                                                                      │
│ first main                                                                                    │
│ section                                                                                       │
│ based on                                                                                      │
│ chosen                                                                                        │
│ structure]                                                                                    │
│                                                                                               │
│ [TODO: Add                                                                                    │
│ content                                                                                       │
│ here. See                                                                                     │
│ examples in                                                                                   │
│ existing                                                                                      │
│ skills:                                                                                       │
│ - Code                                                                                        │
│ samples for                                                                                   │
│ technical                                                                                     │
│ skills                                                                                        │
│ - Decision                                                                                    │
│ trees for                                                                                     │
│ complex                                                                                       │
│ workflows                                                                                     │
│ - Concrete                                                                                    │
│ examples                                                                                      │
│ with                                                                                          │
│ realistic                                                                                     │
│ user                                                                                          │
│ requests                                                                                      │
│ -                                                                                             │
│ References                                                                                    │
│ to                                                                                            │
│ scripts/te…                                                                                   │
│ as needed]                                                                                    │
│                                                                                               │
│ ##                                                                                            │
│ Resources                                                                                     │
│                                                                                               │
│ This skill                                                                                    │
│ includes                                                                                      │
│ example                                                                                       │
│ resource                                                                                      │
│ directories                                                                                   │
│ that                                                                                          │
│ demonstrate                                                                                   │
│ how to                                                                                        │
│ organize                                                                                      │
│ different                                                                                     │
│ types of                                                                                      │
│ bundled                                                                                       │
│ resources:                                                                                    │
│                                                                                               │
│ ###                                                                                           │
│ scripts/                                                                                      │
│ Executable                                                                                    │
│ code                                                                                          │
│ (Python/Ba…                                                                                   │
│ that can be                                                                                   │
│ run                                                                                           │
│ directly to                                                                                   │
│ perform                                                                                       │
│ specific                                                                                      │
│ operations.                                                                                   │
│                                                                                               │
│ **Examples                                                                                    │
│ from other                                                                                    │
│ skills:**                                                                                     │
│ - PDF                                                                                         │
│ skill:                                                                                        │
│ `fill_fill…                                                                                   │
│ `extract_f…                                                                                   │
│ - utilities                                                                                   │
│ for PDF                                                                                       │
│ manipulati…                                                                                   │
│ - DOCX                                                                                        │
│ skill:                                                                                        │
│ `document.…                                                                                   │
│ `utilities…                                                                                   │
│ - Python                                                                                      │
│ modules for                                                                                   │
│ document                                                                                      │
│ processing                                                                                    │
│                                                                                               │
│ **Appropri…                                                                                   │
│ for:**                                                                                        │
│ Python                                                                                        │
│ scripts,                                                                                      │
│ shell                                                                                         │
│ scripts, or                                                                                   │
│ any                                                                                           │
│ executable                                                                                    │
│ code that                                                                                     │
│ performs                                                                                      │
│ automation,                                                                                   │
│ data                                                                                          │
│ processing,                                                                                   │
│ or specific                                                                                   │
│ operations.                                                                                   │
│                                                                                               │
│ **Note:**                                                                                     │
│ Scripts may                                                                                   │
│ be executed                                                                                   │
│ without                                                                                       │
│ loading                                                                                       │
│ into                                                                                          │
│ context,                                                                                      │
│ but can                                                                                       │
│ still be                                                                                      │
│ read by                                                                                       │
│ Claude for                                                                                    │
│ patching or                                                                                   │
│ environment                                                                                   │
│ adjustment…                                                                                   │
│                                                                                               │
│ ###                                                                                           │
│ references/                                                                                   │
│ Documentat…                                                                                   │
│ and                                                                                           │
│ reference                                                                                     │
│ material                                                                                      │
│ intended to                                                                                   │
│ be loaded                                                                                     │
│ into                                                                                          │
│ context to                                                                                    │
│ inform                                                                                        │
│ Claude's                                                                                      │
│ process and                                                                                   │
│ thinking.                                                                                     │
│                                                                                               │
│ **Examples                                                                                    │
│ from other                                                                                    │
│ skills:**                                                                                     │
│ - Product                                                                                     │
│ management:                                                                                   │
│ `communica…                                                                                   │
│ `context_b…                                                                                   │
│ - detailed                                                                                    │
│ workflow                                                                                      │
│ guides                                                                                        │
│ - BigQuery:                                                                                   │
│ API                                                                                           │
│ reference                                                                                     │
│ documentat…                                                                                   │
│ and query                                                                                     │
│ examples                                                                                      │
│ - Finance:                                                                                    │
│ Schema                                                                                        │
│ documentat…                                                                                   │
│ company                                                                                       │
│ policies                                                                                      │
│                                                                                               │
│ **Appropri…                                                                                   │
│ for:**                                                                                        │
│ In-depth                                                                                      │
│ documentat…                                                                                   │
│ API                                                                                           │
│ references,                                                                                   │
│ database                                                                                      │
│ schemas,                                                                                      │
│ comprehens…                                                                                   │
│ guides, or                                                                                    │
│ any                                                                                           │
│ detailed                                                                                      │
│ information                                                                                   │
│ that Claude                                                                                   │
│ should                                                                                        │
│ reference                                                                                     │
│ while                                                                                         │
│ working.                                                                                      │
│                                                                                               │
│ ### assets/                                                                                   │
│ Files not                                                                                     │
│ intended to                                                                                   │
│ be loaded                                                                                     │
│ into                                                                                          │
│ context,                                                                                      │
│ but rather                                                                                    │
│ used within                                                                                   │
│ the output                                                                                    │
│ Claude                                                                                        │
│ produces.                                                                                     │
│                                                                                               │
│ **Examples                                                                                    │
│ from other                                                                                    │
│ skills:**                                                                                     │
│ - Brand                                                                                       │
│ styling:                                                                                      │
│ PowerPoint                                                                                    │
│ template                                                                                      │
│ files                                                                                         │
│ (.pptx),                                                                                      │
│ logo files                                                                                    │
│ - Frontend                                                                                    │
│ builder:                                                                                      │
│ HTML/React                                                                                    │
│ boilerplate                                                                                   │
│ project                                                                                       │
│ directories                                                                                   │
│ -                                                                                             │
│ Typography:                                                                                   │
│ Font files                                                                                    │
│ (.ttf,                                                                                        │
│ .woff2)                                                                                       │
│                                                                                               │
│ **Appropri…                                                                                   │
│ for:**                                                                                        │
│ Templates,                                                                                    │
│ boilerplate                                                                                   │
│ code,                                                                                         │
│ document                                                                                      │
│ templates,                                                                                    │
│ images,                                                                                       │
│ icons,                                                                                        │
│ fonts, or                                                                                     │
│ any files                                                                                     │
│ meant to be                                                                                   │
│ copied or                                                                                     │
│ used in the                                                                                   │
│ final                                                                                         │
│ output.                                                                                       │
│                                                                                               │
│ ---                                                                                           │
│                                                                                               │
│ **Any                                                                                         │
│ unneeded                                                                                      │
│ directories                                                                                   │
│ can be                                                                                        │
│ deleted.**                                                                                    │
│ Not every                                                                                     │
│ skill                                                                                         │
│ requires                                                                                      │
│ all three                                                                                     │
│ types of                                                                                      │
│ resources.                                                                                    │
│ """                                                                                           │
│                                                                                               │
│ EXAMPLE_SC…                                                                                   │
│ =                                                                                             │
│ '''#!/usr/…                                                                                   │
│ python3                                                                                       │
│ """                                                                                           │
│ Example                                                                                       │
│ helper                                                                                        │
│ script for                                                                                    │
│ {skill_nam…                                                                                   │
│                                                                                               │
│ This is a                                                                                     │
│ placeholder                                                                                   │
│ script that                                                                                   │
│ can be                                                                                        │
│ executed                                                                                      │
│ directly.                                                                                     │
│ Replace                                                                                       │
│ with actual                                                                                   │
│ implementa…                                                                                   │
│ or delete                                                                                     │
│ if not                                                                                        │
│ needed.                                                                                       │
│                                                                                               │
│ Example                                                                                       │
│ real                                                                                          │
│ scripts                                                                                       │
│ from other                                                                                    │
│ skills:                                                                                       │
│ -                                                                                             │
│ pdf/script…                                                                                   │
│ - Fills PDF                                                                                   │
│ form fields                                                                                   │
│ -                                                                                             │
│ pdf/script…                                                                                   │
│ - Converts                                                                                    │
│ PDF pages                                                                                     │
│ to images                                                                                     │
│ """                                                                                           │
│                                                                                               │
│ def main():                                                                                   │
│     print(…                                                                                   │
│ is an                                                                                         │
│ example                                                                                       │
│ script for                                                                                    │
│ {skill_nam…                                                                                   │
│     # TODO:                                                                                   │
│ Add actual                                                                                    │
│ script                                                                                        │
│ logic here                                                                                    │
│     # This                                                                                    │
│ could be                                                                                      │
│ data                                                                                          │
│ processing,                                                                                   │
│ file                                                                                          │
│ conversion,                                                                                   │
│ API calls,                                                                                    │
│ etc.                                                                                          │
│                                                                                               │
│ if __name__                                                                                   │
│ ==                                                                                            │
│ "__main__":                                                                                   │
│     main()                                                                                    │
│ '''                                                                                           │
│                                                                                               │
│ EXAMPLE_RE…                                                                                   │
│ = """#                                                                                        │
│ Reference                                                                                     │
│ Documentat…                                                                                   │
│ for                                                                                           │
│ {skill_tit…                                                                                   │
│                                                                                               │
│ This is a                                                                                     │
│ placeholder                                                                                   │
│ for                                                                                           │
│ detailed                                                                                      │
│ reference                                                                                     │
│ documentat…                                                                                   │
│ Replace                                                                                       │
│ with actual                                                                                   │
│ reference                                                                                     │
│ content or                                                                                    │
│ delete if                                                                                     │
│ not needed.                                                                                   │
│                                                                                               │
│ Example                                                                                       │
│ real                                                                                          │
│ reference                                                                                     │
│ docs from                                                                                     │
│ other                                                                                         │
│ skills:                                                                                       │
│ -                                                                                             │
│ product-ma…                                                                                   │
│ -                                                                                             │
│ Comprehens…                                                                                   │
│ guide for                                                                                     │
│ status                                                                                        │
│ updates                                                                                       │
│ -                                                                                             │
│ product-ma…                                                                                   │
│ - Deep-dive                                                                                   │
│ on                                                                                            │
│ gathering                                                                                     │
│ context                                                                                       │
│ -                                                                                             │
│ bigquery/r…                                                                                   │
│ - API                                                                                         │
│ references                                                                                    │
│ and query                                                                                     │
│ examples                                                                                      │
│                                                                                               │
│ ## When                                                                                       │
│ Reference                                                                                     │
│ Docs Are                                                                                      │
│ Useful                                                                                        │
│                                                                                               │
│ Reference                                                                                     │
│ docs are                                                                                      │
│ ideal for:                                                                                    │
│ -                                                                                             │
│ Comprehens…                                                                                   │
│ API                                                                                           │
│ documentat…                                                                                   │
│ - Detailed                                                                                    │
│ workflow                                                                                      │
│ guides                                                                                        │
│ - Complex                                                                                     │
│ multi-step                                                                                    │
│ processes                                                                                     │
│ -                                                                                             │
│ Information                                                                                   │
│ too lengthy                                                                                   │
│ for main                                                                                      │
│ SKILL.md                                                                                      │
│ - Content                                                                                     │
│ that's only                                                                                   │
│ needed for                                                                                    │
│ specific                                                                                      │
│ use cases                                                                                     │
│                                                                                               │
│ ##                                                                                            │
│ Structure                                                                                     │
│ Suggestions                                                                                   │
│                                                                                               │
│ ### API                                                                                       │
│ Reference                                                                                     │
│ Example                                                                                       │
│ - Overview                                                                                    │
│ -                                                                                             │
│ Authentica…                                                                                   │
│ - Endpoints                                                                                   │
│ with                                                                                          │
│ examples                                                                                      │
│ - Error                                                                                       │
│ codes                                                                                         │
│ - Rate                                                                                        │
│ limits                                                                                        │
│                                                                                               │
│ ###                                                                                           │
│ Workflow                                                                                      │
│ Guide                                                                                         │
│ Example                                                                                       │
│ -                                                                                             │
│ Prerequisi…                                                                                   │
│ -                                                                                             │
│ Step-by-st…                                                                                   │
│ instructio…                                                                                   │
│ - Common                                                                                      │
│ patterns                                                                                      │
│ -                                                                                             │
│ Troublesho…                                                                                   │
│ - Best                                                                                        │
│ practices                                                                                     │
│ """                                                                                           │
│                                                                                               │
│ EXAMPLE_AS…                                                                                   │
│ = """#                                                                                        │
│ Example                                                                                       │
│ Asset File                                                                                    │
│                                                                                               │
│ This                                                                                          │
│ placeholder                                                                                   │
│ represents                                                                                    │
│ where asset                                                                                   │
│ files would                                                                                   │
│ be stored.                                                                                    │
│ Replace                                                                                       │
│ with actual                                                                                   │
│ asset files                                                                                   │
│ (templates,                                                                                   │
│ images,                                                                                       │
│ fonts,                                                                                        │
│ etc.) or                                                                                      │
│ delete if                                                                                     │
│ not needed.                                                                                   │
│                                                                                               │
│ Asset files                                                                                   │
│ are NOT                                                                                       │
│ intended to                                                                                   │
│ be loaded                                                                                     │
│ into                                                                                          │
│ context,                                                                                      │
│ but rather                                                                                    │
│ used within                                                                                   │
│ the output                                                                                    │
│ Claude                                                                                        │
│ produces.                                                                                     │
│                                                                                               │
│ Example                                                                                       │
│ asset files                                                                                   │
│ from other                                                                                    │
│ skills:                                                                                       │
│ - Brand                                                                                       │
│ guidelines:                                                                                   │
│ logo.png,                                                                                     │
│ slides_tem…                                                                                   │
│ - Frontend                                                                                    │
│ builder:                                                                                      │
│ hello-worl…                                                                                   │
│ directory                                                                                     │
│ with                                                                                          │
│ HTML/React                                                                                    │
│ boilerplate                                                                                   │
│ -                                                                                             │
│ Typography:                                                                                   │
│ custom-fon…                                                                                   │
│ font-famil…                                                                                   │
│ - Data:                                                                                       │
│ sample_dat…                                                                                   │
│ test_datas…                                                                                   │
│                                                                                               │
│ ## Common                                                                                     │
│ Asset Types                                                                                   │
│                                                                                               │
│ -                                                                                             │
│ Templates:                                                                                    │
│ .pptx,                                                                                        │
│ .docx,                                                                                        │
│ boilerplate                                                                                   │
│ directories                                                                                   │
│ - Images:                                                                                     │
│ .png, .jpg,                                                                                   │
│ .svg, .gif                                                                                    │
│ - Fonts:                                                                                      │
│ .ttf, .otf,                                                                                   │
│ .woff,                                                                                        │
│ .woff2                                                                                        │
│ -                                                                                             │
│ Boilerplate                                                                                   │
│ code:                                                                                         │
│ Project                                                                                       │
│ directorie…                                                                                   │
│ starter                                                                                       │
│ files                                                                                         │
│ - Icons:                                                                                      │
│ .ico, .svg                                                                                    │
│ - Data                                                                                        │
│ files:                                                                                        │
│ .csv,                                                                                         │
│ .json,                                                                                        │
│ .xml, .yaml                                                                                   │
│                                                                                               │
│ Note: This                                                                                    │
│ is a text                                                                                     │
│ placeholde…                                                                                   │
│ Actual                                                                                        │
│ assets can                                                                                    │
│ be any file                                                                                   │
│ type.                                                                                         │
│ """                                                                                           │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ title_case…                                                                                   │
│     """Con…                                                                                   │
│ hyphenated                                                                                    │
│ skill name                                                                                    │
│ to Title                                                                                      │
│ Case for                                                                                      │
│ display."""                                                                                   │
│     return                                                                                    │
│ '                                                                                             │
│ '.join(wor…                                                                                   │
│ for word in                                                                                   │
│ skill_name…                                                                                   │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ init_skill…                                                                                   │
│ path):                                                                                        │
│     """                                                                                       │
│     Initia…                                                                                   │
│ a new skill                                                                                   │
│ directory                                                                                     │
│ with                                                                                          │
│ template                                                                                      │
│ SKILL.md.                                                                                     │
│                                                                                               │
│     Args:                                                                                     │
│         sk…                                                                                   │
│ Name of the                                                                                   │
│ skill                                                                                         │
│         pa…                                                                                   │
│ Path where                                                                                    │
│ the skill                                                                                     │
│ directory                                                                                     │
│ should be                                                                                     │
│ created                                                                                       │
│                                                                                               │
│     Return…                                                                                   │
│         Pa…                                                                                   │
│ to created                                                                                    │
│ skill                                                                                         │
│ directory,                                                                                    │
│ or None if                                                                                    │
│ error                                                                                         │
│     """                                                                                       │
│     #                                                                                         │
│ Determine                                                                                     │
│ skill                                                                                         │
│ directory                                                                                     │
│ path                                                                                          │
│     skill_…                                                                                   │
│ =                                                                                             │
│ Path(path)…                                                                                   │
│ /                                                                                             │
│ skill_name                                                                                    │
│                                                                                               │
│     # Check                                                                                   │
│ if                                                                                            │
│ directory                                                                                     │
│ already                                                                                       │
│ exists                                                                                        │
│     if                                                                                        │
│ skill_dir.…                                                                                   │
│         pr…                                                                                   │
│ Error:                                                                                        │
│ Skill                                                                                         │
│ directory                                                                                     │
│ already                                                                                       │
│ exists:                                                                                       │
│ {skill_dir…                                                                                   │
│         re…                                                                                   │
│ None                                                                                          │
│                                                                                               │
│     #                                                                                         │
│ Create                                                                                        │
│ skill                                                                                         │
│ directory                                                                                     │
│     try:                                                                                      │
│         sk…                                                                                   │
│ exist_ok=F…                                                                                   │
│         pr…                                                                                   │
│ Created                                                                                       │
│ skill                                                                                         │
│ directory:                                                                                    │
│ {skill_dir…                                                                                   │
│     except                                                                                    │
│ Exception                                                                                     │
│ as e:                                                                                         │
│         pr…                                                                                   │
│ Error                                                                                         │
│ creating                                                                                      │
│ directory:                                                                                    │
│ {e}")                                                                                         │
│         re…                                                                                   │
│ None                                                                                          │
│                                                                                               │
│     #                                                                                         │
│ Create                                                                                        │
│ SKILL.md                                                                                      │
│ from                                                                                          │
│ template                                                                                      │
│     skill_…                                                                                   │
│ =                                                                                             │
│ title_case…                                                                                   │
│     skill_…                                                                                   │
│ =                                                                                             │
│ SKILL_TEMP…                                                                                   │
│         sk…                                                                                   │
│         sk…                                                                                   │
│     )                                                                                         │
│                                                                                               │
│     skill_…                                                                                   │
│ = skill_dir                                                                                   │
│ /                                                                                             │
│ 'SKILL.md'                                                                                    │
│     try:                                                                                      │
│         sk…                                                                                   │
│         pr…                                                                                   │
│ Created                                                                                       │
│ SKILL.md")                                                                                    │
│     except                                                                                    │
│ Exception                                                                                     │
│ as e:                                                                                         │
│         pr…                                                                                   │
│ Error                                                                                         │
│ creating                                                                                      │
│ SKILL.md:                                                                                     │
│ {e}")                                                                                         │
│         re…                                                                                   │
│ None                                                                                          │
│                                                                                               │
│     #                                                                                         │
│ Create                                                                                        │
│ resource                                                                                      │
│ directories                                                                                   │
│ with                                                                                          │
│ example                                                                                       │
│ files                                                                                         │
│     try:                                                                                      │
│         #                                                                                     │
│ Create                                                                                        │
│ scripts/                                                                                      │
│ directory                                                                                     │
│ with                                                                                          │
│ example                                                                                       │
│ script                                                                                        │
│         sc…                                                                                   │
│ = skill_dir                                                                                   │
│ / 'scripts'                                                                                   │
│         sc…                                                                                   │
│         ex…                                                                                   │
│ =                                                                                             │
│ scripts_dir                                                                                   │
│ /                                                                                             │
│ 'example.p…                                                                                   │
│         ex…                                                                                   │
│         ex…                                                                                   │
│         pr…                                                                                   │
│ Created                                                                                       │
│ scripts/ex…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Create                                                                                        │
│ references/                                                                                   │
│ directory                                                                                     │
│ with                                                                                          │
│ example                                                                                       │
│ reference                                                                                     │
│ doc                                                                                           │
│         re…                                                                                   │
│ = skill_dir                                                                                   │
│ /                                                                                             │
│ 'reference…                                                                                   │
│         re…                                                                                   │
│         ex…                                                                                   │
│ =                                                                                             │
│ references…                                                                                   │
│ /                                                                                             │
│ 'api_refer…                                                                                   │
│         ex…                                                                                   │
│         pr…                                                                                   │
│ Created                                                                                       │
│ references…                                                                                   │
│                                                                                               │
│         #                                                                                     │
│ Create                                                                                        │
│ assets/                                                                                       │
│ directory                                                                                     │
│ with                                                                                          │
│ example                                                                                       │
│ asset                                                                                         │
│ placeholder                                                                                   │
│         as…                                                                                   │
│ = skill_dir                                                                                   │
│ / 'assets'                                                                                    │
│         as…                                                                                   │
│         ex…                                                                                   │
│ =                                                                                             │
│ assets_dir                                                                                    │
│ /                                                                                             │
│ 'example_a…                                                                                   │
│         ex…                                                                                   │
│         pr…                                                                                   │
│ Created                                                                                       │
│ assets/exa…                                                                                   │
│     except                                                                                    │
│ Exception                                                                                     │
│ as e:                                                                                         │
│         pr…                                                                                   │
│ Error                                                                                         │
│ creating                                                                                      │
│ resource                                                                                      │
│ directorie…                                                                                   │
│ {e}")                                                                                         │
│         re…                                                                                   │
│ None                                                                                          │
│                                                                                               │
│     # Print                                                                                   │
│ next steps                                                                                    │
│     print(…                                                                                   │
│ Skill                                                                                         │
│ '{skill_na…                                                                                   │
│ initialized                                                                                   │
│ successful…                                                                                   │
│ at                                                                                            │
│ {skill_dir…                                                                                   │
│     print(…                                                                                   │
│ steps:")                                                                                      │
│     print(…                                                                                   │
│ Edit                                                                                          │
│ SKILL.md to                                                                                   │
│ complete                                                                                      │
│ the TODO                                                                                      │
│ items and                                                                                     │
│ update the                                                                                    │
│ descriptio…                                                                                   │
│     print(…                                                                                   │
│ Customize                                                                                     │
│ or delete                                                                                     │
│ the example                                                                                   │
│ files in                                                                                      │
│ scripts/,                                                                                     │
│ references…                                                                                   │
│ and                                                                                           │
│ assets/")                                                                                     │
│     print(…                                                                                   │
│ Run the                                                                                       │
│ validator                                                                                     │
│ when ready                                                                                    │
│ to check                                                                                      │
│ the skill                                                                                     │
│ structure")                                                                                   │
│                                                                                               │
│     return                                                                                    │
│ skill_dir                                                                                     │
│                                                                                               │
│                                                                                               │
│ def main():                                                                                   │
│     if                                                                                        │
│ len(sys.ar…                                                                                   │
│ < 4 or                                                                                        │
│ sys.argv[2]                                                                                   │
│ !=                                                                                            │
│ '--path':                                                                                     │
│         pr…                                                                                   │
│ init_skill…                                                                                   │
│ <skill-nam…                                                                                   │
│ --path                                                                                        │
│ <path>")                                                                                      │
│         pr…                                                                                   │
│ name                                                                                          │
│ requiremen…                                                                                   │
│         pr…                                                                                   │
│ -                                                                                             │
│ Hyphen-case                                                                                   │
│ identifier                                                                                    │
│ (e.g.,                                                                                        │
│ 'data-anal…                                                                                   │
│         pr…                                                                                   │
│ - Lowercase                                                                                   │
│ letters,                                                                                      │
│ digits, and                                                                                   │
│ hyphens                                                                                       │
│ only")                                                                                        │
│         pr…                                                                                   │
│ - Max 40                                                                                      │
│ characters…                                                                                   │
│         pr…                                                                                   │
│ - Must                                                                                        │
│ match                                                                                         │
│ directory                                                                                     │
│ name                                                                                          │
│ exactly")                                                                                     │
│         pr…                                                                                   │
│         pr…                                                                                   │
│ init_skill…                                                                                   │
│ my-new-ski…                                                                                   │
│ --path                                                                                        │
│ skills/pub…                                                                                   │
│         pr…                                                                                   │
│ init_skill…                                                                                   │
│ my-api-hel…                                                                                   │
│ --path                                                                                        │
│ skills/pri…                                                                                   │
│         pr…                                                                                   │
│ init_skill…                                                                                   │
│ custom-ski…                                                                                   │
│ --path                                                                                        │
│ /custom/lo…                                                                                   │
│         sy…                                                                                   │
│                                                                                               │
│     skill_…                                                                                   │
│ =                                                                                             │
│ sys.argv[1]                                                                                   │
│     path =                                                                                    │
│ sys.argv[3]                                                                                   │
│                                                                                               │
│     print(…                                                                                   │
│ Initializi…                                                                                   │
│ skill:                                                                                        │
│ {skill_nam…                                                                                   │
│     print(…                                                                                   │
│ Location:                                                                                     │
│ {path}")                                                                                      │
│     print()                                                                                   │
│                                                                                               │
│     result                                                                                    │
│ =                                                                                             │
│ init_skill…                                                                                   │
│ path)                                                                                         │
│                                                                                               │
│     if                                                                                        │
│ result:                                                                                       │
│         sy…                                                                                   │
│     else:                                                                                     │
│         sy…                                                                                   │
│                                                                                               │
│                                                                                               │
│ if __name__                                                                                   │
│ ==                                                                                            │
│ "__main__":                                                                                   │
│     main()                                                                                    │
│                                                                                               │
│ ```                                                                                           │
│                                                                                               │
│ ## FILE:                                                                                      │
│ skills/ski…                                                                                   │
│ ```py                                                                                         │
│ #!/usr/bin…                                                                                   │
│ python3                                                                                       │
│ """                                                                                           │
│ Skill                                                                                         │
│ Packager -                                                                                    │
│ Creates a                                                                                     │
│ distributa…                                                                                   │
│ .skill file                                                                                   │
│ of a skill                                                                                    │
│ folder                                                                                        │
│                                                                                               │
│ Usage:                                                                                        │
│     python                                                                                    │
│ utils/pack…                                                                                   │
│ <path/to/s…                                                                                   │
│ [output-di…                                                                                   │
│                                                                                               │
│ Example:                                                                                      │
│     python                                                                                    │
│ utils/pack…                                                                                   │
│ skills/pub…                                                                                   │
│     python                                                                                    │
│ utils/pack…                                                                                   │
│ skills/pub…                                                                                   │
│ ./dist                                                                                        │
│ """                                                                                           │
│                                                                                               │
│ import sys                                                                                    │
│ import                                                                                        │
│ zipfile                                                                                       │
│ from                                                                                          │
│ pathlib                                                                                       │
│ import Path                                                                                   │
│ from                                                                                          │
│ quick_vali…                                                                                   │
│ import                                                                                        │
│ validate_s…                                                                                   │
│                                                                                               │
│                                                                                               │
│ def                                                                                           │
│ package_sk…                                                                                   │
│ output_dir…                                                                                   │
│     """                                                                                       │
│     Package                                                                                   │
│ a skill                                                                                       │
│ folder into                                                                                   │
│ a .skill                                                                                      │
│ file.                                                                                         │
│                                                                                               │
│     Args:                                                                                     │
│         sk…                                                                                   │
│ Path to the                                                                                   │
│ skill                                                                                         │
│ folder                                                                                        │
│         ou…                                                                                   │
│ Optional                                                                                      │
│ output                                                                                        │
│ directory                                                                                     │
│ for the                                                                                       │
│ .skill file                                                                                   │
│ (defaults                                                                                     │
│ to current                                                                                    │
│ directory)                                                                                    │
│                                                                                               │
│     Return…                                                                                   │
│         Pa…                                                                                   │
│ to the                                                                                        │
│ created                                                                                       │
│ .skill                                                                                        │
│ file, or                                                                                      │
│ None if                                                                                       │
│ error                                                                                         │
│     """                                                                                       │
│     skill_…                                                                                   │
│ =                                                                                             │
│ Path(skill…                                                                                   │
│                                                                                               │
│     #                                                                                         │
│ Validate                                                                                      │
│ skill                                                                                         │
│ folder                                                                                        │
│ exists                                                                                        │
│     if not                                                                                    │
│ skill_path…                                                                                   │
│         pr…                                                                                   │
│ Error:                                                                                        │
│ Skill                                                                                         │
│ folder not                                                                                    │
│ found:                                                                                        │
│ {skill_pat…                                                                                   │
│         re…                                                                                   │
│ None                                                                                          │
│                                                                                               │
│     if not                                                                                    │
│ skill_path…                                                                                   │
│         pr…                                                                                   │
│ Error: Path                                                                                   │
│ is not a                                                                                      │
│ directory:                                                                                    │
│ {skill_pat…                                                                                   │
│         re…                                                                                   │
│ None                                                                                          │
│                                                                                               │
│     #                                                                                         │
│ Validate                                                                                      │
│ SKILL.md                                                                                      │
│ exists                                                                                        │
│     skill_…                                                                                   │
│ =                                                                                             │
│ skill_path                                                                                    │
│ /                                                                                             │
│ "SKILL.md"                                                                                    │
│     if not                                                                                    │
│ skill_md.e…                                                                                   │
│         pr…                                                                                   │
│ Error:                                                                                        │
│ SKILL.md                                                                                      │
│ not found                                                                                     │
│ in                                                                                            │
│ {skill_pat…                                                                                   │
│         re…                                                                                   │
│ None                                                                                          │
│                                                                                               │
│     # Run                                                                                     │
│ validation                                                                                    │
│ before                                                                                        │
│ packaging                                                                                     │
│     print(…                                                                                   │
│ Validating                                                                                    │
│ skill...")                                                                                    │
│     valid,                                                                                    │
│ message =                                                                                     │
│ validate_s…                                                                                   │
│     if not                                                                                    │
│ valid:                                                                                        │
│         pr…                                                                                   │
│ Validation                                                                                    │
│ failed:                                                                                       │
│ {message}")                                                                                   │
│         pr…                                                                                   │
│ Please fix                                                                                    │
│ the                                                                                           │
│ validation                                                                                    │
│ errors                                                                                        │
│ before                                                                                        │
│ packaging.…                                                                                   │
│         re…                                                                                   │
│ None                                                                                          │
│     print(…                                                                                   │
│ {message}\…                                                                                   │
│                                                                                               │
│     #                                                                                         │
│ Determine                                                                                     │
│ output                                                                                        │
│ location                                                                                      │
│     skill_…                                                                                   │
│ =                                                                                             │
│ skill_path…                                                                                   │
│     if                                                                                        │
│ output_dir:                                                                                   │
│         ou…                                                                                   │
│ =                                                                                             │
│ Path(outpu…                                                                                   │
│         ou…                                                                                   │
│ exist_ok=T…                                                                                   │
│     else:                                                                                     │
│         ou…                                                                                   │
│ =                                                                                             │
│ Path.cwd()                                                                                    │
│                                                                                               │
│     skill_…                                                                                   │
│ =                                                                                             │
│ output_path                                                                                   │
│ /                                                                                             │
│ f"{skill_n…                                                                                   │
│                                                                                               │
│     #                                                                                         │
│ Create the                                                                                    │
│ .skill file                                                                                   │
│ (zip                                                                                          │
│ format)                                                                                       │
│     try:                                                                                      │
│         wi…                                                                                   │
│ zipfile.Zi…                                                                                   │
│ 'w',                                                                                          │
│ zipfile.ZI…                                                                                   │
│ as zipf:                                                                                      │
│           …                                                                                   │
│ Walk                                                                                          │
│ through the                                                                                   │
│ skill                                                                                         │
│ directory                                                                                     │
│           …                                                                                   │
│ file_path                                                                                     │
│ in                                                                                            │
│ skill_path…                                                                                   │
│           …                                                                                   │
│ file_path.…                                                                                   │
│           …                                                                                   │
│ Calculate                                                                                     │
│ the                                                                                           │
│ relative                                                                                      │
│ path within                                                                                   │
│ the zip                                                                                       │
│           …                                                                                   │
│ =                                                                                             │
│ file_path.…                                                                                   │
│           …                                                                                   │
│ arcname)                                                                                      │
│           …                                                                                   │
│ Added:                                                                                        │
│ {arcname}")                                                                                   │
│                                                                                               │
│         pr…                                                                                   │
│ Successful…                                                                                   │
│ packaged                                                                                      │
│ skill to:                                                                                     │
│ {skill_fil…                                                                                   │
│         re…                                                                                   │
│ skill_file…                                                                                   │
│                                                                                               │
│     except                                                                                    │
│ Exception                                                                                     │
│ as e:                                                                                         │
│         pr…                                                                                   │
│ Error                                                                                         │
│ creating                                                                                      │
│ .skill                                                                                        │
│ file: {e}")                                                                                   │
│         re…                                                                                   │
│ None                                                                                          │
│                                                                                               │
│                                                                                               │
│ def main():                                                                                   │
│     if                                                                                        │
│ len(sys.ar…                                                                                   │
│ < 2:                                                                                          │
│         pr…                                                                                   │
│ python                                                                                        │
│ utils/pack…                                                                                   │
│ <path/to/s…                                                                                   │
│ [output-di…                                                                                   │
│         pr…                                                                                   │
│         pr…                                                                                   │
│ python                                                                                        │
│ utils/pack…                                                                                   │
│ skills/pub…                                                                                   │
│         pr…                                                                                   │
│ python                                                                                        │
│ utils/pack…                                                                                   │
│ skills/pub…                                                                                   │
│ ./dist")                                                                                      │
│         sy…                                                                                   │
│                                                                                               │
│     skill_…                                                                                   │
│ =                                                                                             │
│ sys.argv[1]                                                                                   │
│     output…                                                                                   │
│ =                                                                                             │
│ sys.argv[2]                                                                                   │
│ if                                                                                            │
│ len(sys.ar…                                                                                   │
│ > 2 else                                                                                      │
│ None                                                                                          │
│                                                                                               │
│     print(…                                                                                   │
│ Packaging                                                                                     │
│ skill:                                                                                        │
│ {skill_pat…                                                                                   │
│     if                                                                                        │
│ output_dir:                                                                                   │
│         pr…                                                                                   │
│ Output                                                                                        │
│ directory:                                                                                    │
│ {output_di…                                                                                   │
│     print()                                                                                   │
│                                                                                               │
│     result                                                                                    │
│ =                                                                                             │
│ package_sk…                                                                                   │
│ output_dir)                                                                                   │
│                                                                                               │
│     if                                                                                        │
│ result:                                                                                       │
│         sy…                                                                                   │
│     else:                                                                                     │
│         sy…                                                                                   │
│                                                                                               │
│                                                                                               │
│ if __name__                                                                                   │
│ ==                                                                                            │
│ "__main__":                                                                                   │
│     main()                                                                                    │
│                                                                                               │
│ ```                                                                                           │
│                                                                                               │
│ ## FILE:                                                                                      │
│ skills/ski…                                                                                   │
│ ```py                                                                                         │
│ #!/usr/bin…                                                                                   │
│ python3                                                                                       │
│ """                                                                                           │
│ Quick                                                                                         │
│ validation                                                                                    │
│ script for                                                                                    │
│ skills -                                                                                      │
│ minimal                                                                                       │
│ version                                                                                       │
│ """                                                                                           │
│                                                                                               │
│ import sys                                                                                    │
│ import os                                                                                     │
│ import re                                                                                     │
│ import yaml                                                                                   │
│ from                                                                                          │
│ pathlib                                                                                       │
│ import Path                                                                                   │
│                                                                                               │
│ def                                                                                           │
│ validate_s…                                                                                   │
│     """Bas…                                                                                   │
│ validation                                                                                    │
│ of a                                                                                          │
│ skill"""                                                                                      │
│     skill_…                                                                                   │
│ =                                                                                             │
│ Path(skill…                                                                                   │
│                                                                                               │
│     # Check                                                                                   │
│ SKILL.md                                                                                      │
│ exists                                                                                        │
│     skill_…                                                                                   │
│ =                                                                                             │
│ skill_path                                                                                    │
│ /                                                                                             │
│ 'SKILL.md'                                                                                    │
│     if not                                                                                    │
│ skill_md.e…                                                                                   │
│         re…                                                                                   │
│ False,                                                                                        │
│ "SKILL.md                                                                                     │
│ not found"                                                                                    │
│                                                                                               │
│     # Read                                                                                    │
│ and                                                                                           │
│ validate                                                                                      │
│ frontmatter                                                                                   │
│     content                                                                                   │
│ =                                                                                             │
│ skill_md.r…                                                                                   │
│     if not                                                                                    │
│ content.st…                                                                                   │
│         re…                                                                                   │
│ False, "No                                                                                    │
│ YAML                                                                                          │
│ frontmatter                                                                                   │
│ found"                                                                                        │
│                                                                                               │
│     #                                                                                         │
│ Extract                                                                                       │
│ frontmatter                                                                                   │
│     match =                                                                                   │
│ re.match(r…                                                                                   │
│ content,                                                                                      │
│ re.DOTALL)                                                                                    │
│     if not                                                                                    │
│ match:                                                                                        │
│         re…                                                                                   │
│ False,                                                                                        │
│ "Invalid                                                                                      │
│ frontmatter                                                                                   │
│ format"                                                                                       │
│                                                                                               │
│     frontm…                                                                                   │
│ =                                                                                             │
│ match.grou…                                                                                   │
│                                                                                               │
│     # Parse                                                                                   │
│ YAML                                                                                          │
│ frontmatter                                                                                   │
│     try:                                                                                      │
│         fr…                                                                                   │
│ =                                                                                             │
│ yaml.safe_…                                                                                   │
│         if                                                                                    │
│ not                                                                                           │
│ isinstance…                                                                                   │
│ dict):                                                                                        │
│           …                                                                                   │
│ False,                                                                                        │
│ "Frontmatt…                                                                                   │
│ must be a                                                                                     │
│ YAML                                                                                          │
│ dictionary"                                                                                   │
│     except                                                                                    │
│ yaml.YAMLE…                                                                                   │
│ as e:                                                                                         │
│         re…                                                                                   │
│ False,                                                                                        │
│ f"Invalid                                                                                     │
│ YAML in                                                                                       │
│ frontmatte…                                                                                   │
│ {e}"                                                                                          │
│                                                                                               │
│     #                                                                                         │
│ Define                                                                                        │
│ allowed                                                                                       │
│ properties                                                                                    │
│     ALLOWE…                                                                                   │
│ = {'name',                                                                                    │
│ 'descripti…                                                                                   │
│ 'license',                                                                                    │
│ 'allowed-t…                                                                                   │
│ 'metadata'}                                                                                   │
│                                                                                               │
│     # Check                                                                                   │
│ for                                                                                           │
│ unexpected                                                                                    │
│ properties                                                                                    │
│ (excluding                                                                                    │
│ nested keys                                                                                   │
│ under                                                                                         │
│ metadata)                                                                                     │
│     unexpe…                                                                                   │
│ =                                                                                             │
│ set(frontm…                                                                                   │
│ -                                                                                             │
│ ALLOWED_PR…                                                                                   │
│     if                                                                                        │
│ unexpected…                                                                                   │
│         re…                                                                                   │
│ False, (                                                                                      │
│           …                                                                                   │
│ key(s) in                                                                                     │
│ SKILL.md                                                                                      │
│ frontmatte…                                                                                   │
│ {',                                                                                           │
│ '.join(sor…                                                                                   │
│ "                                                                                             │
│           …                                                                                   │
│ properties                                                                                    │
│ are: {',                                                                                      │
│ '.join(sor…                                                                                   │
│         )                                                                                     │
│                                                                                               │
│     # Check                                                                                   │
│ required                                                                                      │
│ fields                                                                                        │
│     if                                                                                        │
│ 'name' not                                                                                    │
│ in                                                                                            │
│ frontmatte…                                                                                   │
│         re…                                                                                   │
│ False,                                                                                        │
│ "Missing                                                                                      │
│ 'name' in                                                                                     │
│ frontmatte…                                                                                   │
│     if                                                                                        │
│ 'descripti…                                                                                   │
│ not in                                                                                        │
│ frontmatte…                                                                                   │
│         re…                                                                                   │
│ False,                                                                                        │
│ "Missing                                                                                      │
│ 'descripti…                                                                                   │
│ in                                                                                            │
│ frontmatte…                                                                                   │
│                                                                                               │
│     #                                                                                         │
│ Extract                                                                                       │
│ name for                                                                                      │
│ validation                                                                                    │
│     name =                                                                                    │
│ frontmatte…                                                                                   │
│ '')                                                                                           │
│     if not                                                                                    │
│ isinstance…                                                                                   │
│ str):                                                                                         │
│         re…                                                                                   │
│ False,                                                                                        │
│ f"Name must                                                                                   │
│ be a                                                                                          │
│ string, got                                                                                   │
│ {type(name…                                                                                   │
│     name =                                                                                    │
│ name.strip…                                                                                   │
│     if                                                                                        │
│ name:                                                                                         │
│         #                                                                                     │
│ Check                                                                                         │
│ naming                                                                                        │
│ convention                                                                                    │
│ (hyphen-ca…                                                                                   │
│ lowercase                                                                                     │
│ with                                                                                          │
│ hyphens)                                                                                      │
│         if                                                                                    │
│ not                                                                                           │
│ re.match(r…                                                                                   │
│ name):                                                                                        │
│           …                                                                                   │
│ False,                                                                                        │
│ f"Name                                                                                        │
│ '{name}'                                                                                      │
│ should be                                                                                     │
│ hyphen-case                                                                                   │
│ (lowercase                                                                                    │
│ letters,                                                                                      │
│ digits, and                                                                                   │
│ hyphens                                                                                       │
│ only)"                                                                                        │
│         if                                                                                    │
│ name.start…                                                                                   │
│ or                                                                                            │
│ name.endsw…                                                                                   │
│ or '--' in                                                                                    │
│ name:                                                                                         │
│           …                                                                                   │
│ False,                                                                                        │
│ f"Name                                                                                        │
│ '{name}'                                                                                      │
│ cannot                                                                                        │
│ start/end                                                                                     │
│ with hyphen                                                                                   │
│ or contain                                                                                    │
│ consecutive                                                                                   │
│ hyphens"                                                                                      │
│         #                                                                                     │
│ Check name                                                                                    │
│ length (max                                                                                   │
│ 64                                                                                            │
│ characters                                                                                    │
│ per spec)                                                                                     │
│         if                                                                                    │
│ len(name) >                                                                                   │
│ 64:                                                                                           │
│           …                                                                                   │
│ False,                                                                                        │
│ f"Name is                                                                                     │
│ too long                                                                                      │
│ ({len(name…                                                                                   │
│ characters…                                                                                   │
│ Maximum is                                                                                    │
│ 64                                                                                            │
│ characters…                                                                                   │
│                                                                                               │
│     #                                                                                         │
│ Extract and                                                                                   │
│ validate                                                                                      │
│ description                                                                                   │
│     descri…                                                                                   │
│ =                                                                                             │
│ frontmatte…                                                                                   │
│ '')                                                                                           │
│     if not                                                                                    │
│ isinstance…                                                                                   │
│ str):                                                                                         │
│         re…                                                                                   │
│ False,                                                                                        │
│ f"Descript…                                                                                   │
│ must be a                                                                                     │
│ string, got                                                                                   │
│ {type(desc…                                                                                   │
│     descri…                                                                                   │
│ =                                                                                             │
│ descriptio…                                                                                   │
│     if                                                                                        │
│ descriptio…                                                                                   │
│         #                                                                                     │
│ Check for                                                                                     │
│ angle                                                                                         │
│ brackets                                                                                      │
│         if                                                                                    │
│ '<' in                                                                                        │
│ description                                                                                   │
│ or '>' in                                                                                     │
│ descriptio…                                                                                   │
│           …                                                                                   │
│ False,                                                                                        │
│ "Descripti…                                                                                   │
│ cannot                                                                                        │
│ contain                                                                                       │
│ angle                                                                                         │
│ brackets (<                                                                                   │
│ or >)"                                                                                        │
│         #                                                                                     │
│ Check                                                                                         │
│ description                                                                                   │
│ length (max                                                                                   │
│ 1024                                                                                          │
│ characters                                                                                    │
│ per spec)                                                                                     │
│         if                                                                                    │
│ len(descri…                                                                                   │
│ > 1024:                                                                                       │
│           …                                                                                   │
│ False,                                                                                        │
│ f"Descript…                                                                                   │
│ is too long                                                                                   │
│ ({len(desc…                                                                                   │
│ characters…                                                                                   │
│ Maximum is                                                                                    │
│ 1024                                                                                          │
│ characters…                                                                                   │
│                                                                                               │
│     return                                                                                    │
│ True,                                                                                         │
│ "Skill is                                                                                     │
│ valid!"                                                                                       │
│                                                                                               │
│ if __name__                                                                                   │
│ ==                                                                                            │
│ "__main__":                                                                                   │
│     if                                                                                        │
│ len(sys.ar…                                                                                   │
│ != 2:                                                                                         │
│         pr…                                                                                   │
│ python                                                                                        │
│ quick_vali…                                                                                   │
│ <skill_dir…                                                                                   │
│         sy…                                                                                   │
│                                                                                               │
│     valid,                                                                                    │
│ message =                                                                                     │
│ validate_s…                                                                                   │
│     print(…                                                                                   │
│     sys.ex…                                                                                   │
│ if valid                                                                                      │
│ else 1)                                                                                       │
│ ```                                                                                           │
│                                                                                               │
│ </code>                                                                                       │
│                                                                                               │
│ ASSISTANT   This repository provides a suite of extensions for the Claude Code agent          │
│             environment, consisting of Model Context Protocol (MCP) servers, lifecycle hooks, │
│             and task orchestration scripts. The system is designed to extend the agent's      │
│             capabilities in web data retrieval, runtime security enforcement, and             │
│             parallelized task execution.                                                      │
│                                                                                               │
│             ### Architecture and Component Interaction                                        │
│                                                                                               │
│             The codebase is organized into four primary functional domains:                   │
│                                                                                               │
│             1.  **Web Search and Content Retrieval (MCP):** The `conduit-websearch` server    │
│             implements the Model Context Protocol to expose tools for searching the web via   │
│             the Brave Search API and fetching remote resources. The retrieval pipeline uses a │
│             multi-stage conversion process: HTML is processed through `readabilipy` for       │
│             content extraction and `markdownify` for Markdown conversion, while binary        │
│             formats (PDF, DOCX, XLSX, PPTX) are processed via `markitdown`.                   │
│             2.  **Runtime Intervention (Hookify & Security Guidance):** These components      │
│             utilize Claude Code's hook system to intercept agent actions. `Hookify`           │
│             implements a dynamic rule engine that parses YAML frontmatter from local Markdown │
│             files to evaluate conditions against tool inputs using regex and string           │
│             comparison. `Security Guidance` provides a specialized implementation for         │
│             detecting common vulnerabilities such as command injection in GitHub Actions or   │
│             unsafe execution of `eval()` and `child_process.exec()`.                          │
│             3.  **Parallel Orchestration (Batch Dispatch):** The `batch-dispatch` skill       │
│             manages the concurrent execution of multiple Claude Code instances. It uses an    │
│             asynchronous semaphore-controlled worker model to spawn isolated subprocesses,    │
│             utilizing the agent's native sandboxing features by enforcing per-task working    │
│             directories.                                                                      │
│             4.  **Extensibility Framework (Skill Creator):** A set of utilities for           │
│             scaffolding, validating, and packaging modular "skills." This includes schema     │
│             enforcement for skill metadata and zip-based packaging into `.skill` distribution │
│             files.                                                                            │
│                                                                                               │
│             ### Key Implementation Details                                                    │
│                                                                                               │
│             **Concurrency and Resource Management:**                                          │
│             The `batch_runner.py` script utilizes `asyncio.Semaphore` to limit concurrent     │
│             worker processes (defaulting to 5). Each worker operates in a unique temporary    │
│             directory to prevent filesystem collisions. Tasks are subject to a configurable   │
│             timeout (default 600s) implemented via `asyncio.wait_for`, with explicit          │
│             subprocess termination on timeout to prevent zombie processes.                    │
│                                                                                               │
│             **Data Flow and Content Processing:**                                             │
│             In the `fetch_url` tool, a MIME-type dispatcher determines the processing path.   │
│             For HTML, the decision to use Readability is made to maximize information density │
│             for the LLM by stripping boilerplate navigation and ads. Content exceeding 8,000  │
│             characters is automatically paginated and includes a generated Table of Contents  │
│             based on Markdown headers to allow the agent to navigate large documents          │
│             efficiently.                                                                      │
│                                                                                               │
│             **Error Handling and Stability:**                                                 │
│             Plugin hooks (e.g., `pretooluse.py`) are designed with a fail-open philosophy.    │
│             The scripts use exhaustive `try-except` blocks and typically exit with code 0 to  │
│             ensure that a failure in the hook logic does not block the primary agent loop,    │
│             except when a security rule explicitly triggers a block (exit code 2). State      │
│             management for security warnings is persisted in `~/.claude/` using session-keyed │
│             JSON files to prevent redundant notifications within the same context.            │
│                                                                                               │
│             **Technical Constraints and Decisions:**                                          │
│             *   **Markdown Conversion:** `markitdown` is used for binary files instead of     │
│             simpler text extractors because it preserves structural elements (tables, lists)  │
│             which are critical for LLM reasoning.                                             │
│             *   **Regex Caching:** The `RuleEngine` utilizes `functools.lru_cache` for        │
│             compiled regex patterns to minimize overhead during high-frequency tool calls     │
│             (e.g., `MultiEdit` operations).                                                   │
│             *   **Sandboxing:** The `batch_runner` explicitly checks for the `/sandbox`       │
│             auto-allow configuration. This decision was made because running parallel         │
│             headless agents without filesystem restriction poses a high risk of accidental    │
│             recursive file modifications.                                                     │
│                                                                                               │
│             ### Operational Context and Limitations                                           │
│                                                                                               │
│             *   **Brave API Dependency:** The search functionality requires a `BRAVE_API_KEY` │
│             environment variable.                                                             │
│             *   **Dependency Management:** The `batch_runner` uses the inline script metadata │
│             format (PEP 723) for dependency specification, requiring a compatible runner like │
│             `uv` or manual installation of `jinja2`.                                          │
│             *   **Hook Pathing:** Plugins depend on the `CLAUDE_PLUGIN_ROOT` environment      │
│             variable being correctly set by the host environment to resolve internal modules. │
│             *   **MIME Sniffing:** If a server provides an incorrect or missing MIME type,    │
│             the `fetch_url` tool falls back to inspecting the first 100 characters for an     │
│             `<html` tag before defaulting to raw text.                                        │
╰───────────────────────────────────────────────────────────────────────────────────────────────╯
This repository provides a suite of extensions for the Claude Code agent environment, consisting of Model Context Protocol (MCP) servers, lifecycle hooks, and task orchestration scripts. The system is designed to extend the agent's capabilities in web data retrieval, runtime security enforcement, and parallelized task execution.

### Architecture and Component Interaction

The codebase is organized into four primary functional domains:

1.  **Web Search and Content Retrieval (MCP):** The `conduit-websearch` server implements the Model Context Protocol to expose tools for searching the web via the Brave Search API and fetching remote resources. The retrieval pipeline uses a multi-stage conversion process: HTML is processed through `readabilipy` for content extraction and `markdownify` for Markdown conversion, while binary formats (PDF, DOCX, XLSX, PPTX) are processed via `markitdown`.
2.  **Runtime Intervention (Hookify & Security Guidance):** These components utilize Claude Code's hook system to intercept agent actions. `Hookify` implements a dynamic rule engine that parses YAML frontmatter from local Markdown files to evaluate conditions against tool inputs using regex and string comparison. `Security Guidance` provides a specialized implementation for detecting common vulnerabilities such as command injection in GitHub Actions or unsafe execution of `eval()` and `child_process.exec()`.
3.  **Parallel Orchestration (Batch Dispatch):** The `batch-dispatch` skill manages the concurrent execution of multiple Claude Code instances. It uses an asynchronous semaphore-controlled worker model to spawn isolated subprocesses, utilizing the agent's native sandboxing features by enforcing per-task working directories.
4.  **Extensibility Framework (Skill Creator):** A set of utilities for scaffolding, validating, and packaging modular "skills." This includes schema enforcement for skill metadata and zip-based packaging into `.skill` distribution files.

### Key Implementation Details

**Concurrency and Resource Management:**
The `batch_runner.py` script utilizes `asyncio.Semaphore` to limit concurrent worker processes (defaulting to 5). Each worker operates in a unique temporary directory to prevent filesystem collisions. Tasks are subject to a configurable timeout (default 600s) implemented via `asyncio.wait_for`, with explicit subprocess termination on timeout to prevent zombie processes.

**Data Flow and Content Processing:**
In the `fetch_url` tool, a MIME-type dispatcher determines the processing path. For HTML, the decision to use Readability is made to maximize information density for the LLM by stripping boilerplate navigation and ads. Content exceeding 8,000 characters is automatically paginated and includes a generated Table of Contents based on Markdown headers to allow the agent to navigate large documents efficiently.

**Error Handling and Stability:**
Plugin hooks (e.g., `pretooluse.py`) are designed with a fail-open philosophy. The scripts use exhaustive `try-except` blocks and typically exit with code 0 to ensure that a failure in the hook logic does not block the primary agent loop, except when a security rule explicitly triggers a block (exit code 2). State management for security warnings is persisted in `~/.claude/` using session-keyed JSON files to prevent redundant notifications within the same context.

**Technical Constraints and Decisions:**
*   **Markdown Conversion:** `markitdown` is used for binary files instead of simpler text extractors because it preserves structural elements (tables, lists) which are critical for LLM reasoning.
*   **Regex Caching:** The `RuleEngine` utilizes `functools.lru_cache` for compiled regex patterns to minimize overhead during high-frequency tool calls (e.g., `MultiEdit` operations).
*   **Sandboxing:** The `batch_runner` explicitly checks for the `/sandbox` auto-allow configuration. This decision was made because running parallel headless agents without filesystem restriction poses a high risk of accidental recursive file modifications.

### Operational Context and Limitations

*   **Brave API Dependency:** The search functionality requires a `BRAVE_API_KEY` environment variable.
*   **Dependency Management:** The `batch_runner` uses the inline script metadata format (PEP 723) for dependency specification, requiring a compatible runner like `uv` or manual installation of `jinja2`.
*   **Hook Pathing:** Plugins depend on the `CLAUDE_PLUGIN_ROOT` environment variable being correctly set by the host environment to resolve internal modules.
*   **MIME Sniffing:** If a server provides an incorrect or missing MIME type, the `fetch_url` tool falls back to inspecting the first 100 characters for an `<html` tag before defaulting to raw text.
